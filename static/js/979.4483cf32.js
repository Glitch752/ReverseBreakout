/*! For license information please see 979.4483cf32.js.LICENSE.txt */
"use strict";(self.webpackChunkreverse_breakout=self.webpackChunkreverse_breakout||[]).push([["979"],{454(t,e,i){i.d(e,{_:()=>o});function o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}},683(t,e,i){i.d(e,{HK:()=>iX,ZY:()=>N,az:()=>oK,jl:()=>or,sW:()=>i3});var o,s,n,r,m,a,h,c,_,l,u,p,y,d,f,v,x,A,g,b,B,w=function(t,e){return(w=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)};function V(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}w(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var M=function(){return(M=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var s in e=arguments[i])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)},C=function(t,e){null==t&&(t={});var i=M({},t);for(var o in e)e.hasOwnProperty(o)&&void 0===t[o]&&(i[o]=e[o]);if("function"==typeof Object.getOwnPropertySymbols)for(var s=Object.getOwnPropertySymbols(e),n=0;n<s.length;n++){var r=s[n];e.propertyIsEnumerable(r)&&void 0===t[r]&&(i[r]=e[r])}return i},I=Math.random,z=Number.isFinite;function P(t,e,i){return(void 0===e?(i=1,e=0):void 0===i&&(i=e,e=0),i>e)?(t=(t-e)%(i-e))+(t<0?i:e):(t=(t-i)%(e-i))+(t<=0?e:i)}function S(t,e,i){return t<e?e:t>i?i:t}var L=Object.create(Math);L.EPSILON=1e-9,L.isFinite=z,L.nextPowerOfTwo=function(t){return t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},L.isPowerOfTwo=function(t){return t>0&&(t&t-1)==0},L.mod=P,L.clamp=S,L.random=function(t,e){return void 0===t?(e=1,t=0):void 0===e&&(e=t,t=0),t===e?t:I()*(e-t)+t};var F=Math.abs,T=Math.sqrt,q=Math.max,k=Math.min,N=function(){function t(e,i){if(!(this instanceof t))return new t(e,i);void 0===e?(this.x=0,this.y=0):"object"==typeof e?(this.x=e.x,this.y=e.y):(this.x=e,this.y=i)}return t.prototype._serialize=function(){return{x:this.x,y:this.y}},t._deserialize=function(e){var i=Object.create(t.prototype);return i.x=e.x,i.y=e.y,i},t.zero=function(){var e=Object.create(t.prototype);return e.x=0,e.y=0,e},t.neo=function(e,i){var o=Object.create(t.prototype);return o.x=e,o.y=i,o},t.clone=function(e){return t.neo(e.x,e.y)},t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&Number.isFinite(t.x)&&Number.isFinite(t.y)},t.assert=function(t){},t.prototype.clone=function(){return t.clone(this)},t.prototype.setZero=function(){return this.x=0,this.y=0,this},t.prototype.set=function(t,e){return"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this},t.prototype.setNum=function(t,e){return this.x=t,this.y=e,this},t.prototype.setVec2=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.wSet=function(t,e,i,o){return void 0!==i||void 0!==o?this.setCombine(t,e,i,o):this.setMul(t,e)},t.prototype.setCombine=function(t,e,i,o){var s=t*e.x+i*o.x,n=t*e.y+i*o.y;return this.x=s,this.y=n,this},t.prototype.setMul=function(t,e){var i=t*e.x,o=t*e.y;return this.x=i,this.y=o,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.wAdd=function(t,e,i,o){return void 0!==i||void 0!==o?this.addCombine(t,e,i,o):this.addMul(t,e)},t.prototype.addCombine=function(t,e,i,o){var s=t*e.x+i*o.x,n=t*e.y+i*o.y;return this.x+=s,this.y+=n,this},t.prototype.addMul=function(t,e){var i=t*e.x,o=t*e.y;return this.x+=i,this.y+=o,this},t.prototype.wSub=function(t,e,i,o){return void 0!==i||void 0!==o?this.subCombine(t,e,i,o):this.subMul(t,e)},t.prototype.subCombine=function(t,e,i,o){var s=t*e.x+i*o.x,n=t*e.y+i*o.y;return this.x-=s,this.y-=n,this},t.prototype.subMul=function(t,e){var i=t*e.x,o=t*e.y;return this.x-=i,this.y-=o,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.mul=function(t){return this.x*=t,this.y*=t,this},t.prototype.length=function(){return t.lengthOf(this)},t.prototype.lengthSquared=function(){return t.lengthSquared(this)},t.prototype.normalize=function(){var t=this.length();if(t<1e-9)return 0;var e=1/t;return this.x*=e,this.y*=e,t},t.normalize=function(e){var i=t.lengthOf(e);if(i<1e-9)return t.zero();var o=1/i;return t.neo(e.x*o,e.y*o)},t.lengthOf=function(t){return T(t.x*t.x+t.y*t.y)},t.lengthSquared=function(t){return t.x*t.x+t.y*t.y},t.distance=function(t,e){var i=t.x-e.x,o=t.y-e.y;return T(i*i+o*o)},t.distanceSquared=function(t,e){var i=t.x-e.x,o=t.y-e.y;return i*i+o*o},t.areEqual=function(t,e){return t===e||"object"==typeof e&&null!==e&&t.x===e.x&&t.y===e.y},t.skew=function(e){return t.neo(-e.y,e.x)},t.dot=function(t,e){return t.x*e.x+t.y*e.y},t.cross=function(e,i){return"number"==typeof i?t.neo(i*e.y,-i*e.x):"number"==typeof e?t.neo(-e*i.y,e*i.x):e.x*i.y-e.y*i.x},t.crossVec2Vec2=function(t,e){return t.x*e.y-t.y*e.x},t.crossVec2Num=function(e,i){return t.neo(i*e.y,-i*e.x)},t.crossNumVec2=function(e,i){return t.neo(-e*i.y,e*i.x)},t.addCross=function(e,i,o){return"number"==typeof o?t.neo(o*i.y+e.x,-o*i.x+e.y):"number"==typeof i?t.neo(-i*o.y+e.x,i*o.x+e.y):void 0},t.addCrossVec2Num=function(e,i,o){return t.neo(o*i.y+e.x,-o*i.x+e.y)},t.addCrossNumVec2=function(e,i,o){return t.neo(-i*o.y+e.x,i*o.x+e.y)},t.add=function(e,i){return t.neo(e.x+i.x,e.y+i.y)},t.wAdd=function(e,i,o,s){return void 0!==o||void 0!==s?t.combine(e,i,o,s):t.mulNumVec2(e,i)},t.combine=function(e,i,o,s){return t.zero().setCombine(e,i,o,s)},t.sub=function(e,i){return t.neo(e.x-i.x,e.y-i.y)},t.mul=function(e,i){return"object"==typeof e?t.neo(e.x*i,e.y*i):"object"==typeof i?t.neo(e*i.x,e*i.y):void 0},t.mulVec2Num=function(e,i){return t.neo(e.x*i,e.y*i)},t.mulNumVec2=function(e,i){return t.neo(e*i.x,e*i.y)},t.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},t.neg=function(e){return t.neo(-e.x,-e.y)},t.abs=function(e){return t.neo(F(e.x),F(e.y))},t.mid=function(e,i){return t.neo((e.x+i.x)*.5,(e.y+i.y)*.5)},t.upper=function(e,i){return t.neo(q(e.x,i.x),q(e.y,i.y))},t.lower=function(e,i){return t.neo(k(e.x,i.x),k(e.y,i.y))},t.prototype.clamp=function(t){var e=this.x*this.x+this.y*this.y;if(e>t*t){var i=t/T(e);this.x*=i,this.y*=i}return this},t.clamp=function(e,i){var o=t.neo(e.x,e.y);return o.clamp(i),o},t.clampVec2=function(t,e,i){return{x:S(t.x,null==e?void 0:e.x,null==i?void 0:i.x),y:S(t.y,null==e?void 0:e.y,null==i?void 0:i.y)}},t.scaleFn=function(e,i){return function(o){return t.neo(o.x*e,o.y*i)}},t.translateFn=function(e,i){return function(o){return t.neo(o.x+e,o.y+i)}},t}(),j=Math.max,D=Math.min,R=function(){function t(e,i){if(!(this instanceof t))return new t(e,i);this.lowerBound=N.zero(),this.upperBound=N.zero(),"object"==typeof e&&this.lowerBound.setVec2(e),"object"==typeof i?this.upperBound.setVec2(i):"object"==typeof e&&this.upperBound.setVec2(e)}return t.prototype.isValid=function(){return t.isValid(this)},t.isValid=function(t){return null!=t&&N.isValid(t.lowerBound)&&N.isValid(t.upperBound)&&N.sub(t.upperBound,t.lowerBound).lengthSquared()>=0},t.assert=function(t){},t.prototype.getCenter=function(){return N.neo((this.lowerBound.x+this.upperBound.x)*.5,(this.lowerBound.y+this.upperBound.y)*.5)},t.prototype.getExtents=function(){return N.neo((this.upperBound.x-this.lowerBound.x)*.5,(this.upperBound.y-this.lowerBound.y)*.5)},t.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)},t.prototype.combine=function(t,e){e=e||this;var i=t.lowerBound,o=t.upperBound,s=e.lowerBound,n=e.upperBound,r=D(i.x,s.x),m=D(i.y,s.y),a=j(n.x,o.x),h=j(n.y,o.y);this.lowerBound.setNum(r,m),this.upperBound.setNum(a,h)},t.prototype.combinePoints=function(t,e){this.lowerBound.setNum(D(t.x,e.x),D(t.y,e.y)),this.upperBound.setNum(j(t.x,e.x),j(t.y,e.y))},t.prototype.set=function(t){this.lowerBound.setNum(t.lowerBound.x,t.lowerBound.y),this.upperBound.setNum(t.upperBound.x,t.upperBound.y)},t.prototype.contains=function(t){return this.lowerBound.x<=t.lowerBound.x&&this.lowerBound.y<=t.lowerBound.y&&t.upperBound.x<=this.upperBound.x&&t.upperBound.y<=this.upperBound.y},t.prototype.extend=function(e){return t.extend(this,e),this},t.extend=function(t,e){return t.lowerBound.x-=e,t.lowerBound.y-=e,t.upperBound.x+=e,t.upperBound.y+=e,t},t.testOverlap=function(t,e){var i=e.lowerBound.x-t.upperBound.x,o=t.lowerBound.x-e.upperBound.x,s=e.lowerBound.y-t.upperBound.y,n=t.lowerBound.y-e.upperBound.y;return!(i>0)&&!(s>0)&&!(o>0)&&!(n>0)},t.areEqual=function(t,e){return N.areEqual(t.lowerBound,e.lowerBound)&&N.areEqual(t.upperBound,e.upperBound)},t.diff=function(t,e){var i=j(0,D(t.upperBound.x,e.upperBound.x)-j(e.lowerBound.x,t.lowerBound.x)),o=j(0,D(t.upperBound.y,e.upperBound.y)-j(e.lowerBound.y,t.lowerBound.y));return(t.upperBound.x-t.lowerBound.x)*(t.upperBound.y-t.lowerBound.y)+(e.upperBound.x-e.lowerBound.x)*(e.upperBound.y-e.lowerBound.y)-i*o},t.prototype.rayCast=function(t,e){var i=-1/0,o=1/0,s=e.p1,n=N.sub(e.p2,e.p1),r=N.abs(n),m=N.zero();if(r.x<1e-9){if(s.x<this.lowerBound.x||this.upperBound.x<s.x)return!1}else{var a=1/n.x,h=(this.lowerBound.x-s.x)*a,c=(this.upperBound.x-s.x)*a,_=-1;if(h>c){var l=h;h=c,c=l,_=1}if(h>i&&(m.setZero(),m.x=_,i=h),i>(o=D(o,c)))return!1}if(r.y<1e-9){if(s.y<this.lowerBound.y||this.upperBound.y<s.y)return!1}else{var a=1/n.y,h=(this.lowerBound.y-s.y)*a,c=(this.upperBound.y-s.y)*a,_=-1;if(h>c){var l=h;h=c,c=l,_=1}if(h>i&&(m.setZero(),m.y=_,i=h),i>(o=D(o,c)))return!1}return!(i<0)&&!(e.maxFraction<i)&&(t.fraction=i,t.normal=m,!0)},t.prototype.toString=function(){return JSON.stringify(this)},t.combinePoints=function(t,e,i){return t.lowerBound.x=D(e.x,i.x),t.lowerBound.y=D(e.y,i.y),t.upperBound.x=j(e.x,i.x),t.upperBound.y=j(e.y,i.y),t},t.combinedPerimeter=function(t,e){var i=D(t.lowerBound.x,e.lowerBound.x),o=D(t.lowerBound.y,e.lowerBound.y);return 2*(j(t.upperBound.x,e.upperBound.x)-i+j(t.upperBound.y,e.upperBound.y)-o)},t}(),O=Math.PI,E=function(){function t(){}return Object.defineProperty(t,"polygonRadius",{get:function(){return 2*t.linearSlop},enumerable:!1,configurable:!0}),t.lengthUnitsPerMeter=1,t.maxManifoldPoints=2,t.maxPolygonVertices=12,t.aabbExtension=.1,t.aabbMultiplier=2,t.linearSlop=.005,t.angularSlop=2/180*O,t.maxSubSteps=8,t.maxTOIContacts=32,t.maxTOIIterations=20,t.maxDistanceIterations=20,t.velocityThreshold=1,t.maxLinearCorrection=.2,t.maxAngularCorrection=8/180*O,t.maxTranslation=2,t.maxRotation=.5*O,t.baumgarte=.2,t.toiBaugarte=.75,t.timeToSleep=.5,t.linearSleepTolerance=.01,t.angularSleepTolerance=2/180*O,t}(),Y=function(){function t(){}return Object.defineProperty(t,"maxManifoldPoints",{get:function(){return E.maxManifoldPoints},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxPolygonVertices",{get:function(){return E.maxPolygonVertices},enumerable:!1,configurable:!0}),Object.defineProperty(t,"aabbExtension",{get:function(){return E.aabbExtension*E.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"aabbMultiplier",{get:function(){return E.aabbMultiplier},enumerable:!1,configurable:!0}),Object.defineProperty(t,"linearSlop",{get:function(){return E.linearSlop*E.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"linearSlopSquared",{get:function(){return E.linearSlop*E.lengthUnitsPerMeter*E.linearSlop*E.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"angularSlop",{get:function(){return E.angularSlop},enumerable:!1,configurable:!0}),Object.defineProperty(t,"polygonRadius",{get:function(){return 2*E.linearSlop},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxSubSteps",{get:function(){return E.maxSubSteps},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxTOIContacts",{get:function(){return E.maxTOIContacts},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxTOIIterations",{get:function(){return E.maxTOIIterations},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxDistanceIterations",{get:function(){return E.maxDistanceIterations},enumerable:!1,configurable:!0}),Object.defineProperty(t,"velocityThreshold",{get:function(){return E.velocityThreshold*E.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxLinearCorrection",{get:function(){return E.maxLinearCorrection*E.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxAngularCorrection",{get:function(){return E.maxAngularCorrection},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxTranslation",{get:function(){return E.maxTranslation*E.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxTranslationSquared",{get:function(){return E.maxTranslation*E.lengthUnitsPerMeter*E.maxTranslation*E.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxRotation",{get:function(){return E.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxRotationSquared",{get:function(){return E.maxRotation*E.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(t,"baumgarte",{get:function(){return E.baumgarte},enumerable:!1,configurable:!0}),Object.defineProperty(t,"toiBaugarte",{get:function(){return E.toiBaugarte},enumerable:!1,configurable:!0}),Object.defineProperty(t,"timeToSleep",{get:function(){return E.timeToSleep},enumerable:!1,configurable:!0}),Object.defineProperty(t,"linearSleepTolerance",{get:function(){return E.linearSleepTolerance*E.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"linearSleepToleranceSqr",{get:function(){return E.linearSleepTolerance*E.lengthUnitsPerMeter*E.linearSleepTolerance*E.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"angularSleepTolerance",{get:function(){return E.angularSleepTolerance},enumerable:!1,configurable:!0}),Object.defineProperty(t,"angularSleepToleranceSqr",{get:function(){return E.angularSleepTolerance*E.angularSleepTolerance},enumerable:!1,configurable:!0}),t}(),J=function(){function t(t){this._list=[],this._max=1/0,this._hasCreateFn=!1,this._createCount=0,this._hasAllocateFn=!1,this._allocateCount=0,this._hasReleaseFn=!1,this._releaseCount=0,this._hasDisposeFn=!1,this._disposeCount=0,this._list=[],this._max=t.max||this._max,this._createFn=t.create,this._hasCreateFn="function"==typeof this._createFn,this._allocateFn=t.allocate,this._hasAllocateFn="function"==typeof this._allocateFn,this._releaseFn=t.release,this._hasReleaseFn="function"==typeof this._releaseFn,this._disposeFn=t.dispose,this._hasDisposeFn="function"==typeof this._disposeFn}return t.prototype.max=function(t){return"number"==typeof t?(this._max=t,this):this._max},t.prototype.size=function(){return this._list.length},t.prototype.allocate=function(){var t;return this._list.length>0?t=this._list.shift():(this._createCount++,t=this._hasCreateFn?this._createFn():{}),this._allocateCount++,this._hasAllocateFn&&this._allocateFn(t),t},t.prototype.release=function(t){this._list.length<this._max?(this._releaseCount++,this._hasReleaseFn&&this._releaseFn(t),this._list.push(t)):(this._disposeCount++,this._hasDisposeFn&&(t=this._disposeFn(t)))},t.prototype.toString=function(){return" +"+this._createCount+" >"+this._allocateCount+" <"+this._releaseCount+" -"+this._disposeCount+" ="+this._list.length+"/"+this._max},t}(),H=Math.abs,W=Math.max,U=function(){function t(t){this.aabb=new R,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.id=t}return t.prototype.toString=function(){return this.id+": "+this.userData},t.prototype.isLeaf=function(){return null==this.child1},t}(),Z=new J({create:function(){return new U},release:function(t){t.userData=null,t.parent=null,t.child1=null,t.child2=null,t.height=-1,t.id=void 0}}),K=function(){function t(){this.inputPool=new J({create:function(){return{}},release:function(t){}}),this.stackPool=new J({create:function(){return[]},release:function(t){t.length=0}}),this.iteratorPool=new J({create:function(){return new X},release:function(t){t.close()}}),this.m_root=null,this.m_nodes={},this.m_lastProxyId=0}return t.prototype.getUserData=function(t){return this.m_nodes[t].userData},t.prototype.getFatAABB=function(t){return this.m_nodes[t].aabb},t.prototype.allocateNode=function(){var t=Z.allocate();return t.id=++this.m_lastProxyId,this.m_nodes[t.id]=t,t},t.prototype.freeNode=function(t){delete this.m_nodes[t.id],Z.release(t)},t.prototype.createProxy=function(t,e){var i=this.allocateNode();return i.aabb.set(t),R.extend(i.aabb,Y.aabbExtension),i.userData=e,i.height=0,this.insertLeaf(i),i.id},t.prototype.destroyProxy=function(t){var e=this.m_nodes[t];this.removeLeaf(e),this.freeNode(e)},t.prototype.moveProxy=function(t,e,i){var o=this.m_nodes[t];return!o.aabb.contains(e)&&(this.removeLeaf(o),o.aabb.set(e),e=o.aabb,R.extend(e,Y.aabbExtension),i.x<0?e.lowerBound.x+=i.x*Y.aabbMultiplier:e.upperBound.x+=i.x*Y.aabbMultiplier,i.y<0?e.lowerBound.y+=i.y*Y.aabbMultiplier:e.upperBound.y+=i.y*Y.aabbMultiplier,this.insertLeaf(o),!0)},t.prototype.insertLeaf=function(t){if(null==this.m_root){this.m_root=t,this.m_root.parent=null;return}for(var e=t.aabb,i=this.m_root;!i.isLeaf();){var o=i.child1,s=i.child2,n=i.aabb.getPerimeter(),r=R.combinedPerimeter(i.aabb,e),m=2*r,a=2*(r-n),h=R.combinedPerimeter(e,o.aabb)+a;if(!o.isLeaf()){var c=o.aabb.getPerimeter();h-=c}var _=R.combinedPerimeter(e,s.aabb)+a;if(!s.isLeaf()){var c=s.aabb.getPerimeter();_-=c}if(m<h&&m<_)break;i=h<_?o:s}var l=i,u=l.parent,p=this.allocateNode();for(p.parent=u,p.userData=null,p.aabb.combine(e,l.aabb),p.height=l.height+1,null!=u?(u.child1===l?u.child1=p:u.child2=p,p.child1=l,p.child2=t,l.parent=p,t.parent=p):(p.child1=l,p.child2=t,l.parent=p,t.parent=p,this.m_root=p),i=t.parent;null!=i;){var o=(i=this.balance(i)).child1,s=i.child2;i.height=1+W(o.height,s.height),i.aabb.combine(o.aabb,s.aabb),i=i.parent}},t.prototype.removeLeaf=function(t){if(t===this.m_root){this.m_root=null;return}var e,i=t.parent,o=i.parent;if(e=i.child1===t?i.child2:i.child1,null!=o){o.child1===i?o.child1=e:o.child2=e,e.parent=o,this.freeNode(i);for(var s=o;null!=s;){var n=(s=this.balance(s)).child1,r=s.child2;s.aabb.combine(n.aabb,r.aabb),s.height=1+W(n.height,r.height),s=s.parent}}else this.m_root=e,e.parent=null,this.freeNode(i)},t.prototype.balance=function(t){if(t.isLeaf()||t.height<2)return t;var e=t.child1,i=t.child2,o=i.height-e.height;if(o>1){var s=i.child1,n=i.child2;return i.child1=t,i.parent=t.parent,t.parent=i,null!=i.parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,s.height>n.height?(i.child2=s,t.child2=n,n.parent=t,t.aabb.combine(e.aabb,n.aabb),i.aabb.combine(t.aabb,s.aabb),t.height=1+W(e.height,n.height),i.height=1+W(t.height,s.height)):(i.child2=n,t.child2=s,s.parent=t,t.aabb.combine(e.aabb,s.aabb),i.aabb.combine(t.aabb,n.aabb),t.height=1+W(e.height,s.height),i.height=1+W(t.height,n.height)),i}if(o<-1){var r=e.child1,m=e.child2;return e.child1=t,e.parent=t.parent,t.parent=e,null!=e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,r.height>m.height?(e.child2=r,t.child1=m,m.parent=t,t.aabb.combine(i.aabb,m.aabb),e.aabb.combine(t.aabb,r.aabb),t.height=1+W(i.height,m.height),e.height=1+W(t.height,r.height)):(e.child2=m,t.child1=r,r.parent=t,t.aabb.combine(i.aabb,r.aabb),e.aabb.combine(t.aabb,m.aabb),t.height=1+W(i.height,r.height),e.height=1+W(t.height,m.height)),e}return t},t.prototype.getHeight=function(){return null==this.m_root?0:this.m_root.height},t.prototype.getAreaRatio=function(){if(null==this.m_root)return 0;for(var t,e=this.m_root.aabb.getPerimeter(),i=0,o=this.iteratorPool.allocate().preorder(this.m_root);t=o.next();)t.height<0||(i+=t.aabb.getPerimeter());return this.iteratorPool.release(o),i/e},t.prototype.computeHeight=function(t){var e;return(e=void 0!==t?this.m_nodes[t]:this.m_root).isLeaf()?0:1+W(this.computeHeight(e.child1.id),this.computeHeight(e.child2.id))},t.prototype.validateStructure=function(t){if(null!=t){this.m_root;var e=t.child1,i=t.child2;t.isLeaf()||(this.validateStructure(e),this.validateStructure(i))}},t.prototype.validateMetrics=function(t){if(null!=t){var e=t.child1,i=t.child2;t.isLeaf()||(this.validateMetrics(e),this.validateMetrics(i))}},t.prototype.validate=function(){},t.prototype.getMaxBalance=function(){for(var t,e=0,i=this.iteratorPool.allocate().preorder(this.m_root);t=i.next();)t.height<=1||(e=W(e,H(t.child2.height-t.child1.height)));return this.iteratorPool.release(i),e},t.prototype.rebuildBottomUp=function(){for(var t,e=[],i=0,o=this.iteratorPool.allocate().preorder(this.m_root);t=o.next();)!(t.height<0)&&(t.isLeaf()?(t.parent=null,e[i]=t,++i):this.freeNode(t));for(this.iteratorPool.release(o);i>1;){for(var s=1/0,n=-1,r=-1,m=0;m<i;++m)for(var a=e[m].aabb,h=m+1;h<i;++h){var c=e[h].aabb,_=R.combinedPerimeter(a,c);_<s&&(n=m,r=h,s=_)}var l=e[n],u=e[r],p=this.allocateNode();p.child1=l,p.child2=u,p.height=1+W(l.height,u.height),p.aabb.combine(l.aabb,u.aabb),p.parent=null,l.parent=p,u.parent=p,e[r]=e[i-1],e[n]=p,--i}this.m_root=e[0]},t.prototype.shiftOrigin=function(t){for(var e,i=this.iteratorPool.allocate().preorder(this.m_root);e=i.next();){var o=e.aabb;o.lowerBound.x-=t.x,o.lowerBound.y-=t.y,o.upperBound.x-=t.x,o.upperBound.y-=t.y}this.iteratorPool.release(i)},t.prototype.query=function(t,e){var i=this.stackPool.allocate();for(i.push(this.m_root);i.length>0;){var o=i.pop();if(null!=o&&R.testOverlap(o.aabb,t))if(o.isLeaf()){if(!1===e(o.id))return}else i.push(o.child1),i.push(o.child2)}this.stackPool.release(i)},t.prototype.rayCast=function(t,e){var i=t.p1,o=t.p2,s=N.sub(o,i);s.normalize();var n=N.crossNumVec2(1,s),r=N.abs(n),m=t.maxFraction,a=new R,h=N.combine(1-m,i,m,o);a.combinePoints(i,h);var c=this.stackPool.allocate(),_=this.inputPool.allocate();for(c.push(this.m_root);c.length>0;){var l=c.pop();if(null!=l&&!1!==R.testOverlap(l.aabb,a)){var u=l.aabb.getCenter(),p=l.aabb.getExtents();if(!(H(N.dot(n,N.sub(i,u)))-N.dot(r,p)>0))if(l.isLeaf()){_.p1=N.clone(t.p1),_.p2=N.clone(t.p2),_.maxFraction=m;var y=e(_,l.id);if(0===y)break;y>0&&(m=y,h=N.combine(1-m,i,m,o),a.combinePoints(i,h))}else c.push(l.child1),c.push(l.child2)}}this.stackPool.release(c),this.inputPool.release(_)},t}(),X=function(){function t(){this.parents=[],this.states=[]}return t.prototype.preorder=function(t){return this.parents.length=0,this.parents.push(t),this.states.length=0,this.states.push(0),this},t.prototype.next=function(){for(;this.parents.length>0;){var t=this.parents.length-1,e=this.parents[t];if(0===this.states[t])return this.states[t]=1,e;if(1===this.states[t]&&(this.states[t]=2,e.child1))return this.parents.push(e.child1),this.states.push(1),e.child1;if(2===this.states[t]&&(this.states[t]=3,e.child2))return this.parents.push(e.child2),this.states.push(1),e.child2;this.parents.pop(),this.states.pop()}},t.prototype.close=function(){this.parents.length=0},t}(),G=Math.max,Q=Math.min,$=function(){function t(){var t=this;this.m_tree=new K,this.m_moveBuffer=[],this.query=function(e,i){t.m_tree.query(e,i)},this.queryCallback=function(e){if(e===t.m_queryProxyId)return!0;var i=Q(e,t.m_queryProxyId),o=G(e,t.m_queryProxyId),s=t.m_tree.getUserData(i),n=t.m_tree.getUserData(o);return t.m_callback(s,n),!0}}return t.prototype.getUserData=function(t){return this.m_tree.getUserData(t)},t.prototype.testOverlap=function(t,e){var i=this.m_tree.getFatAABB(t),o=this.m_tree.getFatAABB(e);return R.testOverlap(i,o)},t.prototype.getFatAABB=function(t){return this.m_tree.getFatAABB(t)},t.prototype.getProxyCount=function(){return this.m_moveBuffer.length},t.prototype.getTreeHeight=function(){return this.m_tree.getHeight()},t.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()},t.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()},t.prototype.rayCast=function(t,e){this.m_tree.rayCast(t,e)},t.prototype.shiftOrigin=function(t){this.m_tree.shiftOrigin(t)},t.prototype.createProxy=function(t,e){var i=this.m_tree.createProxy(t,e);return this.bufferMove(i),i},t.prototype.destroyProxy=function(t){this.unbufferMove(t),this.m_tree.destroyProxy(t)},t.prototype.moveProxy=function(t,e,i){this.m_tree.moveProxy(t,e,i)&&this.bufferMove(t)},t.prototype.touchProxy=function(t){this.bufferMove(t)},t.prototype.bufferMove=function(t){this.m_moveBuffer.push(t)},t.prototype.unbufferMove=function(t){for(var e=0;e<this.m_moveBuffer.length;++e)this.m_moveBuffer[e]===t&&(this.m_moveBuffer[e]=null)},t.prototype.updatePairs=function(t){for(this.m_callback=t;this.m_moveBuffer.length>0;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),null!==this.m_queryProxyId){var e=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(e,this.queryCallback)}},t}(),tt=Math.sin,te=Math.cos,ti=Math.sqrt;function to(t,e){return{x:t,y:e}}function ts(t,e,i){return t.x=e,t.y=i,t}function tn(t,e){return t.x=e.x,t.y=e.y,t}function tr(t){return t.x=0,t.y=0,t}function tm(t){return t.x=-t.x,t.y=-t.y,t}function ta(t,e){return t.x+=e.x,t.y+=e.y,t}function th(t,e){return t.x-=e.x,t.y-=e.y,t}function tc(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t}function t_(t,e){return t.x*=e,t.y*=e,t}function tl(t,e,i){return t.x=e*i.x,t.y=e*i.y,t}function tu(t,e,i){return t.x+=e*i.x,t.y+=e*i.y,t}function tp(t,e,i){return t.x-=e*i.x,t.y-=e*i.y,t}function ty(t,e,i,o,s){return t.x=e*i.x+o*s.x,t.y=e*i.y+o*s.y,t}function td(t,e,i,o,s,n,r){return t.x=e*i.x+o*s.x+n*r.x,t.y=e*i.y+o*s.y+n*r.y,t}function tf(t){var e=ti(t.x*t.x+t.y*t.y);if(e>0){var i=1/e;t.x*=i,t.y*=i}return t}function tv(t,e,i){var o=i*e.y,s=-i*e.x;return t.x=o,t.y=s,t}function tx(t,e,i){var o=-e*i.y,s=e*i.x;return t.x=o,t.y=s,t}function tA(t,e){return t.x*e.y-t.y*e.x}function tg(t,e){return t.x*e.x+t.y*e.y}function tb(t){return t.x*t.x+t.y*t.y}function tB(t,e){var i=t.x-e.x,o=t.y-e.y;return ti(i*i+o*o)}function tw(t,e){var i=t.x-e.x,o=t.y-e.y;return i*i+o*o}function tV(t,e,i){return t.x=e.c*i.x-e.s*i.y,t.y=e.s*i.x+e.c*i.y,t}function tM(t,e,i){var o=e.c*i.x+e.s*i.y,s=-e.s*i.x+e.c*i.y;return t.x=o,t.y=s,t}function tC(t,e,i){return{p:to(t,e),q:{s:tt(i),c:te(i)}}}function tI(t,e){return t.p.x=e.p.x,t.p.y=e.p.y,t.q.s=e.q.s,t.q.c=e.q.c,t}function tz(t,e,i){var o=e.q.c*i.x-e.q.s*i.y+e.p.x,s=e.q.s*i.x+e.q.c*i.y+e.p.y;return t.x=o,t.y=s,t}function tP(t,e,i){var o=i.x-e.p.x,s=i.y-e.p.y,n=e.q.c*o+e.q.s*s,r=-e.q.s*o+e.q.c*s;return t.x=n,t.y=r,t}function tS(t,e,i,o){var s=e.q.c*o.x-e.q.s*o.y+e.p.x,n=e.q.s*o.x+e.q.c*o.y+e.p.y,r=s-i.p.x,m=n-i.p.y,a=i.q.c*r+i.q.s*m,h=-i.q.s*r+i.q.c*m;return t.x=a,t.y=h,t}function tL(t,e,i){var o=e.q.c*i.q.c+e.q.s*i.q.s,s=e.q.c*i.q.s-e.q.s*i.q.c,n=e.q.c*(i.p.x-e.p.x)+e.q.s*(i.p.y-e.p.y),r=-e.q.s*(i.p.x-e.p.x)+e.q.c*(i.p.y-e.p.y);return t.q.c=o,t.q.s=s,t.p.x=n,t.p.y=r,t}var tF=Math.sin,tT=Math.cos,tq=Math.atan2,tk=function(){function t(e){if(!(this instanceof t))return new t(e);"number"==typeof e?this.setAngle(e):"object"==typeof e?this.setRot(e):this.setIdentity()}return t.neo=function(e){var i=Object.create(t.prototype);return i.setAngle(e),i},t.clone=function(e){var i=Object.create(t.prototype);return i.s=e.s,i.c=e.c,i},t.identity=function(){var e=Object.create(t.prototype);return e.s=0,e.c=1,e},t.isValid=function(t){return null!=t&&Number.isFinite(t.s)&&Number.isFinite(t.c)},t.assert=function(t){},t.prototype.setIdentity=function(){this.s=0,this.c=1},t.prototype.set=function(t){"object"==typeof t?(this.s=t.s,this.c=t.c):(this.s=tF(t),this.c=tT(t))},t.prototype.setRot=function(t){this.s=t.s,this.c=t.c},t.prototype.setAngle=function(t){this.s=tF(t),this.c=tT(t)},t.prototype.getAngle=function(){return tq(this.s,this.c)},t.prototype.getXAxis=function(){return N.neo(this.c,this.s)},t.prototype.getYAxis=function(){return N.neo(-this.s,this.c)},t.mul=function(e,i){if("c"in i&&"s"in i){var o=t.identity();return o.s=e.s*i.c+e.c*i.s,o.c=e.c*i.c-e.s*i.s,o}if("x"in i&&"y"in i)return N.neo(e.c*i.x-e.s*i.y,e.s*i.x+e.c*i.y)},t.mulRot=function(e,i){var o=t.identity();return o.s=e.s*i.c+e.c*i.s,o.c=e.c*i.c-e.s*i.s,o},t.mulVec2=function(t,e){return N.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},t.mulSub=function(t,e,i){var o=t.c*(e.x-i.x)-t.s*(e.y-i.y),s=t.s*(e.x-i.x)+t.c*(e.y-i.y);return N.neo(o,s)},t.mulT=function(e,i){if("c"in i&&"s"in i){var o=t.identity();return o.s=e.c*i.s-e.s*i.c,o.c=e.c*i.c+e.s*i.s,o}if("x"in i&&"y"in i)return N.neo(e.c*i.x+e.s*i.y,-e.s*i.x+e.c*i.y)},t.mulTRot=function(e,i){var o=t.identity();return o.s=e.c*i.s-e.s*i.c,o.c=e.c*i.c+e.s*i.s,o},t.mulTVec2=function(t,e){return N.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},t}(),tN=Math.atan2,tj=Math.PI,tD=to(0,0),tR=function(){function t(){this.localCenter=N.zero(),this.c=N.zero(),this.a=0,this.alpha0=0,this.c0=N.zero(),this.a0=0}return t.prototype.recycle=function(){tr(this.localCenter),tr(this.c),this.a=0,this.alpha0=0,tr(this.c0),this.a0=0},t.prototype.setTransform=function(t){tz(tD,t,this.localCenter),tn(this.c,tD),tn(this.c0,tD),this.a=this.a0=tN(t.q.s,t.q.c)},t.prototype.setLocalCenter=function(t,e){tn(this.localCenter,t),tz(tD,e,this.localCenter),tn(this.c,tD),tn(this.c0,tD)},t.prototype.getTransform=function(t,e){var i,o;void 0===e&&(e=0),(i=t.q).c=te(o=(1-e)*this.a0+e*this.a),i.s=tt(o),ty(t.p,1-e,this.c0,e,this.c),th(t.p,tV(tD,t.q,this.localCenter))},t.prototype.advance=function(t){var e=(t-this.alpha0)/(1-this.alpha0);ty(this.c0,e,this.c,1-e,this.c0),this.a0=e*this.a+(1-e)*this.a0,this.alpha0=t},t.prototype.forward=function(){this.a0=this.a,tn(this.c0,this.c)},t.prototype.normalize=function(){var t=P(this.a0,-tj,+tj);this.a-=this.a0-t,this.a0=t},t.prototype.set=function(t){tn(this.localCenter,t.localCenter),tn(this.c,t.c),this.a=t.a,this.alpha0=t.alpha0,tn(this.c0,t.c0),this.a0=t.a0},t}(),tO=function(){function t(e,i){if(!(this instanceof t))return new t(e,i);this.p=N.zero(),this.q=tk.identity(),void 0!==e&&this.p.setVec2(e),void 0!==i&&this.q.setAngle(i)}return t.clone=function(e){var i=Object.create(t.prototype);return i.p=N.clone(e.p),i.q=tk.clone(e.q),i},t.neo=function(e,i){var o=Object.create(t.prototype);return o.p=N.clone(e),o.q=tk.clone(i),o},t.identity=function(){var e=Object.create(t.prototype);return e.p=N.zero(),e.q=tk.identity(),e},t.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()},t.prototype.set=function(t,e){void 0===e?(this.p.set(t.p),this.q.set(t.q)):(this.p.set(t),this.q.set(e))},t.prototype.setNum=function(t,e){this.p.setVec2(t),this.q.setAngle(e)},t.prototype.setTransform=function(t){this.p.setVec2(t.p),this.q.setRot(t.q)},t.isValid=function(t){return null!=t&&N.isValid(t.p)&&tk.isValid(t.q)},t.assert=function(t){},t.mul=function(e,i){if(Array.isArray(i)){for(var o=[],s=0;s<i.length;s++)o[s]=t.mul(e,i[s]);return o}return"x"in i&&"y"in i?t.mulVec2(e,i):"p"in i&&"q"in i?t.mulXf(e,i):void 0},t.mulAll=function(e,i){for(var o=[],s=0;s<i.length;s++)o[s]=t.mul(e,i[s]);return o},t.mulFn=function(e){return function(i){return t.mul(e,i)}},t.mulVec2=function(t,e){var i=t.q.c*e.x-t.q.s*e.y+t.p.x,o=t.q.s*e.x+t.q.c*e.y+t.p.y;return N.neo(i,o)},t.mulXf=function(e,i){var o=t.identity();return o.q=tk.mulRot(e.q,i.q),o.p=N.add(tk.mulVec2(e.q,i.p),e.p),o},t.mulT=function(e,i){return"x"in i&&"y"in i?t.mulTVec2(e,i):"p"in i&&"q"in i?t.mulTXf(e,i):void 0},t.mulTVec2=function(t,e){var i=e.x-t.p.x,o=e.y-t.p.y,s=t.q.c*i+t.q.s*o,n=-t.q.s*i+t.q.c*o;return N.neo(s,n)},t.mulTXf=function(e,i){var o=t.identity();return o.q.setRot(tk.mulTRot(e.q,i.q)),o.p.setVec2(tk.mulTVec2(e.q,N.sub(i.p,e.p))),o},t}(),tE=function(){this.v=N.zero(),this.w=0},tY=Math.sin,tJ=Math.cos,tH=function(){function t(){this.c=N.zero(),this.a=0}return t.prototype.getTransform=function(t,e){return t.q.c=tJ(this.a),t.q.s=tY(this.a),t.p.x=this.c.x-(t.q.c*e.x-t.q.s*e.y),t.p.y=this.c.y-(t.q.s*e.x+t.q.c*e.y),t},t}();function tW(t,e,i,o){return t.q.c=tJ(o),t.q.s=tY(o),t.p.x=i.x-(t.q.c*e.x-t.q.s*e.y),t.p.y=i.y-(t.q.s*e.x+t.q.c*e.y),t}var tU=function(){function t(){this.style={},this.appData={}}return t.isValid=function(t){return null!=t&&"string"==typeof t.m_type&&"number"==typeof t.m_radius},t}(),tZ=new R,tK=new R,tX=to(0,0),tG={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535},tQ=function(t,e){this.aabb=new R,this.fixture=t,this.childIndex=e},t$=function(){function t(t,e,i){this.style={},this.appData={},e.shape?(i=e,e=e.shape):"number"==typeof i&&(i={density:i}),i=C(i,tG),this.m_body=t,this.m_friction=i.friction,this.m_restitution=i.restitution,this.m_density=i.density,this.m_isSensor=i.isSensor,this.m_filterGroupIndex=i.filterGroupIndex,this.m_filterCategoryBits=i.filterCategoryBits,this.m_filterMaskBits=i.filterMaskBits,this.m_shape=e,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var o=this.m_shape.getChildCount(),s=0;s<o;++s)this.m_proxies[s]=new tQ(this,s);this.m_userData=i.userData,"object"==typeof i.style&&null!==i.style&&(this.style=i.style)}return t.prototype._reset=function(){var t=this.getBody(),e=t.m_world.m_broadPhase;this.destroyProxies(e),this.m_shape._reset&&this.m_shape._reset();for(var i=this.m_shape.getChildCount(),o=0;o<i;++o)this.m_proxies[o]=new tQ(this,o);this.createProxies(e,t.m_xf),t.resetMassData()},t.prototype._serialize=function(){return{friction:this.m_friction,restitution:this.m_restitution,density:this.m_density,isSensor:this.m_isSensor,filterGroupIndex:this.m_filterGroupIndex,filterCategoryBits:this.m_filterCategoryBits,filterMaskBits:this.m_filterMaskBits,shape:this.m_shape}},t._deserialize=function(e,i,o){var s=o(tU,e.shape);return s&&new t(i,s,e)},t.prototype.getType=function(){return this.m_shape.m_type},t.prototype.getShape=function(){return this.m_shape},t.prototype.isSensor=function(){return this.m_isSensor},t.prototype.setSensor=function(t){t!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=t)},t.prototype.getUserData=function(){return this.m_userData},t.prototype.setUserData=function(t){this.m_userData=t},t.prototype.getBody=function(){return this.m_body},t.prototype.getNext=function(){return this.m_next},t.prototype.getDensity=function(){return this.m_density},t.prototype.setDensity=function(t){this.m_density=t},t.prototype.getFriction=function(){return this.m_friction},t.prototype.setFriction=function(t){this.m_friction=t},t.prototype.getRestitution=function(){return this.m_restitution},t.prototype.setRestitution=function(t){this.m_restitution=t},t.prototype.testPoint=function(t){return this.m_shape.testPoint(this.m_body.getTransform(),t)},t.prototype.rayCast=function(t,e,i){return this.m_shape.rayCast(t,e,this.m_body.getTransform(),i)},t.prototype.getMassData=function(t){this.m_shape.computeMass(t,this.m_density)},t.prototype.getAABB=function(t){return this.m_proxies[t].aabb},t.prototype.createProxies=function(t,e){this.m_proxyCount=this.m_shape.getChildCount();for(var i=0;i<this.m_proxyCount;++i){var o=this.m_proxies[i];this.m_shape.computeAABB(o.aabb,e,i),o.proxyId=t.createProxy(o.aabb,o)}},t.prototype.destroyProxies=function(t){for(var e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];t.destroyProxy(i.proxyId),i.proxyId=null}this.m_proxyCount=0},t.prototype.synchronize=function(t,e,i){for(var o=0;o<this.m_proxyCount;++o){var s=this.m_proxies[o];this.m_shape.computeAABB(tZ,e,s.childIndex),this.m_shape.computeAABB(tK,i,s.childIndex),s.aabb.combine(tZ,tK),tc(tX,i.p,e.p),t.moveProxy(s.proxyId,s.aabb,tX)}},t.prototype.setFilterData=function(t){this.m_filterGroupIndex=t.groupIndex,this.m_filterCategoryBits=t.categoryBits,this.m_filterMaskBits=t.maskBits,this.refilter()},t.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex},t.prototype.setFilterGroupIndex=function(t){this.m_filterGroupIndex=t,this.refilter()},t.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits},t.prototype.setFilterCategoryBits=function(t){this.m_filterCategoryBits=t,this.refilter()},t.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits},t.prototype.setFilterMaskBits=function(t){this.m_filterMaskBits=t,this.refilter()},t.prototype.refilter=function(){if(null!=this.m_body){for(var t=this.m_body.getContactList();t;){var e=t.contact,i=e.getFixtureA(),o=e.getFixtureB();(i==this||o==this)&&e.flagForFiltering(),t=t.next}var s=this.m_body.getWorld();if(null!=s)for(var n=s.m_broadPhase,r=0;r<this.m_proxyCount;++r)n.touchProxy(this.m_proxies[r].proxyId)}},t.prototype.shouldCollide=function(t){if(t.m_filterGroupIndex===this.m_filterGroupIndex&&0!==t.m_filterGroupIndex)return t.m_filterGroupIndex>0;var e=(t.m_filterMaskBits&this.m_filterCategoryBits)!=0,i=(t.m_filterCategoryBits&this.m_filterMaskBits)!=0;return e&&i},t}(),t0="static",t1="kinematic",t2="dynamic",t3=to(0,0),t5=to(0,0),t9=to(0,0),t4=to(0,0),t8=tC(0,0,0),t6={type:t0,position:N.zero(),angle:0,linearVelocity:N.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null},t7=function(){function t(t,e){this.style={},this.appData={},e=C(e,t6),this.m_world=t,this.m_awakeFlag=e.awake,this.m_autoSleepFlag=e.allowSleep,this.m_bulletFlag=e.bullet,this.m_fixedRotationFlag=e.fixedRotation,this.m_activeFlag=e.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=e.userData,this.m_type=e.type,this.m_type==t2?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=tO.identity(),this.m_xf.p.setVec2(e.position),this.m_xf.q.setAngle(e.angle),this.m_sweep=new tR,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new tE,this.c_position=new tH,this.m_force=N.zero(),this.m_torque=0,this.m_linearVelocity=N.clone(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null,this.m_destroyed=!1,"object"==typeof e.style&&null!==e.style&&(this.style=e.style)}return t.prototype._serialize=function(){for(var t=[],e=this.m_fixtureList;e;e=e.m_next)t.push(e);return{type:this.m_type,bullet:this.m_bulletFlag,position:this.m_xf.p,angle:this.m_xf.q.getAngle(),linearVelocity:this.m_linearVelocity,angularVelocity:this.m_angularVelocity,fixtures:t}},t._deserialize=function(e,i,o){var s=new t(i,e);if(e.fixtures)for(var n=e.fixtures.length-1;n>=0;n--){var r=o(t$,e.fixtures[n],s);s._addFixture(r)}return s},t.prototype.isWorldLocked=function(){return!!(this.m_world&&this.m_world.isLocked())},t.prototype.getWorld=function(){return this.m_world},t.prototype.getNext=function(){return this.m_next},t.prototype.setUserData=function(t){this.m_userData=t},t.prototype.getUserData=function(){return this.m_userData},t.prototype.getFixtureList=function(){return this.m_fixtureList},t.prototype.getJointList=function(){return this.m_jointList},t.prototype.getContactList=function(){return this.m_contactList},t.prototype.isStatic=function(){return this.m_type==t0},t.prototype.isDynamic=function(){return this.m_type==t2},t.prototype.isKinematic=function(){return this.m_type==t1},t.prototype.setStatic=function(){return this.setType(t0),this},t.prototype.setDynamic=function(){return this.setType(t2),this},t.prototype.setKinematic=function(){return this.setType(t1),this},t.prototype.getType=function(){return this.m_type},t.prototype.setType=function(t){if(!0!=this.isWorldLocked()&&this.m_type!=t){this.m_type=t,this.resetMassData(),this.m_type==t0&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var i=e;e=e.next,this.m_world.destroyContact(i.contact)}this.m_contactList=null;for(var o=this.m_world.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)for(var n=0;n<s.m_proxyCount;++n)o.touchProxy(s.m_proxies[n].proxyId)}},t.prototype.isBullet=function(){return this.m_bulletFlag},t.prototype.setBullet=function(t){this.m_bulletFlag=!!t},t.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag},t.prototype.setSleepingAllowed=function(t){this.m_autoSleepFlag=!!t,!1==this.m_autoSleepFlag&&this.setAwake(!0)},t.prototype.isAwake=function(){return this.m_awakeFlag},t.prototype.setAwake=function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},t.prototype.isActive=function(){return this.m_activeFlag},t.prototype.setActive=function(t){if(t!=this.m_activeFlag)if(this.m_activeFlag=!!t,this.m_activeFlag){for(var e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.createProxies(e,this.m_xf);this.m_world.m_newFixture=!0}else{for(var e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.destroyProxies(e);for(var o=this.m_contactList;o;){var s=o;o=o.next,this.m_world.destroyContact(s.contact)}this.m_contactList=null}},t.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag},t.prototype.setFixedRotation=function(t){this.m_fixedRotationFlag!=t&&(this.m_fixedRotationFlag=!!t,this.m_angularVelocity=0,this.resetMassData())},t.prototype.getTransform=function(){return this.m_xf},t.prototype.setTransform=function(t,e){if(!0!=this.isWorldLocked()){"number"==typeof e?this.m_xf.setNum(t,e):this.m_xf.setTransform(t),this.m_sweep.setTransform(this.m_xf);for(var i=this.m_world.m_broadPhase,o=this.m_fixtureList;o;o=o.m_next)o.synchronize(i,this.m_xf,this.m_xf);this.setAwake(!0)}},t.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)},t.prototype.synchronizeFixtures=function(){this.m_sweep.getTransform(t8,0);for(var t=this.m_world.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.synchronize(t,t8,this.m_xf)},t.prototype.advance=function(t){this.m_sweep.advance(t),tn(this.m_sweep.c,this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)},t.prototype.getPosition=function(){return this.m_xf.p},t.prototype.setPosition=function(t){this.setTransform(t,this.m_sweep.a)},t.prototype.getAngle=function(){return this.m_sweep.a},t.prototype.setAngle=function(t){this.setTransform(this.m_xf.p,t)},t.prototype.getWorldCenter=function(){return this.m_sweep.c},t.prototype.getLocalCenter=function(){return this.m_sweep.localCenter},t.prototype.getLinearVelocity=function(){return this.m_linearVelocity},t.prototype.getLinearVelocityFromWorldPoint=function(t){var e=N.sub(t,this.m_sweep.c);return N.add(this.m_linearVelocity,N.crossNumVec2(this.m_angularVelocity,e))},t.prototype.getLinearVelocityFromLocalPoint=function(t){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(t))},t.prototype.setLinearVelocity=function(t){this.m_type!=t0&&(N.dot(t,t)>0&&this.setAwake(!0),this.m_linearVelocity.setVec2(t))},t.prototype.getAngularVelocity=function(){return this.m_angularVelocity},t.prototype.setAngularVelocity=function(t){this.m_type!=t0&&(t*t>0&&this.setAwake(!0),this.m_angularVelocity=t)},t.prototype.getLinearDamping=function(){return this.m_linearDamping},t.prototype.setLinearDamping=function(t){this.m_linearDamping=t},t.prototype.getAngularDamping=function(){return this.m_angularDamping},t.prototype.setAngularDamping=function(t){this.m_angularDamping=t},t.prototype.getGravityScale=function(){return this.m_gravityScale},t.prototype.setGravityScale=function(t){this.m_gravityScale=t},t.prototype.getMass=function(){return this.m_mass},t.prototype.getInertia=function(){return this.m_I+this.m_mass*N.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)},t.prototype.getMassData=function(t){t.mass=this.m_mass,t.I=this.getInertia(),tn(t.center,this.m_sweep.localCenter)},t.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,tr(this.m_sweep.localCenter),this.isStatic()||this.isKinematic()){tn(this.m_sweep.c0,this.m_xf.p),tn(this.m_sweep.c,this.m_xf.p),this.m_sweep.a0=this.m_sweep.a;return}tr(t5);for(var t=this.m_fixtureList;t;t=t.m_next)if(0!=t.m_density){var e={mass:0,center:to(0,0),I:0};t.getMassData(e),this.m_mass+=e.mass,tu(t5,e.mass,e.center),this.m_I+=e.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,tl(t5,this.m_invMass,t5)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!1==this.m_fixedRotationFlag?(this.m_I-=this.m_mass*tg(t5,t5),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0),tn(t3,this.m_sweep.c),this.m_sweep.setLocalCenter(t5,this.m_xf),tc(t9,this.m_sweep.c,t3),tx(t4,this.m_angularVelocity,t9),ta(this.m_linearVelocity,t4)},t.prototype.setMassData=function(t){!0==this.isWorldLocked()||this.m_type==t2&&(this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&!1==this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*tg(t.center,t.center),this.m_invI=1/this.m_I),tn(t3,this.m_sweep.c),this.m_sweep.setLocalCenter(t.center,this.m_xf),tc(t9,this.m_sweep.c,t3),tx(t4,this.m_angularVelocity,t9),ta(this.m_linearVelocity,t4))},t.prototype.applyForce=function(t,e,i){void 0===i&&(i=!0),this.m_type==t2&&(i&&!1==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(t),this.m_torque+=N.crossVec2Vec2(N.sub(e,this.m_sweep.c),t)))},t.prototype.applyForceToCenter=function(t,e){void 0===e&&(e=!0),this.m_type==t2&&(e&&!1==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(t))},t.prototype.applyTorque=function(t,e){void 0===e&&(e=!0),this.m_type==t2&&(e&&!1==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},t.prototype.applyLinearImpulse=function(t,e,i){void 0===i&&(i=!0),this.m_type==t2&&(i&&!1==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.addMul(this.m_invMass,t),this.m_angularVelocity+=this.m_invI*N.crossVec2Vec2(N.sub(e,this.m_sweep.c),t)))},t.prototype.applyAngularImpulse=function(t,e){void 0===e&&(e=!0),this.m_type==t2&&(e&&!1==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},t.prototype.shouldCollide=function(t){if(this.m_type!=t2&&t.m_type!=t2)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&!1==e.joint.m_collideConnected)return!1;return!0},t.prototype._addFixture=function(t){if(!0==this.isWorldLocked())return null;if(this.m_activeFlag){var e=this.m_world.m_broadPhase;t.createProxies(e,this.m_xf)}return t.m_next=this.m_fixtureList,this.m_fixtureList=t,t.m_density>0&&this.resetMassData(),this.m_world.m_newFixture=!0,t},t.prototype.createFixture=function(t,e){if(!0==this.isWorldLocked())return null;var i=new t$(this,t,e);return this._addFixture(i),i},t.prototype.destroyFixture=function(t){if(!0!=this.isWorldLocked()){if(this.m_fixtureList===t)this.m_fixtureList=t.m_next;else for(var e=this.m_fixtureList;null!=e;){if(e.m_next===t){e.m_next=t.m_next;break}e=e.m_next}for(var i=this.m_contactList;i;){var o=i.contact;i=i.next;var s=o.getFixtureA(),n=o.getFixtureB();(t==s||t==n)&&this.m_world.destroyContact(o)}if(this.m_activeFlag){var r=this.m_world.m_broadPhase;t.destroyProxies(r)}t.m_body=null,t.m_next=null,this.m_world.publish("remove-fixture",t),this.resetMassData()}},t.prototype.getWorldPoint=function(t){return tO.mulVec2(this.m_xf,t)},t.prototype.getWorldVector=function(t){return tk.mulVec2(this.m_xf.q,t)},t.prototype.getLocalPoint=function(t){return tO.mulTVec2(this.m_xf,t)},t.prototype.getLocalVector=function(t){return tk.mulTVec2(this.m_xf.q,t)},t.STATIC="static",t.KINEMATIC="kinematic",t.DYNAMIC="dynamic",t}(),et=function(){this.other=null,this.joint=null,this.prev=null,this.next=null},ee=function(){function t(t,e,i){this.m_type="unknown-joint",this.m_prev=null,this.m_next=null,this.m_edgeA=new et,this.m_edgeB=new et,this.m_islandFlag=!1,this.style={},this.appData={},e="bodyA"in t?t.bodyA:e,i="bodyB"in t?t.bodyB:i,this.m_bodyA=e,this.m_bodyB=i,this.m_collideConnected=!!t.collideConnected,this.m_userData=t.userData,"object"==typeof t.style&&null!==t.style&&(this.style=t.style)}return t.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},t.prototype.getType=function(){return this.m_type},t.prototype.getBodyA=function(){return this.m_bodyA},t.prototype.getBodyB=function(){return this.m_bodyB},t.prototype.getNext=function(){return this.m_next},t.prototype.getUserData=function(){return this.m_userData},t.prototype.setUserData=function(t){this.m_userData=t},t.prototype.getCollideConnected=function(){return this.m_collideConnected},t.prototype.shiftOrigin=function(t){},t.prototype._resetAnchors=function(t){return this._reset(t)},t}(),ei={gjkCalls:0,gjkIters:0,gjkMaxIters:0,toiTime:0,toiMaxTime:0,toiCalls:0,toiIters:0,toiMaxIters:0,toiRootIters:0,toiMaxRootIters:0,toString:function(t){t="string"==typeof t?t:"\n";var e="";for(var i in this)"function"!=typeof this[i]&&"object"!=typeof this[i]&&(e+=i+": "+this[i]+t);return e}},eo=Math.max,es=to(0,0),en=to(0,0),er=to(0,0),em=to(0,0),ea=to(0,0),eh=to(0,0),ec=to(0,0);ei.gjkCalls=0,ei.gjkIters=0,ei.gjkMaxIters=0;var e_=function(){function t(){this.proxyA=new ey,this.proxyB=new ey,this.transformA=tO.identity(),this.transformB=tO.identity(),this.useRadii=!1}return t.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.transformA.setIdentity(),this.transformB.setIdentity(),this.useRadii=!1},t}(),el=function(){function t(){this.pointA=to(0,0),this.pointB=to(0,0),this.distance=0,this.iterations=0}return t.prototype.recycle=function(){tr(this.pointA),tr(this.pointB),this.distance=0,this.iterations=0},t}(),eu=function(){function t(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0}return t.prototype.recycle=function(){this.metric=0,this.indexA.length=0,this.indexB.length=0,this.count=0},t}(),ep=function(t,e,i){++ei.gjkCalls;var o=i.proxyA,s=i.proxyB,n=i.transformA,r=i.transformB;ex.recycle(),ex.readCache(e,o,n,s,r);for(var m=ex.m_v,a=Y.maxDistanceIterations,h=[],c=[],_=0,l=0;l<a;){_=ex.m_count;for(var u=0;u<_;++u)h[u]=m[u].indexA,c[u]=m[u].indexB;if(ex.solve(),3===ex.m_count)break;var p=ex.getSearchDirection();if(tb(p)<1e-9*1e-9)break;var y=m[ex.m_count];y.indexA=o.getSupport(tM(es,n.q,tl(es,-1,p))),tz(y.wA,n,o.getVertex(y.indexA)),y.indexB=s.getSupport(tM(es,r.q,p)),tz(y.wB,r,s.getVertex(y.indexB)),tc(y.w,y.wB,y.wA),++l,++ei.gjkIters;for(var d=!1,u=0;u<_;++u)if(y.indexA===h[u]&&y.indexB===c[u]){d=!0;break}if(d)break;++ex.m_count}if(ei.gjkMaxIters=eo(ei.gjkMaxIters,l),ex.getWitnessPoints(t.pointA,t.pointB),t.distance=tB(t.pointA,t.pointB),t.iterations=l,ex.writeCache(e),i.useRadii){var f=o.m_radius,v=s.m_radius;if(t.distance>f+v&&t.distance>1e-9)t.distance-=f+v,tc(en,t.pointB,t.pointA),tf(en),tu(t.pointA,f,en),tp(t.pointB,v,en);else{var x=tc(es,t.pointA,t.pointB);tn(t.pointA,x),tn(t.pointB,x),t.distance=0}}},ey=function(){function t(){this.m_vertices=[],this.m_count=0,this.m_radius=0}return t.prototype.recycle=function(){this.m_vertices.length=0,this.m_count=0,this.m_radius=0},t.prototype.getVertexCount=function(){return this.m_count},t.prototype.getVertex=function(t){return this.m_vertices[t]},t.prototype.getSupport=function(t){for(var e=-1,i=-1/0,o=0;o<this.m_count;++o){var s=tg(this.m_vertices[o],t);s>i&&(e=o,i=s)}return e},t.prototype.getSupportVertex=function(t){return this.m_vertices[this.getSupport(t)]},t.prototype.set=function(t,e){t.computeDistanceProxy(this,e)},t.prototype.setVertices=function(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i},t}(),ed=function(){function t(){this.wA=to(0,0),this.indexA=0,this.wB=to(0,0),this.indexB=0,this.w=to(0,0),this.a=0}return t.prototype.recycle=function(){this.indexA=0,this.indexB=0,tr(this.wA),tr(this.wB),tr(this.w),this.a=0},t.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,tn(this.wA,t.wA),tn(this.wB,t.wB),tn(this.w,t.w),this.a=t.a},t}(),ef=to(0,0),ev=to(0,0),ex=new(function(){function t(){this.m_v1=new ed,this.m_v2=new ed,this.m_v3=new ed,this.m_v=[this.m_v1,this.m_v2,this.m_v3]}return t.prototype.recycle=function(){this.m_v1.recycle(),this.m_v2.recycle(),this.m_v3.recycle(),this.m_count=0},t.prototype.toString=function(){return 3===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():2===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():1===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count},t.prototype.readCache=function(t,e,i,o,s){this.m_count=t.count;for(var n=0;n<this.m_count;++n){var r=this.m_v[n];r.indexA=t.indexA[n],r.indexB=t.indexB[n];var m=e.getVertex(r.indexA),a=o.getVertex(r.indexB);tz(r.wA,i,m),tz(r.wB,s,a),tc(r.w,r.wB,r.wA),r.a=0}if(this.m_count>1){var h=t.metric,c=this.getMetric();(c<.5*h||2*h<c||c<1e-9)&&(this.m_count=0)}if(0===this.m_count){var r=this.m_v[0];r.indexA=0,r.indexB=0;var m=e.getVertex(0),a=o.getVertex(0);tz(r.wA,i,m),tz(r.wB,s,a),tc(r.w,r.wB,r.wA),r.a=1,this.m_count=1}},t.prototype.writeCache=function(t){t.metric=this.getMetric(),t.count=this.m_count;for(var e=0;e<this.m_count;++e)t.indexA[e]=this.m_v[e].indexA,t.indexB[e]=this.m_v[e].indexB},t.prototype.getSearchDirection=function(){var t=this.m_v1,e=this.m_v2;switch(this.m_count){case 1:return ts(ef,-t.w.x,-t.w.y);case 2:if(tc(er,e.w,t.w),-tA(er,t.w)>0)return ts(ef,-er.y,er.x);return ts(ef,er.y,-er.x);default:return tr(ef)}},t.prototype.getClosestPoint=function(){var t=this.m_v1,e=this.m_v2;switch(this.m_count){case 0:case 3:default:return tr(ev);case 1:return tn(ev,t.w);case 2:return ty(ev,t.a,t.w,e.a,e.w)}},t.prototype.getWitnessPoints=function(t,e){var i=this.m_v1,o=this.m_v2,s=this.m_v3;switch(this.m_count){case 0:break;case 1:tn(t,i.wA),tn(e,i.wB);break;case 2:ty(t,i.a,i.wA,o.a,o.wA),ty(e,i.a,i.wB,o.a,o.wB);break;case 3:td(t,i.a,i.wA,o.a,o.wA,s.a,s.wA),tn(e,t)}},t.prototype.getMetric=function(){switch(this.m_count){case 0:case 1:default:return 0;case 2:return tB(this.m_v1.w,this.m_v2.w);case 3:return tA(tc(eh,this.m_v2.w,this.m_v1.w),tc(ec,this.m_v3.w,this.m_v1.w))}},t.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3()}},t.prototype.solve2=function(){var t=this.m_v1.w,e=this.m_v2.w;tc(er,e,t);var i=-tg(t,er);if(i<=0){this.m_v1.a=1,this.m_count=1;return}var o=tg(e,er);if(o<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.set(this.m_v2);return}var s=1/(o+i);this.m_v1.a=o*s,this.m_v2.a=i*s,this.m_count=2},t.prototype.solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w;tc(er,e,t);var o=tg(t,er),s=tg(e,er),n=-o;tc(em,i,t);var r=tg(t,em),m=tg(i,em),a=-r;tc(ea,i,e);var h=tg(e,ea),c=tg(i,ea),_=-h,l=tA(er,em),u=l*tA(e,i),p=l*tA(i,t),y=l*tA(t,e);if(n<=0&&a<=0){this.m_v1.a=1,this.m_count=1;return}if(s>0&&n>0&&y<=0){var d=1/(s+n);this.m_v1.a=s*d,this.m_v2.a=n*d,this.m_count=2;return}if(m>0&&a>0&&p<=0){var f=1/(m+a);this.m_v1.a=m*f,this.m_v3.a=a*f,this.m_count=2,this.m_v2.set(this.m_v3);return}if(s<=0&&_<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.set(this.m_v2);return}if(m<=0&&c<=0){this.m_v3.a=1,this.m_count=1,this.m_v1.set(this.m_v3);return}if(c>0&&_>0&&u<=0){var v=1/(c+_);this.m_v2.a=c*v,this.m_v3.a=_*v,this.m_count=2,this.m_v1.set(this.m_v3);return}var x=1/(u+p+y);this.m_v1.a=u*x,this.m_v2.a=p*x,this.m_v3.a=y*x,this.m_count=3},t}()),eA=new e_,eg=new eu,eb=new el,eB=function(t,e,i,o,s,n){return eA.recycle(),eA.proxyA.set(t,e),eA.proxyB.set(i,o),tI(eA.transformA,s),tI(eA.transformB,n),eA.useRadii=!0,eb.recycle(),eg.recycle(),ep(eb,eg,eA),eb.distance<1e-8};ep.testOverlap=eB,ep.Input=e_,ep.Output=el,ep.Proxy=ey,ep.Cache=eu,(function(){this.proxyA=new ey,this.proxyB=new ey,this.transformA=tO.identity(),this.transformB=tO.identity(),this.translationB=N.zero()}).prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.transformA.setIdentity(),this.transformB.setIdentity(),tr(this.translationB)};var ew=Math.abs,eV=Math.max,eM=function(){function t(){this.proxyA=new ey,this.proxyB=new ey,this.sweepA=new tR,this.sweepB=new tR}return t.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.sweepA.recycle(),this.sweepB.recycle(),this.tMax=-1},t}();(o=u||(u={}))[o.e_unset=-1]="e_unset",o[o.e_unknown=0]="e_unknown",o[o.e_failed=1]="e_failed",o[o.e_overlapped=2]="e_overlapped",o[o.e_touching=3]="e_touching",o[o.e_separated=4]="e_separated";var eC=function(){function t(){this.state=u.e_unset,this.t=-1}return t.prototype.recycle=function(){this.state=u.e_unset,this.t=-1},t}();ei.toiTime=0,ei.toiMaxTime=0,ei.toiCalls=0,ei.toiIters=0,ei.toiMaxIters=0,ei.toiRootIters=0,ei.toiMaxRootIters=0;var eI=new e_,ez=new el,eP=new eu,eS=tC(0,0,0),eL=tC(0,0,0),eF=to(0,0),eT=to(0,0),eq=to(0,0),ek=to(0,0),eN=to(0,0),ej=to(0,0),eD=to(0,0),eR=to(0,0),eO=function(t,e){var i,o=Date.now();++ei.toiCalls,t.state=u.e_unknown,t.t=e.tMax;var s=e.proxyA,n=e.proxyB,r=e.sweepA,m=e.sweepB;r.normalize(),m.normalize();var a=e.tMax,h=s.m_radius+n.m_radius,c=eV(Y.linearSlop,h-3*Y.linearSlop),_=.25*Y.linearSlop,l=0,p=Y.maxTOIIterations,y=0;for(eP.recycle(),eI.proxyA.setVertices(s.m_vertices,s.m_count,s.m_radius),eI.proxyB.setVertices(n.m_vertices,n.m_count,n.m_radius),eI.useRadii=!1;;){if(r.getTransform(eS,l),m.getTransform(eL,l),tI(eI.transformA,eS),tI(eI.transformB,eL),ep(ez,eP,eI),ez.distance<=0){t.state=u.e_overlapped,t.t=0;break}if(ez.distance<c+_){t.state=u.e_touching,t.t=l;break}eE.initialize(eP,s,r,n,m,l);for(var d=!1,f=a,v=0;;){var x=eE.findMinSeparation(f);if(x>c+_){t.state=u.e_separated,t.t=a,d=!0;break}if(x>c-_){l=f;break}var A=eE.evaluate(l);if(A<c-_){t.state=u.e_failed,t.t=l,d=!0;break}if(A<=c+_){t.state=u.e_touching,t.t=l,d=!0;break}for(var g=0,b=l,B=f;;){var w=void 0;w=1&g?b+(c-A)*(B-b)/(x-A):.5*(b+B),++g,++ei.toiRootIters;var V=eE.evaluate(w);if(ew(V-c)<_){f=w;break}if(V>c?(b=w,A=V):(B=w,x=V),50===g)break}if(ei.toiMaxRootIters=eV(ei.toiMaxRootIters,g),++v===Y.maxPolygonVertices)break}if(++y,++ei.toiIters,d)break;if(y===p){t.state=u.e_failed,t.t=l;break}}ei.toiMaxIters=eV(ei.toiMaxIters,y);var M=(i=o,Date.now()-i);ei.toiMaxTime=eV(ei.toiMaxTime,M),ei.toiTime+=M,eE.recycle()};(s=p||(p={}))[s.e_unset=-1]="e_unset",s[s.e_points=1]="e_points",s[s.e_faceA=2]="e_faceA",s[s.e_faceB=3]="e_faceB";var eE=new(function(){function t(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=p.e_unset,this.m_localPoint=to(0,0),this.m_axis=to(0,0),this.indexA=-1,this.indexB=-1}return t.prototype.recycle=function(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=p.e_unset,tr(this.m_localPoint),tr(this.m_axis),this.indexA=-1,this.indexB=-1},t.prototype.initialize=function(t,e,i,o,s,n){var r=t.count;if(this.m_proxyA=e,this.m_proxyB=o,this.m_sweepA=i,this.m_sweepB=s,this.m_sweepA.getTransform(eS,n),this.m_sweepB.getTransform(eL,n),1===r){this.m_type=p.e_points;var m=this.m_proxyA.getVertex(t.indexA[0]),a=this.m_proxyB.getVertex(t.indexB[0]);tz(eT,eS,m),tz(eq,eL,a),tc(this.m_axis,eq,eT);var h=function(t){var e=ti(t.x*t.x+t.y*t.y);if(0!==e){var i=1/e;t.x*=i,t.y*=i}return e}(this.m_axis);return h}if(t.indexA[0]===t.indexA[1]){this.m_type=p.e_faceB;var c=o.getVertex(t.indexB[0]),_=o.getVertex(t.indexB[1]);tv(this.m_axis,tc(eF,_,c),1),tf(this.m_axis),tV(ek,eL.q,this.m_axis),ty(this.m_localPoint,.5,c,.5,_),tz(eq,eL,this.m_localPoint);var l=e.getVertex(t.indexA[0]),h=tg(tO.mulVec2(eS,l),ek)-tg(eq,ek);return h<0&&(tm(this.m_axis),h=-h),h}this.m_type=p.e_faceA;var u=this.m_proxyA.getVertex(t.indexA[0]),y=this.m_proxyA.getVertex(t.indexA[1]);tv(this.m_axis,tc(eF,y,u),1),tf(this.m_axis),tV(ek,eS.q,this.m_axis),ty(this.m_localPoint,.5,u,.5,y),tz(eT,eS,this.m_localPoint),tz(eq,eL,this.m_proxyB.getVertex(t.indexB[0]));var h=tg(eq,ek)-tg(eT,ek);return h<0&&(tm(this.m_axis),h=-h),h},t.prototype.compute=function(t,e){switch(this.m_sweepA.getTransform(eS,e),this.m_sweepB.getTransform(eL,e),this.m_type){case p.e_points:t&&(tM(eN,eS.q,this.m_axis),tM(ej,eL.q,tl(eF,-1,this.m_axis)),this.indexA=this.m_proxyA.getSupport(eN),this.indexB=this.m_proxyB.getSupport(ej)),tn(eD,this.m_proxyA.getVertex(this.indexA)),tn(eR,this.m_proxyB.getVertex(this.indexB)),tz(eT,eS,eD),tz(eq,eL,eR);var i=tg(eq,this.m_axis)-tg(eT,this.m_axis);return i;case p.e_faceA:tV(ek,eS.q,this.m_axis),tz(eT,eS,this.m_localPoint),t&&(tM(ej,eL.q,tl(eF,-1,ek)),this.indexA=-1,this.indexB=this.m_proxyB.getSupport(ej)),tn(eR,this.m_proxyB.getVertex(this.indexB)),tz(eq,eL,eR);var i=tg(eq,ek)-tg(eT,ek);return i;case p.e_faceB:tV(ek,eL.q,this.m_axis),tz(eq,eL,this.m_localPoint),t&&(tM(eN,eS.q,tl(eF,-1,ek)),this.indexB=-1,this.indexA=this.m_proxyA.getSupport(eN)),tn(eD,this.m_proxyA.getVertex(this.indexA)),tz(eT,eS,eD);var i=tg(eT,ek)-tg(eq,ek);return i;default:return t&&(this.indexA=-1,this.indexB=-1),0}},t.prototype.findMinSeparation=function(t){return this.compute(!0,t)},t.prototype.evaluate=function(t){return this.compute(!1,t)},t}());eO.Input=eM,eO.Output=eC;var eY=Math.abs,eJ=Math.sqrt,eH=Math.min,eW=function(){function t(){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}return t.prototype.reset=function(t){this.dt>0&&(this.inv_dt0=this.inv_dt),this.dt=t,this.inv_dt=0==t?0:1/t,this.dtRatio=t*this.inv_dt0},t}(),eU=new eW,eZ=to(0,0),eK=to(0,0),eX=to(0,0),eG=new eM,eQ=new eC,e$=new tR,e0=new tR,e1=new tR,e2=function(){function t(t){this.contact=t,this.normals=[],this.tangents=[]}return t.prototype.recycle=function(){this.normals.length=0,this.tangents.length=0},Object.defineProperty(t.prototype,"normalImpulses",{get:function(){var t=this.contact,e=this.normals;e.length=0;for(var i=0;i<t.v_points.length;++i)e.push(t.v_points[i].normalImpulse);return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tangentImpulses",{get:function(){var t=this.contact,e=this.tangents;e.length=0;for(var i=0;i<t.v_points.length;++i)e.push(t.v_points[i].tangentImpulse);return e},enumerable:!1,configurable:!0}),t}(),e3=function(){function t(t){this.m_world=t,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}return t.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0},t.prototype.addBody=function(t){this.m_bodies.push(t)},t.prototype.addContact=function(t){this.m_contacts.push(t)},t.prototype.addJoint=function(t){this.m_joints.push(t)},t.prototype.solveWorld=function(t){for(var e=this.m_world,i=e.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1;for(var o=e.m_contactList;o;o=o.m_next)o.m_islandFlag=!1;for(var s=e.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;for(var n=this.m_stack,r=e.m_bodyList;r;r=r.m_next)if(!r.m_islandFlag&&!1!=r.isAwake()&&!1!=r.isActive()&&!r.isStatic()){for(this.clear(),n.push(r),r.m_islandFlag=!0;n.length>0;){var i=n.pop();if(this.addBody(i),i.m_awakeFlag=!0,!i.isStatic()){for(var m=i.m_contactList;m;m=m.next){var a=m.contact;if(!a.m_islandFlag&&!1!=a.isEnabled()&&!1!=a.isTouching()){var h=a.m_fixtureA.m_isSensor,c=a.m_fixtureB.m_isSensor;if(!h&&!c){this.addContact(a),a.m_islandFlag=!0;var _=m.other;_.m_islandFlag||(n.push(_),_.m_islandFlag=!0)}}}for(var l=i.m_jointList;l;l=l.next){if(!0!=l.joint.m_islandFlag){var _=l.other;!1!=_.isActive()&&(this.addJoint(l.joint),l.joint.m_islandFlag=!0,_.m_islandFlag||(n.push(_),_.m_islandFlag=!0))}}}}this.solveIsland(t);for(var u=0;u<this.m_bodies.length;++u){var i=this.m_bodies[u];i.isStatic()&&(i.m_islandFlag=!1)}}},t.prototype.solveIsland=function(t){for(var e=this.m_world,i=e.m_gravity,o=e.m_allowSleep,s=t.dt,n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n];tn(eZ,r.m_sweep.c);var m=r.m_sweep.a;tn(eK,r.m_linearVelocity);var a=r.m_angularVelocity;tn(r.m_sweep.c0,r.m_sweep.c),r.m_sweep.a0=r.m_sweep.a,r.isDynamic()&&(tu(eK,s*r.m_gravityScale,i),tu(eK,s*r.m_invMass,r.m_force),a+=s*r.m_invI*r.m_torque,tl(eK,1/(1+s*r.m_linearDamping),eK),a*=1/(1+s*r.m_angularDamping)),tn(r.c_position.c,eZ),r.c_position.a=m,tn(r.c_velocity.v,eK),r.c_velocity.w=a}for(var n=0;n<this.m_contacts.length;++n){var h=this.m_contacts[n];h.initConstraint(t)}for(var n=0;n<this.m_contacts.length;++n){var h=this.m_contacts[n];h.initVelocityConstraint(t)}if(t.warmStarting)for(var n=0;n<this.m_contacts.length;++n){var h=this.m_contacts[n];h.warmStartConstraint(t)}for(var n=0;n<this.m_joints.length;++n){var c=this.m_joints[n];c.initVelocityConstraints(t)}for(var n=0;n<t.velocityIterations;++n){for(var _=0;_<this.m_joints.length;++_){var c=this.m_joints[_];c.solveVelocityConstraints(t)}for(var _=0;_<this.m_contacts.length;++_){var h=this.m_contacts[_];h.solveVelocityConstraint(t)}}for(var n=0;n<this.m_contacts.length;++n){var h=this.m_contacts[n];h.storeConstraintImpulses(t)}for(var n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n];tn(eZ,r.c_position.c);var m=r.c_position.a;tn(eK,r.c_velocity.v);var a=r.c_velocity.w;tl(eX,s,eK);var l=tb(eX);if(l>Y.maxTranslationSquared){var u=Y.maxTranslation/eJ(l);t_(eK,u)}var p=s*a;if(p*p>Y.maxRotationSquared){var u=Y.maxRotation/eY(p);a*=u}tu(eZ,s,eK),m+=s*a,tn(r.c_position.c,eZ),r.c_position.a=m,tn(r.c_velocity.v,eK),r.c_velocity.w=a}for(var y=!1,n=0;n<t.positionIterations;++n){for(var d=0,_=0;_<this.m_contacts.length;++_){var h=this.m_contacts[_];d=eH(d,h.solvePositionConstraint(t))}for(var f=d>=-3*Y.linearSlop,v=!0,_=0;_<this.m_joints.length;++_){var c=this.m_joints[_],x=c.solvePositionConstraints(t);v=v&&x}if(f&&v){y=!0;break}}for(var n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n];tn(r.m_sweep.c,r.c_position.c),r.m_sweep.a=r.c_position.a,tn(r.m_linearVelocity,r.c_velocity.v),r.m_angularVelocity=r.c_velocity.w,r.synchronizeTransform()}if(this.postSolveIsland(),o){for(var A=1/0,g=Y.linearSleepToleranceSqr,b=Y.angularSleepToleranceSqr,n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n];r.isStatic()||(!1==r.m_autoSleepFlag||r.m_angularVelocity*r.m_angularVelocity>b||tb(r.m_linearVelocity)>g?(r.m_sleepTime=0,A=0):(r.m_sleepTime+=s,A=eH(A,r.m_sleepTime)))}if(A>=Y.timeToSleep&&y)for(var n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n];r.setAwake(!1)}}},t.prototype.solveWorldTOI=function(t){var e=this.m_world;if(e.m_stepComplete){for(var i=e.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1,i.m_sweep.alpha0=0;for(var o=e.m_contactList;o;o=o.m_next)o.m_toiFlag=!1,o.m_islandFlag=!1,o.m_toiCount=0,o.m_toi=1}for(;;){for(var s=null,n=1,r=e.m_contactList;r;r=r.m_next)if(!1!=r.isEnabled()&&!(r.m_toiCount>Y.maxSubSteps)){var m=1;if(r.m_toiFlag)m=r.m_toi;else{var a=r.getFixtureA(),h=r.getFixtureB();if(a.isSensor()||h.isSensor())continue;var c=a.getBody(),_=h.getBody(),l=c.isAwake()&&!c.isStatic(),p=_.isAwake()&&!_.isStatic();if(!1==l&&!1==p)continue;var y=c.isBullet()||!c.isDynamic(),d=_.isBullet()||!_.isDynamic();if(!1==y&&!1==d)continue;var f=c.m_sweep.alpha0;c.m_sweep.alpha0<_.m_sweep.alpha0?(f=_.m_sweep.alpha0,c.m_sweep.advance(f)):_.m_sweep.alpha0<c.m_sweep.alpha0&&(f=c.m_sweep.alpha0,_.m_sweep.advance(f));var v=r.getChildIndexA(),x=r.getChildIndexB();eG.proxyA.set(a.getShape(),v),eG.proxyB.set(h.getShape(),x),eG.sweepA.set(c.m_sweep),eG.sweepB.set(_.m_sweep),eG.tMax=1,eO(eQ,eG);var A=eQ.t;m=eQ.state==u.e_touching?eH(f+(1-f)*A,1):1,r.m_toi=m,r.m_toiFlag=!0}m<n&&(s=r,n=m)}if(null==s||.99999999<n){e.m_stepComplete=!0;break}var g=s.getFixtureA(),b=s.getFixtureB(),B=g.getBody(),w=b.getBody();if(e0.set(B.m_sweep),e1.set(w.m_sweep),B.advance(n),w.advance(n),s.update(e),s.m_toiFlag=!1,++s.m_toiCount,!1==s.isEnabled()||!1==s.isTouching()){s.setEnabled(!1),B.m_sweep.set(e0),w.m_sweep.set(e1),B.synchronizeTransform(),w.synchronizeTransform();continue}B.setAwake(!0),w.setAwake(!0),this.clear(),this.addBody(B),this.addBody(w),this.addContact(s),B.m_islandFlag=!0,w.m_islandFlag=!0,s.m_islandFlag=!0;for(var V=[B,w],M=0;M<V.length;++M){var C=V[M];if(C.isDynamic())for(var I=C.m_contactList;I;I=I.next){var z=I.contact;if(z.m_islandFlag)continue;var P=I.other;if(!P.isDynamic()||C.isBullet()||P.isBullet()){var S=z.m_fixtureA.m_isSensor,L=z.m_fixtureB.m_isSensor;if(!S&&!L){if(e$.set(P.m_sweep),!1==P.m_islandFlag&&P.advance(n),z.update(e),!1==z.isEnabled()||!1==z.isTouching()){P.m_sweep.set(e$),P.synchronizeTransform();continue}z.m_islandFlag=!0,this.addContact(z),P.m_islandFlag||(P.m_islandFlag=!0,P.isStatic()||P.setAwake(!0),this.addBody(P))}}}}eU.reset((1-n)*t.dt),eU.dtRatio=1,eU.positionIterations=20,eU.velocityIterations=t.velocityIterations,eU.warmStarting=!1,this.solveIslandTOI(eU,B,w);for(var M=0;M<this.m_bodies.length;++M){var C=this.m_bodies[M];if(C.m_islandFlag=!1,C.isDynamic()){C.synchronizeFixtures();for(var I=C.m_contactList;I;I=I.next)I.contact.m_toiFlag=!1,I.contact.m_islandFlag=!1}}if(e.findNewContacts(),e.m_subStepping){e.m_stepComplete=!1;break}}},t.prototype.solveIslandTOI=function(t,e,i){for(var o,o=0;o<this.m_bodies.length;++o){var s=this.m_bodies[o];tn(s.c_position.c,s.m_sweep.c),s.c_position.a=s.m_sweep.a,tn(s.c_velocity.v,s.m_linearVelocity),s.c_velocity.w=s.m_angularVelocity}for(var o=0;o<this.m_contacts.length;++o){var n=this.m_contacts[o];n.initConstraint(t)}for(var o=0;o<t.positionIterations;++o){for(var r=0,m=0;m<this.m_contacts.length;++m){var n=this.m_contacts[m];r=eH(r,n.solvePositionConstraintTOI(t,e,i))}if(r>=-1.5*Y.linearSlop)break}tn(e.m_sweep.c0,e.c_position.c),e.m_sweep.a0=e.c_position.a,tn(i.m_sweep.c0,i.c_position.c),i.m_sweep.a0=i.c_position.a;for(var o=0;o<this.m_contacts.length;++o){var n=this.m_contacts[o];n.initVelocityConstraint(t)}for(var o=0;o<t.velocityIterations;++o)for(var m=0;m<this.m_contacts.length;++m){var n=this.m_contacts[m];n.solveVelocityConstraint(t)}for(var a=t.dt,o=0;o<this.m_bodies.length;++o){var s=this.m_bodies[o];tn(eZ,s.c_position.c);var h=s.c_position.a;tn(eK,s.c_velocity.v);var c=s.c_velocity.w;tl(eX,a,eK);var _=tb(eX);if(_>Y.maxTranslationSquared){var l=Y.maxTranslation/eJ(_);t_(eK,l)}var u=a*c;if(u*u>Y.maxRotationSquared){var l=Y.maxRotation/eY(u);c*=l}tu(eZ,a,eK),h+=a*c,tn(s.c_position.c,eZ),s.c_position.a=h,tn(s.c_velocity.v,eK),s.c_velocity.w=c,tn(s.m_sweep.c,eZ),s.m_sweep.a=h,tn(s.m_linearVelocity,eK),s.m_angularVelocity=c,s.synchronizeTransform()}this.postSolveIsland()},t.prototype.postSolveIsland=function(){for(var t=0;t<this.m_contacts.length;++t){var e=this.m_contacts[t];this.m_world.postSolve(e,e.m_impulse)}},t}();e3.TimeStep=eW;var e5=function(){function t(t,e,i,o){"object"==typeof t&&null!==t?(this.ex=N.clone(t),this.ey=N.clone(e)):"number"==typeof t?(this.ex=N.neo(t,i),this.ey=N.neo(e,o)):(this.ex=N.zero(),this.ey=N.zero())}return t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&N.isValid(t.ex)&&N.isValid(t.ey)},t.assert=function(t){},t.prototype.set=function(t,e,i,o){"number"==typeof t&&"number"==typeof e&&"number"==typeof i&&"number"==typeof o?(this.ex.setNum(t,i),this.ey.setNum(e,o)):"object"==typeof t&&"object"==typeof e?(this.ex.setVec2(t),this.ey.setVec2(e)):"object"==typeof t&&(this.ex.setVec2(t.ex),this.ey.setVec2(t.ey))},t.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},t.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},t.prototype.getInverse=function(){var e=this.ex.x,i=this.ey.x,o=this.ex.y,s=this.ey.y,n=e*s-i*o;0!==n&&(n=1/n);var r=new t;return r.ex.x=n*s,r.ey.x=-n*i,r.ex.y=-n*o,r.ey.y=n*e,r},t.prototype.solve=function(t){var e=this.ex.x,i=this.ey.x,o=this.ex.y,s=this.ey.y,n=e*s-i*o;0!==n&&(n=1/n);var r=N.zero();return r.x=n*(s*t.x-i*t.y),r.y=n*(e*t.y-o*t.x),r},t.mul=function(e,i){if(i&&"x"in i&&"y"in i){var o=e.ex.x*i.x+e.ey.x*i.y,s=e.ex.y*i.x+e.ey.y*i.y;return N.neo(o,s)}if(i&&"ex"in i&&"ey"in i)return new t(e.ex.x*i.ex.x+e.ey.x*i.ex.y,e.ex.x*i.ey.x+e.ey.x*i.ey.y,e.ex.y*i.ex.x+e.ey.y*i.ex.y,e.ex.y*i.ey.x+e.ey.y*i.ey.y)},t.mulVec2=function(t,e){var i=t.ex.x*e.x+t.ey.x*e.y,o=t.ex.y*e.x+t.ey.y*e.y;return N.neo(i,o)},t.mulMat22=function(e,i){return new t(e.ex.x*i.ex.x+e.ey.x*i.ex.y,e.ex.x*i.ey.x+e.ey.x*i.ey.y,e.ex.y*i.ex.x+e.ey.y*i.ex.y,e.ex.y*i.ey.x+e.ey.y*i.ey.y)},t.mulT=function(e,i){return i&&"x"in i&&"y"in i?N.neo(N.dot(i,e.ex),N.dot(i,e.ey)):i&&"ex"in i&&"ey"in i?new t(N.neo(N.dot(e.ex,i.ex),N.dot(e.ey,i.ex)),N.neo(N.dot(e.ex,i.ey),N.dot(e.ey,i.ey))):void 0},t.mulTVec2=function(t,e){return N.neo(N.dot(e,t.ex),N.dot(e,t.ey))},t.mulTMat22=function(e,i){return new t(N.neo(N.dot(e.ex,i.ex),N.dot(e.ey,i.ex)),N.neo(N.dot(e.ex,i.ey),N.dot(e.ey,i.ey)))},t.abs=function(e){return new t(N.abs(e.ex),N.abs(e.ey))},t.add=function(e,i){return new t(N.add(e.ex,i.ex),N.add(e.ey,i.ey))},t}(),e9=Math.sqrt,e4=to(0,0),e8=to(0,0),e6=to(0,0),e7=to(0,0),it=to(0,0),ie=to(0,0),ii=to(0,0),io=to(0,0);(n=y||(y={}))[n.e_unset=-1]="e_unset",n[n.e_circles=0]="e_circles",n[n.e_faceA=1]="e_faceA",n[n.e_faceB=2]="e_faceB",(r=d||(d={}))[r.e_unset=-1]="e_unset",r[r.e_vertex=0]="e_vertex",r[r.e_face=1]="e_face",(m=f||(f={}))[m.nullState=0]="nullState",m[m.addState=1]="addState",m[m.persistState=2]="persistState",m[m.removeState=3]="removeState";var is=function(){function t(){this.v=to(0,0),this.id=new ia}return t.prototype.set=function(t){tn(this.v,t.v),this.id.set(t.id)},t.prototype.recycle=function(){tr(this.v),this.id.recycle()},t}(),ir=function(){function t(){this.localNormal=to(0,0),this.localPoint=to(0,0),this.points=[new im,new im],this.pointCount=0}return t.prototype.set=function(t){this.type=t.type,tn(this.localNormal,t.localNormal),tn(this.localPoint,t.localPoint),this.pointCount=t.pointCount,this.points[0].set(t.points[0]),this.points[1].set(t.points[1])},t.prototype.recycle=function(){this.type=y.e_unset,tr(this.localNormal),tr(this.localPoint),this.pointCount=0,this.points[0].recycle(),this.points[1].recycle()},t.prototype.getWorldManifold=function(t,e,i,o,s){if(0==this.pointCount)return t;(t=t||new ih).pointCount=this.pointCount;var n=t.normal,r=t.points,m=t.separations;switch(this.type){case y.e_circles:ts(n,1,0);var a=this.points[0];tz(e4,e,this.localPoint),tz(e8,o,a.localPoint),tc(ie,e8,e4);var h=tb(ie);h>1e-9*1e-9&&tl(n,1/e9(h),ie),ty(e7,1,e4,i,n),ty(it,1,e8,-s,n),ty(r[0],.5,e7,.5,it),m[0]=tg(tc(e6,it,e7),n);break;case y.e_faceA:tV(n,e.q,this.localNormal),tz(ii,e,this.localPoint);for(var c=0;c<this.pointCount;++c){var a=this.points[c];tz(io,o,a.localPoint),ty(e7,1,io,i-tg(tc(e6,io,ii),n),n),ty(it,1,io,-s,n),ty(r[c],.5,e7,.5,it),m[c]=tg(tc(e6,it,e7),n)}break;case y.e_faceB:tV(n,o.q,this.localNormal),tz(ii,o,this.localPoint);for(var c=0;c<this.pointCount;++c){var a=this.points[c];tz(io,e,a.localPoint),ty(it,1,io,s-tg(tc(e6,io,ii),n),n),ty(e7,1,io,-i,n),ty(r[c],.5,e7,.5,it),m[c]=tg(tc(e6,e7,it),n)}tm(n)}return t},t.clipSegmentToLine=i_,t.ClipVertex=is,t.getPointStates=ic,t.PointState=f,t}(),im=function(){function t(){this.localPoint=to(0,0),this.normalImpulse=0,this.tangentImpulse=0,this.id=new ia}return t.prototype.set=function(t){tn(this.localPoint,t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.set(t.id)},t.prototype.recycle=function(){tr(this.localPoint),this.normalImpulse=0,this.tangentImpulse=0,this.id.recycle()},t}(),ia=function(){function t(){this.key=-1,this.indexA=-1,this.indexB=-1,this.typeA=d.e_unset,this.typeB=d.e_unset}return t.prototype.setFeatures=function(t,e,i,o){this.indexA=t,this.indexB=i,this.typeA=e,this.typeB=o,this.key=this.indexA+4*this.indexB+16*this.typeA+64*this.typeB},t.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB,this.key=this.indexA+4*this.indexB+16*this.typeA+64*this.typeB},t.prototype.swapFeatures=function(){var t=this.indexA,e=this.indexB,i=this.typeA,o=this.typeB;this.indexA=e,this.indexB=t,this.typeA=o,this.typeB=i,this.key=this.indexA+4*this.indexB+16*this.typeA+64*this.typeB},t.prototype.recycle=function(){this.indexA=0,this.indexB=0,this.typeA=d.e_unset,this.typeB=d.e_unset,this.key=-1},t}(),ih=function(){function t(){this.normal=to(0,0),this.points=[to(0,0),to(0,0)],this.separations=[0,0],this.pointCount=0}return t.prototype.recycle=function(){tr(this.normal),tr(this.points[0]),tr(this.points[1]),this.separations[0]=0,this.separations[1]=0,this.pointCount=0},t}();function ic(t,e,i,o){for(var s=0;s<i.pointCount;++s){var n=i.points[s].id;t[s]=f.removeState;for(var r=0;r<o.pointCount;++r)if(o.points[r].id.key===n.key){t[s]=f.persistState;break}}for(var s=0;s<o.pointCount;++s){var n=o.points[s].id;e[s]=f.addState;for(var r=0;r<i.pointCount;++r)if(i.points[r].id.key===n.key){e[s]=f.persistState;break}}}function i_(t,e,i,o,s){var n=0,r=tg(i,e[0].v)-o,m=tg(i,e[1].v)-o;if(r<=0&&t[n++].set(e[0]),m<=0&&t[n++].set(e[1]),r*m<0){var a=r/(r-m);ty(t[n].v,1-a,e[0].v,a,e[1].v),t[n].id.setFeatures(s,d.e_vertex,e[0].id.indexB,d.e_face),++n}return n}var il=Math.sqrt,iu=Math.max,ip=Math.min,iy=new J({create:function(){return new iZ},release:function(t){t.recycle()}}),id=new ir,iv=new ih,ix=function(){function t(t){this.prev=null,this.next=null,this.other=null,this.contact=t}return t.prototype.recycle=function(){this.prev=null,this.next=null,this.other=null},t}(),iA=[],ig=function(){function t(){this.rA=to(0,0),this.rB=to(0,0),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return t.prototype.recycle=function(){tr(this.rA),tr(this.rB),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0},t}(),ib=to(0,0),iB=to(0,0),iw=to(0,0),iV=to(0,0),iM=to(0,0),iC=tC(0,0,0),iI=tC(0,0,0),iz=to(0,0),iP=to(0,0),iS=to(0,0),iL=to(0,0),iF=to(0,0),iT=to(0,0),iq=to(0,0),ik=to(0,0),iN=to(0,0),ij=to(0,0),iD=to(0,0),iR=to(0,0),iO=to(0,0),iE=to(0,0),iY=to(0,0),iJ=to(0,0),iH=to(0,0),iW=to(0,0),iU=to(0,0),iZ=function(){function t(){this.m_nodeA=new ix(this),this.m_nodeB=new ix(this),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=-1,this.m_indexB=-1,this.m_evaluateFcn=null,this.m_manifold=new ir,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse=new e2(this),this.v_points=[new ig,new ig],this.v_normal=to(0,0),this.v_normalMass=new e5,this.v_K=new e5,this.v_pointCount=0,this.v_tangentSpeed=0,this.v_friction=0,this.v_restitution=0,this.v_invMassA=0,this.v_invMassB=0,this.v_invIA=0,this.v_invIB=0,this.p_localPoints=[to(0,0),to(0,0)],this.p_localNormal=to(0,0),this.p_localPoint=to(0,0),this.p_localCenterA=to(0,0),this.p_localCenterB=to(0,0),this.p_type=y.e_unset,this.p_radiusA=0,this.p_radiusB=0,this.p_pointCount=0,this.p_invMassA=0,this.p_invMassB=0,this.p_invIA=0,this.p_invIB=0}return t.prototype.initialize=function(t,e,i,o,s){var n,r;this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=o,this.m_evaluateFcn=s,this.m_friction=il(this.m_fixtureA.m_friction*this.m_fixtureB.m_friction),this.m_restitution=(n=this.m_fixtureA.m_restitution)>(r=this.m_fixtureB.m_restitution)?n:r},t.prototype.recycle=function(){this.m_nodeA.recycle(),this.m_nodeB.recycle(),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=-1,this.m_indexB=-1,this.m_evaluateFcn=null,this.m_manifold.recycle(),this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse.recycle();for(var t=0,e=this.v_points;t<e.length;t++)e[t].recycle();tr(this.v_normal),this.v_normalMass.setZero(),this.v_K.setZero(),this.v_pointCount=0,this.v_tangentSpeed=0,this.v_friction=0,this.v_restitution=0,this.v_invMassA=0,this.v_invMassB=0,this.v_invIA=0,this.v_invIB=0;for(var i=0,o=this.p_localPoints;i<o.length;i++)tr(o[i]);tr(this.p_localNormal),tr(this.p_localPoint),tr(this.p_localCenterA),tr(this.p_localCenterB),this.p_type=y.e_unset,this.p_radiusA=0,this.p_radiusB=0,this.p_pointCount=0,this.p_invMassA=0,this.p_invMassB=0,this.p_invIA=0,this.p_invIB=0},t.prototype.initConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var o=e.m_body,s=i.m_body;if(null!==o&&null!==s){var n=e.m_shape,r=i.m_shape;if(null!==n&&null!==r){var m=this.m_manifold,a=m.pointCount;this.v_invMassA=o.m_invMass,this.v_invMassB=s.m_invMass,this.v_invIA=o.m_invI,this.v_invIB=s.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=a,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=o.m_invMass,this.p_invMassB=s.m_invMass,this.p_invIA=o.m_invI,this.p_invIB=s.m_invI,tn(this.p_localCenterA,o.m_sweep.localCenter),tn(this.p_localCenterB,s.m_sweep.localCenter),this.p_radiusA=n.m_radius,this.p_radiusB=r.m_radius,this.p_type=m.type,tn(this.p_localNormal,m.localNormal),tn(this.p_localPoint,m.localPoint),this.p_pointCount=a;for(var h=0;h<Y.maxManifoldPoints;++h)this.v_points[h].recycle(),tr(this.p_localPoints[h]);for(var h=0;h<a;++h){var c=m.points[h],_=this.v_points[h];t.warmStarting&&(_.normalImpulse=t.dtRatio*c.normalImpulse,_.tangentImpulse=t.dtRatio*c.tangentImpulse),tn(this.p_localPoints[h],c.localPoint)}}}}},t.prototype.getManifold=function(){return this.m_manifold},t.prototype.getWorldManifold=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var o=e.m_body,s=i.m_body;if(null!==o&&null!==s){var n=e.m_shape,r=i.m_shape;if(null!==n&&null!==r)return this.m_manifold.getWorldManifold(t,o.getTransform(),n.m_radius,s.getTransform(),r.m_radius)}}},t.prototype.setEnabled=function(t){this.m_enabledFlag=!!t},t.prototype.isEnabled=function(){return this.m_enabledFlag},t.prototype.isTouching=function(){return this.m_touchingFlag},t.prototype.getNext=function(){return this.m_next},t.prototype.getFixtureA=function(){return this.m_fixtureA},t.prototype.getFixtureB=function(){return this.m_fixtureB},t.prototype.getChildIndexA=function(){return this.m_indexA},t.prototype.getChildIndexB=function(){return this.m_indexB},t.prototype.flagForFiltering=function(){this.m_filterFlag=!0},t.prototype.setFriction=function(t){this.m_friction=t},t.prototype.getFriction=function(){return this.m_friction},t.prototype.resetFriction=function(){var t=this.m_fixtureA,e=this.m_fixtureB;null!==t&&null!==e&&(this.m_friction=il(t.m_friction*e.m_friction))},t.prototype.setRestitution=function(t){this.m_restitution=t},t.prototype.getRestitution=function(){return this.m_restitution},t.prototype.resetRestitution=function(){var t,e,i=this.m_fixtureA,o=this.m_fixtureB;null!==i&&null!==o&&(this.m_restitution=(t=i.m_restitution)>(e=o.m_restitution)?t:e)},t.prototype.setTangentSpeed=function(t){this.m_tangentSpeed=t},t.prototype.getTangentSpeed=function(){return this.m_tangentSpeed},t.prototype.evaluate=function(t,e,i){var o=this.m_fixtureA,s=this.m_fixtureB;null!==o&&null!==s&&this.m_evaluateFcn(t,e,o,this.m_indexA,i,s,this.m_indexB)},t.prototype.update=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var o=e.m_body,s=i.m_body;if(null!==o&&null!==s){var n=e.m_shape,r=i.m_shape;if(null!==n&&null!==r){this.m_enabledFlag=!0;var m=!1,a=this.m_touchingFlag,h=e.m_isSensor,c=i.m_isSensor,_=h||c,l=o.m_xf,u=s.m_xf;if(_)m=eB(n,this.m_indexA,r,this.m_indexB,l,u),this.m_manifold.pointCount=0;else{id.recycle(),id.set(this.m_manifold),this.m_manifold.recycle(),this.evaluate(this.m_manifold,l,u),m=this.m_manifold.pointCount>0;for(var p=0;p<this.m_manifold.pointCount;++p){var y=this.m_manifold.points[p];y.normalImpulse=0,y.tangentImpulse=0;for(var d=0;d<id.pointCount;++d){var f=id.points[d];if(f.id.key===y.id.key){y.normalImpulse=f.normalImpulse,y.tangentImpulse=f.tangentImpulse;break}}}m!==a&&(o.setAwake(!0),s.setAwake(!0))}this.m_touchingFlag=m;var v="object"==typeof t&&null!==t;!a&&m&&v&&t.beginContact(this),a&&!m&&v&&t.endContact(this),!_&&m&&v&&id&&t.preSolve(this,id)}}}},t.prototype.solvePositionConstraint=function(t){return this._solvePositionConstraint(t,null,null)},t.prototype.solvePositionConstraintTOI=function(t,e,i){return this._solvePositionConstraint(t,e,i)},t.prototype._solvePositionConstraint=function(t,e,i){var o=null!==e&&null!==i,s=0,n=this.m_fixtureA,r=this.m_fixtureB;if(null===n||null===r)return s;var m=n.m_body,a=r.m_body;if(null===m||null===a)return s;var h=m.c_position,c=a.c_position,_=this.p_localCenterA,l=this.p_localCenterB,u=0,p=0;o&&m!==e&&m!==i||(u=this.p_invMassA,p=this.p_invIA);var d=0,f=0;o&&a!==e&&a!==i||(d=this.p_invMassB,f=this.p_invIB),tn(ib,h.c);var v=h.a;tn(iw,c.c);for(var x=c.a,A=0;A<this.p_pointCount;++A){tW(iC,_,ib,v),tW(iI,l,iw,x);var g=void 0;switch(this.p_type){case y.e_circles:tz(iz,iC,this.p_localPoint),tz(iP,iI,this.p_localPoints[0]),tc(ik,iP,iz),tf(ik),ty(iN,.5,iz,.5,iP),g=tg(iP,ik)-tg(iz,ik)-this.p_radiusA-this.p_radiusB;break;case y.e_faceA:tV(ik,iC.q,this.p_localNormal),tz(iL,iC,this.p_localPoint),tz(iS,iI,this.p_localPoints[A]),g=tg(iS,ik)-tg(iL,ik)-this.p_radiusA-this.p_radiusB,tn(iN,iS);break;case y.e_faceB:tV(ik,iI.q,this.p_localNormal),tz(iL,iI,this.p_localPoint),tz(iS,iC,this.p_localPoints[A]),g=tg(iS,ik)-tg(iL,ik)-this.p_radiusA-this.p_radiusB,tn(iN,iS),tm(ik);break;default:return s}tc(iF,iN,ib),tc(iT,iN,iw),s=ip(s,g);var b=S((o?Y.toiBaugarte:Y.baumgarte)*(g+Y.linearSlop),-Y.maxLinearCorrection,0),B=tA(iF,ik),w=tA(iT,ik),V=u+d+p*B*B+f*w*w;tl(iq,V>0?-b/V:0,ik),tp(ib,u,iq),v-=p*tA(iF,iq),tu(iw,d,iq),x+=f*tA(iT,iq)}return tn(h.c,ib),h.a=v,tn(c.c,iw),c.a=x,s},t.prototype.initVelocityConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var o=e.m_body,s=i.m_body;if(null!==o&&null!==s){var n=o.c_velocity,r=s.c_velocity,m=o.c_position,a=s.c_position,h=this.p_radiusA,c=this.p_radiusB,_=this.m_manifold,l=this.v_invMassA,u=this.v_invMassB,p=this.v_invIA,y=this.v_invIB,d=this.p_localCenterA,f=this.p_localCenterB;tn(ib,m.c);var v=m.a;tn(iB,n.v);var x=n.w;tn(iw,a.c);var A=a.a;tn(iV,r.v);var g=r.w;tW(iC,d,ib,v),tW(iI,f,iw,A),iv.recycle(),_.getWorldManifold(iv,iC,h,iI,c),tn(this.v_normal,iv.normal);for(var b=0;b<this.v_pointCount;++b){var B,w=this.v_points[b],V=iv.points[b];tc(w.rA,V,ib),tc(w.rB,V,iw);var M=tA(w.rA,this.v_normal),C=tA(w.rB,this.v_normal),I=l+u+p*M*M+y*C*C;w.normalMass=I>0?1/I:0,tv(iM,this.v_normal,1);var z=tA(w.rA,iM),P=tA(w.rB,iM),S=l+u+p*z*z+y*P*P;w.tangentMass=S>0?1/S:0,w.velocityBias=0,(B=0+tg(this.v_normal,iV)+tg(this.v_normal,tx(iU,g,w.rB))-tg(this.v_normal,iB)-tg(this.v_normal,tx(iU,x,w.rA)))<-Y.velocityThreshold&&(w.velocityBias=-this.v_restitution*B)}if(2==this.v_pointCount&&t.blockSolve){var L=this.v_points[0],F=this.v_points[1],T=tA(L.rA,this.v_normal),q=tA(L.rB,this.v_normal),k=tA(F.rA,this.v_normal),N=tA(F.rB,this.v_normal),j=l+u+p*T*T+y*q*q,D=l+u+p*k*k+y*N*N,R=l+u+p*T*k+y*q*N;if(j*j<1e3*(j*D-R*R)){this.v_K.ex.setNum(j,R),this.v_K.ey.setNum(R,D);var O=this.v_K.ex.x,E=this.v_K.ey.x,J=this.v_K.ex.y,H=this.v_K.ey.y,W=O*H-E*J;0!==W&&(W=1/W),this.v_normalMass.ex.x=W*H,this.v_normalMass.ey.x=-W*E,this.v_normalMass.ex.y=-W*J,this.v_normalMass.ey.y=W*O}else this.v_pointCount=1}tn(m.c,ib),m.a=v,tn(n.v,iB),n.w=x,tn(a.c,iw),a.a=A,tn(r.v,iV),r.w=g}}},t.prototype.warmStartConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var o=e.m_body,s=i.m_body;if(null!==o&&null!==s){var n=o.c_velocity,r=s.c_velocity,m=this.v_invMassA,a=this.v_invIA,h=this.v_invMassB,c=this.v_invIB;tn(iB,n.v);var _=n.w;tn(iV,r.v);var l=r.w;tn(ik,this.v_normal),tv(iM,ik,1);for(var u=0;u<this.v_pointCount;++u){var p=this.v_points[u];ty(iq,p.normalImpulse,ik,p.tangentImpulse,iM),_-=a*tA(p.rA,iq),tp(iB,m,iq),l+=c*tA(p.rB,iq),tu(iV,h,iq)}tn(n.v,iB),n.w=_,tn(r.v,iV),r.w=l}}},t.prototype.storeConstraintImpulses=function(t){for(var e=this.m_manifold,i=0;i<this.v_pointCount;++i)e.points[i].normalImpulse=this.v_points[i].normalImpulse,e.points[i].tangentImpulse=this.v_points[i].tangentImpulse},t.prototype.solveVelocityConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var o=e.m_body,s=i.m_body;if(null!==o&&null!==s){var n=o.c_velocity,r=s.c_velocity,m=this.v_invMassA,a=this.v_invIA,h=this.v_invMassB,c=this.v_invIB;tn(iB,n.v);var _=n.w;tn(iV,r.v);var l=r.w;tn(ik,this.v_normal),tv(iM,ik,1);for(var u=this.v_friction,p=0;p<this.v_pointCount;++p){var y=this.v_points[p];tr(ij),ta(ij,iV),ta(ij,tx(iU,l,y.rB)),th(ij,iB),th(ij,tx(iU,_,y.rA));var d=tg(ij,iM)-this.v_tangentSpeed,f=-(y.tangentMass*d),v=u*y.normalImpulse,x=S(y.tangentImpulse+f,-v,v);f=x-y.tangentImpulse,y.tangentImpulse=x,tl(iq,f,iM),tp(iB,m,iq),_-=a*tA(y.rA,iq),tu(iV,h,iq),l+=c*tA(y.rB,iq)}if(1==this.v_pointCount||!1==t.blockSolve)for(var A=0;A<this.v_pointCount;++A){var y=this.v_points[A];tr(ij),ta(ij,iV),ta(ij,tx(iU,l,y.rB)),th(ij,iB),th(ij,tx(iU,_,y.rA));var g=tg(ij,ik),f=-y.normalMass*(g-y.velocityBias),x=iu(y.normalImpulse+f,0);f=x-y.normalImpulse,y.normalImpulse=x,tl(iq,f,ik),tp(iB,m,iq),_-=a*tA(y.rA,iq),tu(iV,h,iq),l+=c*tA(y.rB,iq)}else{var b=this.v_points[0],B=this.v_points[1];ts(iE,b.normalImpulse,B.normalImpulse),tr(iD),ta(iD,iV),ta(iD,tx(iU,l,b.rB)),th(iD,iB),th(iD,tx(iU,_,b.rA)),tr(iR),ta(iR,iV),ta(iR,tx(iU,l,B.rB)),th(iR,iB),th(iR,tx(iU,_,B.rA));var w=tg(iD,ik),V=tg(iR,ik);for(ts(iO,w-b.velocityBias,V-B.velocityBias),iO.x-=this.v_K.ex.x*iE.x+this.v_K.ey.x*iE.y,iO.y-=this.v_K.ex.y*iE.x+this.v_K.ey.y*iE.y;;){if(tr(iY),iY.x=-(this.v_normalMass.ex.x*iO.x+this.v_normalMass.ey.x*iO.y),iY.y=-(this.v_normalMass.ex.y*iO.x+this.v_normalMass.ey.y*iO.y),iY.x>=0&&iY.y>=0||(iY.x=-b.normalMass*iO.x,iY.y=0,w=0,V=this.v_K.ex.y*iY.x+iO.y,iY.x>=0&&V>=0)||(iY.x=0,iY.y=-B.normalMass*iO.y,w=this.v_K.ey.x*iY.y+iO.x,V=0,iY.y>=0&&w>=0)){tc(iJ,iY,iE),tl(iH,iJ.x,ik),tl(iW,iJ.y,ik),td(iB,-m,iH,-m,iW,1,iB),_-=a*(tA(b.rA,iH)+tA(B.rA,iW)),td(iV,h,iH,h,iW,1,iV),l+=c*(tA(b.rB,iH)+tA(B.rB,iW)),b.normalImpulse=iY.x,B.normalImpulse=iY.y;break}iY.x=0,iY.y=0,w=iO.x,V=iO.y,w>=0&&V>=0&&(tc(iJ,iY,iE),tl(iH,iJ.x,ik),tl(iW,iJ.y,ik),td(iB,-m,iH,-m,iW,1,iB),_-=a*(tA(b.rA,iH)+tA(B.rA,iW)),td(iV,h,iH,h,iW,1,iV),l+=c*(tA(b.rB,iH)+tA(B.rB,iW)),b.normalImpulse=iY.x,B.normalImpulse=iY.y);break}}tn(n.v,iB),n.w=_,tn(r.v,iV),r.w=l}}},t.addType=function(t,e,i){iA[t]=iA[t]||{},iA[t][e]=i},t.create=function(t,e,i,o){var s,n=t.m_shape.m_type,r=i.m_shape.m_type,m=iy.allocate();if(s=iA[n]&&iA[n][r])m.initialize(t,e,i,o,s);else{if(!(s=iA[r]&&iA[r][n]))return null;m.initialize(i,o,t,e,s)}t=m.m_fixtureA,i=m.m_fixtureB,e=m.getChildIndexA(),o=m.getChildIndexB();var a=t.m_body,h=i.m_body;return m.m_nodeA.contact=m,m.m_nodeA.other=h,m.m_nodeA.prev=null,m.m_nodeA.next=a.m_contactList,null!=a.m_contactList&&(a.m_contactList.prev=m.m_nodeA),a.m_contactList=m.m_nodeA,m.m_nodeB.contact=m,m.m_nodeB.other=a,m.m_nodeB.prev=null,m.m_nodeB.next=h.m_contactList,null!=h.m_contactList&&(h.m_contactList.prev=m.m_nodeB),h.m_contactList=m.m_nodeB,!1==t.isSensor()&&!1==i.isSensor()&&(a.setAwake(!0),h.setAwake(!0)),m},t.destroy=function(t,e){var i=t.m_fixtureA,o=t.m_fixtureB;if(null!==i&&null!==o){var s=i.m_body,n=o.m_body;null!==s&&null!==n&&(t.isTouching()&&e.endContact(t),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==s.m_contactList&&(s.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),!(t.m_manifold.pointCount>0)||i.m_isSensor||o.m_isSensor||(s.setAwake(!0),n.setAwake(!0)),iy.release(t))}},t}(),iK={gravity:N.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3},iX=function(){function t(e){if(!(this instanceof t))return new t(e);this.s_step=new eW,e?N.isValid(e)&&(e={gravity:e}):e={},e=C(e,iK),this.m_solver=new e3(this),this.m_broadPhase=new $,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=e.allowSleep,this.m_gravity=N.clone(e.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=e.warmStarting,this.m_continuousPhysics=e.continuousPhysics,this.m_subStepping=e.subStepping,this.m_blockSolve=e.blockSolve,this.m_velocityIterations=e.velocityIterations,this.m_positionIterations=e.positionIterations,this.m_t=0,this.m_step_callback=[]}return t.prototype._serialize=function(){for(var t=[],e=[],i=this.getBodyList();i;i=i.getNext())t.push(i);for(var o=this.getJointList();o;o=o.getNext())"function"==typeof o._serialize&&e.push(o);return{gravity:this.m_gravity,bodies:t,joints:e}},t._deserialize=function(e,i,o){if(!e)return new t;var s=new t(e.gravity);if(e.bodies)for(var n=e.bodies.length-1;n>=0;n-=1)s._addBody(o(t7,e.bodies[n],s));if(e.joints)for(var n=e.joints.length-1;n>=0;n--)s.createJoint(o(ee,e.joints[n],s));return s},t.prototype.getBodyList=function(){return this.m_bodyList},t.prototype.getJointList=function(){return this.m_jointList},t.prototype.getContactList=function(){return this.m_contactList},t.prototype.getBodyCount=function(){return this.m_bodyCount},t.prototype.getJointCount=function(){return this.m_jointCount},t.prototype.getContactCount=function(){return this.m_contactCount},t.prototype.setGravity=function(t){this.m_gravity.set(t)},t.prototype.getGravity=function(){return this.m_gravity},t.prototype.isLocked=function(){return this.m_locked},t.prototype.setAllowSleeping=function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,!1==this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.setAwake(!0)},t.prototype.getAllowSleeping=function(){return this.m_allowSleep},t.prototype.setWarmStarting=function(t){this.m_warmStarting=t},t.prototype.getWarmStarting=function(){return this.m_warmStarting},t.prototype.setContinuousPhysics=function(t){this.m_continuousPhysics=t},t.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics},t.prototype.setSubStepping=function(t){this.m_subStepping=t},t.prototype.getSubStepping=function(){return this.m_subStepping},t.prototype.setAutoClearForces=function(t){this.m_clearForces=t},t.prototype.getAutoClearForces=function(){return this.m_clearForces},t.prototype.clearForces=function(){for(var t=this.m_bodyList;t;t=t.getNext())t.m_force.setZero(),t.m_torque=0},t.prototype.queryAABB=function(t,e){var i=this.m_broadPhase;this.m_broadPhase.query(t,function(t){return e(i.getUserData(t).fixture)})},t.prototype.rayCast=function(t,e,i){var o=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:t,p2:e},function(t,e){var s=o.getUserData(e),n=s.fixture,r=s.childIndex,m={};if(n.rayCast(m,t,r)){var a=m.fraction;return i(n,N.add(N.mulNumVec2(1-a,t.p1),N.mulNumVec2(a,t.p2)),m.normal,a)}return t.maxFraction})},t.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()},t.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()},t.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()},t.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()},t.prototype.shiftOrigin=function(t){if(!this.isLocked()){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.sub(t),e.m_sweep.c0.sub(t),e.m_sweep.c.sub(t);for(var i=this.m_jointList;i;i=i.m_next)i.shiftOrigin(t);this.m_broadPhase.shiftOrigin(t)}},t.prototype._addBody=function(t){!this.isLocked()&&(t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount)},t.prototype.createBody=function(t,e){if(this.isLocked())return null;var i={};t&&(N.isValid(t)?i={position:t,angle:e}:"object"==typeof t&&(i=t));var o=new t7(this,i);return this._addBody(o),o},t.prototype.createDynamicBody=function(t,e){var i={};return t&&(N.isValid(t)?i={position:t,angle:e}:"object"==typeof t&&(i=t)),i.type="dynamic",this.createBody(i)},t.prototype.createKinematicBody=function(t,e){var i={};return t&&(N.isValid(t)?i={position:t,angle:e}:"object"==typeof t&&(i=t)),i.type="kinematic",this.createBody(i)},t.prototype.destroyBody=function(t){if(!this.isLocked()){if(t.m_destroyed)return!1;for(var e=t.m_jointList;e;){var i=e;e=e.next,this.publish("remove-joint",i.joint),this.destroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var o=t.m_contactList;o;){var s=o;o=o.next,this.destroyContact(s.contact),t.m_contactList=o}t.m_contactList=null;for(var n=t.m_fixtureList;n;){var r=n;n=n.m_next,this.publish("remove-fixture",r),r.destroyProxies(this.m_broadPhase),t.m_fixtureList=n}return t.m_fixtureList=null,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_destroyed=!0,--this.m_bodyCount,this.publish("remove-body",t),!0}},t.prototype.createJoint=function(t){if(this.isLocked())return null;if(t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,!1==t.m_collideConnected)for(var e=t.m_bodyB.getContactList();e;e=e.next)e.other==t.m_bodyA&&e.contact.flagForFiltering();return t},t.prototype.destroyJoint=function(t){if(!this.isLocked()){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var e=t.m_bodyA,i=t.m_bodyB;if(e.setAwake(!0),i.setAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==i.m_jointList&&(i.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,--this.m_jointCount,!1==t.m_collideConnected)for(var o=i.getContactList();o;)o.other==e&&o.contact.flagForFiltering(),o=o.next;this.publish("remove-joint",t)}},t.prototype.step=function(t,e,i){if(this.publish("pre-step",t),(0|e)!==e&&(e=0),e=e||this.m_velocityIterations,i=i||this.m_positionIterations,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,this.s_step.reset(t),this.s_step.velocityIterations=e,this.s_step.positionIterations=i,this.s_step.warmStarting=this.m_warmStarting,this.s_step.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&t>0){this.m_solver.solveWorld(this.s_step);for(var o,s=this.m_bodyList;s;s=s.getNext())!1!=s.m_islandFlag&&(s.isStatic()||s.synchronizeFixtures());this.findNewContacts()}for(this.m_continuousPhysics&&t>0&&this.m_solver.solveWorldTOI(this.s_step),this.m_clearForces&&this.clearForces(),this.m_locked=!1;o=this.m_step_callback.shift();)o(this);this.publish("post-step",t)},t.prototype.queueUpdate=function(t){this.isLocked()?this.m_step_callback.push(t):t(this)},t.prototype.findNewContacts=function(){var t=this;this.m_broadPhase.updatePairs(function(e,i){return t.createContact(e,i)})},t.prototype.createContact=function(t,e){var i=t.fixture,o=e.fixture,s=t.childIndex,n=e.childIndex,r=i.getBody(),m=o.getBody();if(r!=m){for(var a=m.getContactList();a;){if(a.other==r){var h=a.contact.getFixtureA(),c=a.contact.getFixtureB(),_=a.contact.getChildIndexA(),l=a.contact.getChildIndexB();if(h==i&&c==o&&_==s&&l==n||h==o&&c==i&&_==n&&l==s)return}a=a.next}if(!1!=m.shouldCollide(r)&&!1!=o.shouldCollide(i)){var u=iZ.create(i,s,o,n);null!=u&&(u.m_prev=null,null!=this.m_contactList&&(u.m_next=this.m_contactList,this.m_contactList.m_prev=u),this.m_contactList=u,++this.m_contactCount)}}},t.prototype.updateContacts=function(){for(var t,e=this.m_contactList;t=e;){e=t.getNext();var i=t.getFixtureA(),o=t.getFixtureB(),s=t.getChildIndexA(),n=t.getChildIndexB(),r=i.getBody(),m=o.getBody();if(t.m_filterFlag){if(!1==m.shouldCollide(r)||!1==o.shouldCollide(i)){this.destroyContact(t);continue}t.m_filterFlag=!1}var a=r.isAwake()&&!r.isStatic(),h=m.isAwake()&&!m.isStatic();if(!1!=a||!1!=h){var c=i.m_proxies[s].proxyId,_=o.m_proxies[n].proxyId;if(!1==this.m_broadPhase.testOverlap(c,_)){this.destroyContact(t);continue}t.update(this)}}},t.prototype.destroyContact=function(t){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),iZ.destroy(t,this),--this.m_contactCount},t.prototype.on=function(t,e){return"string"!=typeof t||"function"!=typeof e||(this._listeners||(this._listeners={}),this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e)),this},t.prototype.off=function(t,e){if("string"!=typeof t||"function"!=typeof e)return this;var i=this._listeners&&this._listeners[t];if(!i||!i.length)return this;var o=i.indexOf(e);return o>=0&&i.splice(o,1),this},t.prototype.publish=function(t,e,i,o){var s=this._listeners&&this._listeners[t];if(!s||!s.length)return 0;for(var n=0;n<s.length;n++)s[n].call(this,e,i,o);return s.length},t.prototype.beginContact=function(t){this.publish("begin-contact",t)},t.prototype.endContact=function(t){this.publish("end-contact",t)},t.prototype.preSolve=function(t,e){this.publish("pre-solve",t,e)},t.prototype.postSolve=function(t,e){this.publish("post-solve",t,e)},t}(),iG=function(){function t(e,i,o){if(!(this instanceof t))return new t(e,i,o);void 0===e?(this.x=0,this.y=0,this.z=0):"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z):(this.x=e,this.y=i,this.z=o)}return t.prototype._serialize=function(){return{x:this.x,y:this.y,z:this.z}},t._deserialize=function(e){var i=Object.create(t.prototype);return i.x=e.x,i.y=e.y,i.z=e.z,i},t.neo=function(e,i,o){var s=Object.create(t.prototype);return s.x=e,s.y=i,s.z=o,s},t.zero=function(){var e=Object.create(t.prototype);return e.x=0,e.y=0,e.z=0,e},t.clone=function(e){return t.neo(e.x,e.y,e.z)},t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)},t.assert=function(t){},t.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this},t.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.areEqual=function(t,e){return t===e||"object"==typeof t&&null!==t&&"object"==typeof e&&null!==e&&t.x===e.x&&t.y===e.y&&t.z===e.z},t.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.cross=function(e,i){return new t(e.y*i.z-e.z*i.y,e.z*i.x-e.x*i.z,e.x*i.y-e.y*i.x)},t.add=function(e,i){return new t(e.x+i.x,e.y+i.y,e.z+i.z)},t.sub=function(e,i){return new t(e.x-i.x,e.y-i.y,e.z-i.z)},t.mul=function(e,i){return new t(i*e.x,i*e.y,i*e.z)},t.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},t.neg=function(e){return new t(-e.x,-e.y,-e.z)},t}(),iQ=to(0,0),i$=to(0,0),i0=function(t){function e(i,o){var s=this;return s instanceof e?((s=t.call(this)||this).m_type=e.TYPE,s.m_radius=Y.polygonRadius,s.m_vertex1=i?N.clone(i):N.zero(),s.m_vertex2=o?N.clone(o):N.zero(),s.m_vertex0=N.zero(),s.m_vertex3=N.zero(),s.m_hasVertex0=!1,s.m_hasVertex3=!1,s):new e(i,o)}return V(e,t),e.prototype._serialize=function(){return{type:this.m_type,vertex1:this.m_vertex1,vertex2:this.m_vertex2,vertex0:this.m_vertex0,vertex3:this.m_vertex3,hasVertex0:this.m_hasVertex0,hasVertex3:this.m_hasVertex3}},e._deserialize=function(t){var i=new e(t.vertex1,t.vertex2);return i.m_hasVertex0&&i.setPrevVertex(t.vertex0),i.m_hasVertex3&&i.setNextVertex(t.vertex3),i},e.prototype._reset=function(){},e.prototype.getRadius=function(){return this.m_radius},e.prototype.getType=function(){return this.m_type},e.prototype.setNext=function(t){return this.setNextVertex(t)},e.prototype.setNextVertex=function(t){return t?(this.m_vertex3.setVec2(t),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this},e.prototype.getNextVertex=function(){return this.m_vertex3},e.prototype.setPrev=function(t){return this.setPrevVertex(t)},e.prototype.setPrevVertex=function(t){return t?(this.m_vertex0.setVec2(t),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this},e.prototype.getPrevVertex=function(){return this.m_vertex0},e.prototype._set=function(t,e){return this.m_vertex1.setVec2(t),this.m_vertex2.setVec2(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},e.prototype._clone=function(){var t=new e;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_vertex1.setVec2(this.m_vertex1),t.m_vertex2.setVec2(this.m_vertex2),t.m_vertex0.setVec2(this.m_vertex0),t.m_vertex3.setVec2(this.m_vertex3),t.m_hasVertex0=this.m_hasVertex0,t.m_hasVertex3=this.m_hasVertex3,t},e.prototype.getChildCount=function(){return 1},e.prototype.testPoint=function(t,e){return!1},e.prototype.rayCast=function(t,e,i,o){var s=tk.mulTVec2(i.q,N.sub(e.p1,i.p)),n=tk.mulTVec2(i.q,N.sub(e.p2,i.p)),r=N.sub(n,s),m=this.m_vertex1,a=this.m_vertex2,h=N.sub(a,m),c=N.neo(h.y,-h.x);c.normalize();var _=N.dot(c,N.sub(m,s)),l=N.dot(c,r);if(0==l)return!1;var u=_/l;if(u<0||e.maxFraction<u)return!1;var p=N.add(s,N.mulNumVec2(u,r)),y=N.sub(a,m),d=N.dot(y,y);if(0==d)return!1;var f=N.dot(N.sub(p,m),y)/d;return!(f<0)&&!(1<f)&&(t.fraction=u,_>0?t.normal=tk.mulVec2(i.q,c).neg():t.normal=tk.mulVec2(i.q,c),!0)},e.prototype.computeAABB=function(t,e,i){tz(iQ,e,this.m_vertex1),tz(i$,e,this.m_vertex2),R.combinePoints(t,iQ,i$),R.extend(t,this.m_radius)},e.prototype.computeMass=function(t,e){t.mass=0,ty(t.center,.5,this.m_vertex1,.5,this.m_vertex2),t.I=0},e.prototype.computeDistanceProxy=function(t){t.m_vertices[0]=this.m_vertex1,t.m_vertices[1]=this.m_vertex2,t.m_vertices.length=2,t.m_count=2,t.m_radius=this.m_radius},e.TYPE="edge",e}(tU),i1=to(0,0),i2=to(0,0),i3=function(t){function e(i,o){var s=this;return s instanceof e?((s=t.call(this)||this).m_type=e.TYPE,s.m_radius=Y.polygonRadius,s.m_vertices=[],s.m_count=0,s.m_prevVertex=null,s.m_nextVertex=null,s.m_hasPrevVertex=!1,s.m_hasNextVertex=!1,s.m_isLoop=!!o,i&&i.length&&(o?s._createLoop(i):s._createChain(i)),s):new e(i,o)}return V(e,t),e.prototype._serialize=function(){var t={type:this.m_type,vertices:this.m_isLoop?this.m_vertices.slice(0,this.m_vertices.length-1):this.m_vertices,isLoop:this.m_isLoop,hasPrevVertex:this.m_hasPrevVertex,hasNextVertex:this.m_hasNextVertex,prevVertex:null,nextVertex:null};return this.m_prevVertex&&(t.prevVertex=this.m_prevVertex),this.m_nextVertex&&(t.nextVertex=this.m_nextVertex),t},e._deserialize=function(t,i,o){var s=[];if(t.vertices)for(var n=0;n<t.vertices.length;n++)s.push(o(N,t.vertices[n]));var r=new e(s,t.isLoop);return t.prevVertex&&r.setPrevVertex(t.prevVertex),t.nextVertex&&r.setNextVertex(t.nextVertex),r},e.prototype.getType=function(){return this.m_type},e.prototype.getRadius=function(){return this.m_radius},e.prototype._createLoop=function(t){if(!(t.length<3)){this.m_vertices=[],this.m_count=t.length+1;for(var e,e=0;e<t.length;++e)this.m_vertices[e]=N.clone(t[e]);return this.m_vertices[t.length]=N.clone(t[0]),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}},e.prototype._createChain=function(t){var e;this.m_vertices=[],this.m_count=t.length;for(var e=0;e<t.length;++e)this.m_vertices[e]=N.clone(t[e]);return this.m_prevVertex=null,this.m_nextVertex=null,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this},e.prototype._reset=function(){this.m_isLoop?this._createLoop(this.m_vertices.slice(0,this.m_vertices.length-1)):this._createChain(this.m_vertices)},e.prototype.setPrevVertex=function(t){this.m_prevVertex=t,this.m_hasPrevVertex=!0},e.prototype.getPrevVertex=function(){return this.m_prevVertex},e.prototype.setNextVertex=function(t){this.m_nextVertex=t,this.m_hasNextVertex=!0},e.prototype.getNextVertex=function(){return this.m_nextVertex},e.prototype._clone=function(){var t=new e;return t._createChain(this.m_vertices),t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_prevVertex=this.m_prevVertex,t.m_nextVertex=this.m_nextVertex,t.m_hasPrevVertex=this.m_hasPrevVertex,t.m_hasNextVertex=this.m_hasNextVertex,t},e.prototype.getChildCount=function(){return this.m_count-1},e.prototype.getChildEdge=function(t,e){t.m_type=i0.TYPE,t.m_radius=this.m_radius,t.m_vertex1=this.m_vertices[e],t.m_vertex2=this.m_vertices[e+1],e>0?(t.m_vertex0=this.m_vertices[e-1],t.m_hasVertex0=!0):(t.m_vertex0=this.m_prevVertex,t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3=this.m_vertices[e+2],t.m_hasVertex3=!0):(t.m_vertex3=this.m_nextVertex,t.m_hasVertex3=this.m_hasNextVertex)},e.prototype.getVertex=function(t){return t<this.m_count?this.m_vertices[t]:this.m_vertices[0]},e.prototype.isLoop=function(){return this.m_isLoop},e.prototype.testPoint=function(t,e){return!1},e.prototype.rayCast=function(t,e,i,o){return new i0(this.getVertex(o),this.getVertex(o+1)).rayCast(t,e,i,0)},e.prototype.computeAABB=function(t,e,i){tz(i1,e,this.getVertex(i)),tz(i2,e,this.getVertex(i+1)),R.combinePoints(t,i1,i2)},e.prototype.computeMass=function(t,e){t.mass=0,tr(t.center),t.I=0},e.prototype.computeDistanceProxy=function(t,e){t.m_vertices[0]=this.getVertex(e),t.m_vertices[1]=this.getVertex(e+1),t.m_count=2,t.m_radius=this.m_radius},e.TYPE="chain",e}(tU),i5=Math.max,i9=Math.min,i4=to(0,0),i8=to(0,0),i6=to(0,0),i7=to(0,0),ot=to(0,0),oe=to(0,0),oi=function(t){function e(i){var o=this;return o instanceof e?((o=t.call(this)||this).m_type=e.TYPE,o.m_radius=Y.polygonRadius,o.m_centroid=N.zero(),o.m_vertices=[],o.m_normals=[],o.m_count=0,i&&i.length&&o._set(i),o):new e(i)}return V(e,t),e.prototype._serialize=function(){return{type:this.m_type,vertices:this.m_vertices}},e._deserialize=function(t,i,o){var s=[];if(t.vertices)for(var n=0;n<t.vertices.length;n++)s.push(o(N,t.vertices[n]));return new e(s)},e.prototype.getType=function(){return this.m_type},e.prototype.getRadius=function(){return this.m_radius},e.prototype._clone=function(){var t=new e;t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_count=this.m_count,t.m_centroid.setVec2(this.m_centroid);for(var i=0;i<this.m_count;i++)t.m_vertices.push(this.m_vertices[i].clone());for(var i=0;i<this.m_normals.length;i++)t.m_normals.push(this.m_normals[i].clone());return t},e.prototype.getChildCount=function(){return 1},e.prototype._reset=function(){this._set(this.m_vertices)},e.prototype._set=function(t){if(t.length<3)return void this._setAsBox(1,1);for(var e=i9(t.length,Y.maxPolygonVertices),i=[],o=0;o<e;++o){for(var s=t[o],n=!0,r=0;r<i.length;++r)if(N.distanceSquared(s,i[r])<.25*Y.linearSlopSquared){n=!1;break}n&&i.push(N.clone(s))}if((e=i.length)<3)return void this._setAsBox(1,1);for(var m=0,a=i[0].x,o=1;o<e;++o){var h=i[o].x;(h>a||h===a&&i[o].y<i[m].y)&&(m=o,a=h)}for(var c=[],_=0,l=m;;){c[_]=l;for(var u=0,r=1;r<e;++r){if(u===l){u=r;continue}var p=N.sub(i[u],i[c[_]]),s=N.sub(i[r],i[c[_]]),y=N.crossVec2Vec2(p,s);y<0&&(u=r),0===y&&s.lengthSquared()>p.lengthSquared()&&(u=r)}if(++_,l=u,u===m)break}if(_<3)return void this._setAsBox(1,1);this.m_count=_,this.m_vertices=[];for(var o=0;o<_;++o)this.m_vertices[o]=i[c[o]];for(var o=0;o<_;++o){var d=o,f=o+1<_?o+1:0,v=N.sub(this.m_vertices[f],this.m_vertices[d]);this.m_normals[o]=N.crossVec2Num(v,1),this.m_normals[o].normalize()}this.m_centroid=function(t,e){for(var i,o=N.zero(),s=0,n=N.zero(),r=1/3,i=0;i<e;++i){var m=t[i],a=i+1<e?t[i+1]:t[0],h=N.sub(m,n),c=N.sub(a,n),_=.5*N.crossVec2Vec2(h,c);s+=_,td(i4,1,n,1,m,1,a),tu(o,_*r,i4)}return o.mul(1/s),o}(this.m_vertices,_)},e.prototype._setAsBox=function(t,e,i,o){if(this.m_vertices[0]=N.neo(t,-e),this.m_vertices[1]=N.neo(t,e),this.m_vertices[2]=N.neo(-t,e),this.m_vertices[3]=N.neo(-t,-e),this.m_normals[0]=N.neo(1,0),this.m_normals[1]=N.neo(0,1),this.m_normals[2]=N.neo(-1,0),this.m_normals[3]=N.neo(0,-1),this.m_count=4,i&&N.isValid(i)){o=o||0,tn(this.m_centroid,i);var s=tO.identity();s.p.setVec2(i),s.q.setAngle(o);for(var n=0;n<this.m_count;++n)this.m_vertices[n]=tO.mulVec2(s,this.m_vertices[n]),this.m_normals[n]=tk.mulVec2(s.q,this.m_normals[n])}},e.prototype.testPoint=function(t,e){for(var i=tP(i4,t,e),o=0;o<this.m_count;++o)if(tg(this.m_normals[o],i)-tg(this.m_normals[o],this.m_vertices[o])>0)return!1;return!0},e.prototype.rayCast=function(t,e,i,o){for(var s=tk.mulTVec2(i.q,N.sub(e.p1,i.p)),n=tk.mulTVec2(i.q,N.sub(e.p2,i.p)),r=N.sub(n,s),m=0,a=e.maxFraction,h=-1,c=0;c<this.m_count;++c){var _=N.dot(this.m_normals[c],N.sub(this.m_vertices[c],s)),l=N.dot(this.m_normals[c],r);if(0==l){if(_<0)return!1}else l<0&&_<m*l?(m=_/l,h=c):l>0&&_<a*l&&(a=_/l);if(a<m)return!1}return h>=0&&(t.fraction=m,t.normal=tk.mulVec2(i.q,this.m_normals[h]),!0)},e.prototype.computeAABB=function(t,e,i){for(var o=1/0,s=1/0,n=-1/0,r=-1/0,m=0;m<this.m_count;++m){var a=tz(i4,e,this.m_vertices[m]);o=i9(o,a.x),n=i5(n,a.x),s=i9(s,a.y),r=i5(r,a.y)}ts(t.lowerBound,o-this.m_radius,s-this.m_radius),ts(t.upperBound,n+this.m_radius,r+this.m_radius)},e.prototype.computeMass=function(t,e){tr(ot);var i,o=0,s=0;tr(oe);for(var n=0;n<this.m_count;++n)ta(oe,this.m_vertices[n]);tl(oe,1/this.m_count,oe);for(var r=1/3,n=0;n<this.m_count;++n){tc(i6,this.m_vertices[n],oe),n+1<this.m_count?tc(i7,this.m_vertices[n+1],oe):tc(i7,this.m_vertices[0],oe);var m=tA(i6,i7),a=.5*m;o+=a,ty(i4,a*r,i6,a*r,i7),ta(ot,i4);var h=i6.x,c=i6.y,_=i7.x,l=i7.y;s+=.25*r*m*(h*h+_*h+_*_+(c*c+l*c+l*l))}t.mass=e*o,tl(ot,1/o,ot),i=t.center,i.x=ot.x+oe.x,i.y=ot.x+oe.y,t.I=e*s,t.I+=t.mass*(tg(t.center,t.center)-tg(ot,ot))},e.prototype.validate=function(){for(var t=0;t<this.m_count;++t){var e=t,i=t<this.m_count-1?e+1:0,o=this.m_vertices[e];tc(i8,this.m_vertices[i],o);for(var s=0;s<this.m_count;++s)if(s!=e&&s!=i&&0>tA(i8,tc(i4,this.m_vertices[s],o)))return!1}return!0},e.prototype.computeDistanceProxy=function(t){for(var e=0;e<this.m_count;++e)t.m_vertices[e]=this.m_vertices[e];t.m_vertices.length=this.m_count,t.m_count=this.m_count,t.m_radius=this.m_radius},e.TYPE="polygon",e}(tU),oo=Math.sqrt,os=Math.PI,on=to(0,0),or=function(t){function e(i,o){var s=this;return s instanceof e?((s=t.call(this)||this).m_type=e.TYPE,s.m_p=N.zero(),s.m_radius=1,"object"==typeof i&&N.isValid(i)?(s.m_p.setVec2(i),"number"==typeof o&&(s.m_radius=o)):"number"==typeof i&&(s.m_radius=i),s):new e(i,o)}return V(e,t),e.prototype._serialize=function(){return{type:this.m_type,p:this.m_p,radius:this.m_radius}},e._deserialize=function(t){return new e(t.p,t.radius)},e.prototype._reset=function(){},e.prototype.getType=function(){return this.m_type},e.prototype.getRadius=function(){return this.m_radius},e.prototype.getCenter=function(){return this.m_p},e.prototype._clone=function(){var t=new e;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_p=this.m_p.clone(),t},e.prototype.getChildCount=function(){return 1},e.prototype.testPoint=function(t,e){return tw(e,tz(on,t,this.m_p))<=this.m_radius*this.m_radius},e.prototype.rayCast=function(t,e,i,o){var s=N.add(i.p,tk.mulVec2(i.q,this.m_p)),n=N.sub(e.p1,s),r=N.dot(n,n)-this.m_radius*this.m_radius,m=N.sub(e.p2,e.p1),a=N.dot(n,m),h=N.dot(m,m),c=a*a-h*r;if(c<0||h<1e-9)return!1;var _=-(a+oo(c));return 0<=_&&_<=e.maxFraction*h&&(t.fraction=_/=h,t.normal=N.add(n,N.mulNumVec2(_,m)),t.normal.normalize(),!0)},e.prototype.computeAABB=function(t,e,i){var o=tz(on,e,this.m_p);ts(t.lowerBound,o.x-this.m_radius,o.y-this.m_radius),ts(t.upperBound,o.x+this.m_radius,o.y+this.m_radius)},e.prototype.computeMass=function(t,e){t.mass=e*os*this.m_radius*this.m_radius,tn(t.center,this.m_p),t.I=t.mass*(.5*this.m_radius*this.m_radius+tb(this.m_p))},e.prototype.computeDistanceProxy=function(t){t.m_vertices[0]=this.m_p,t.m_vertices.length=1,t.m_count=1,t.m_radius=this.m_radius},e.TYPE="circle",e}(tU),om=Math.abs,oa=Math.PI,oh={frequencyHz:0,dampingRatio:0},oc=function(t){function e(i,o,s,n,r){var m=this;if(!(m instanceof e))return new e(i,o,s,n,r);if(s&&n&&"m_type"in n&&"x"in s&&"y"in s){var a=s;s=n,n=a}return i=C(i,oh),o=(m=t.call(this,i,o,s)||this).m_bodyA,s=m.m_bodyB,m.m_type=e.TYPE,m.m_localAnchorA=N.clone(n?o.getLocalPoint(n):i.localAnchorA||N.zero()),m.m_localAnchorB=N.clone(r?s.getLocalPoint(r):i.localAnchorB||N.zero()),m.m_length=Number.isFinite(i.length)?i.length:N.distance(o.getWorldPoint(m.m_localAnchorA),s.getWorldPoint(m.m_localAnchorB)),m.m_frequencyHz=i.frequencyHz,m.m_dampingRatio=i.dampingRatio,m.m_impulse=0,m.m_gamma=0,m.m_bias=0,m}return V(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,length:this.m_length,impulse:this.m_impulse,gamma:this.m_gamma,bias:this.m_bias}},e._deserialize=function(t,i,o){return(t=M({},t)).bodyA=o(t7,t.bodyA,i),t.bodyB=o(t7,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),t.length>0?this.m_length=+t.length:t.length<0||(t.anchorA||t.anchorA||t.anchorA||t.anchorA)&&(this.m_length=N.distance(this.m_bodyA.getWorldPoint(this.m_localAnchorA),this.m_bodyB.getWorldPoint(this.m_localAnchorB))),Number.isFinite(t.frequencyHz)&&(this.m_frequencyHz=t.frequencyHz),Number.isFinite(t.dampingRatio)&&(this.m_dampingRatio=t.dampingRatio)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.setLength=function(t){this.m_length=t},e.prototype.getLength=function(){return this.m_length},e.prototype.setFrequency=function(t){this.m_frequencyHz=t},e.prototype.getFrequency=function(){return this.m_frequencyHz},e.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return N.mulNumVec2(this.m_impulse,this.m_u).mul(t)},e.prototype.getReactionTorque=function(t){return 0},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=tk.neo(i),c=tk.neo(r);this.m_rA=tk.mulVec2(h,N.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=tk.mulVec2(c,N.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=N.sub(N.add(n,this.m_rB),N.add(e,this.m_rA));var _=this.m_u.length();_>Y.linearSlop?this.m_u.mul(1/_):this.m_u.setNum(0,0);var l=N.crossVec2Vec2(this.m_rA,this.m_u),u=N.crossVec2Vec2(this.m_rB,this.m_u),p=this.m_invMassA+this.m_invIA*l*l+this.m_invMassB+this.m_invIB*u*u;if(this.m_mass=0!=p?1/p:0,this.m_frequencyHz>0){var y=_-this.m_length,d=2*oa*this.m_frequencyHz,f=2*this.m_mass*this.m_dampingRatio*d,v=this.m_mass*d*d,x=t.dt;this.m_gamma=x*(f+x*v),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=y*x*v*this.m_gamma,p+=this.m_gamma,this.m_mass=0!=p?1/p:0}else this.m_gamma=0,this.m_bias=0;if(t.warmStarting){this.m_impulse*=t.dtRatio;var A=N.mulNumVec2(this.m_impulse,this.m_u);o.subMul(this.m_invMassA,A),s-=this.m_invIA*N.crossVec2Vec2(this.m_rA,A),m.addMul(this.m_invMassB,A),a+=this.m_invIB*N.crossVec2Vec2(this.m_rB,A)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(o),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.setVec2(m),this.m_bodyB.c_velocity.w=a},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=N.add(e,N.crossNumVec2(i,this.m_rA)),r=N.add(o,N.crossNumVec2(s,this.m_rB)),m=N.dot(this.m_u,r)-N.dot(this.m_u,n),a=-this.m_mass*(m+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=a;var h=N.mulNumVec2(a,this.m_u);e.subMul(this.m_invMassA,h),i-=this.m_invIA*N.crossVec2Vec2(this.m_rA,h),o.addMul(this.m_invMassB,h),s+=this.m_invIB*N.crossVec2Vec2(this.m_rB,h),this.m_bodyA.c_velocity.v.setVec2(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.setVec2(o),this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){if(this.m_frequencyHz>0)return!0;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=tk.neo(i),r=tk.neo(s),m=tk.mulSub(n,this.m_localAnchorA,this.m_localCenterA),a=tk.mulSub(r,this.m_localAnchorB,this.m_localCenterB),h=N.sub(N.add(o,a),N.add(e,m)),c=S(h.normalize()-this.m_length,-Y.maxLinearCorrection,Y.maxLinearCorrection),_=-this.m_mass*c,l=N.mulNumVec2(_,h);return e.subMul(this.m_invMassA,l),i-=this.m_invIA*N.crossVec2Vec2(m,l),o.addMul(this.m_invMassB,l),s+=this.m_invIB*N.crossVec2Vec2(a,l),this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(o),this.m_bodyB.c_position.a=s,om(c)<Y.linearSlop},e.TYPE="distance-joint",e}(ee),o_={maxForce:0,maxTorque:0},ol=function(t){function e(i,o,s,n){var r=this;return r instanceof e?(i=C(i,o_),o=(r=t.call(this,i,o,s)||this).m_bodyA,s=r.m_bodyB,r.m_type=e.TYPE,r.m_localAnchorA=N.clone(n?o.getLocalPoint(n):i.localAnchorA||N.zero()),r.m_localAnchorB=N.clone(n?s.getLocalPoint(n):i.localAnchorB||N.zero()),r.m_linearImpulse=N.zero(),r.m_angularImpulse=0,r.m_maxForce=i.maxForce,r.m_maxTorque=i.maxTorque,r):new e(i,o,s,n)}return V(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB}},e._deserialize=function(t,i,o){return(t=M({},t)).bodyA=o(t7,t.bodyA,i),t.bodyB=o(t7,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),Number.isFinite(t.maxForce)&&(this.m_maxForce=t.maxForce),Number.isFinite(t.maxTorque)&&(this.m_maxTorque=t.maxTorque)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.setMaxForce=function(t){this.m_maxForce=t},e.prototype.getMaxForce=function(){return this.m_maxForce},e.prototype.setMaxTorque=function(t){this.m_maxTorque=t},e.prototype.getMaxTorque=function(){return this.m_maxTorque},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return N.mulNumVec2(t,this.m_linearImpulse)},e.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,m=tk.neo(e),a=tk.neo(s);this.m_rA=tk.mulVec2(m,N.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=tk.mulVec2(a,N.sub(this.m_localAnchorB,this.m_localCenterB));var h=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,l=this.m_invIB,u=new e5;if(u.ex.x=h+c+_*this.m_rA.y*this.m_rA.y+l*this.m_rB.y*this.m_rB.y,u.ex.y=-_*this.m_rA.x*this.m_rA.y-l*this.m_rB.x*this.m_rB.y,u.ey.x=u.ex.y,u.ey.y=h+c+_*this.m_rA.x*this.m_rA.x+l*this.m_rB.x*this.m_rB.x,this.m_linearMass=u.getInverse(),this.m_angularMass=_+l,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var p=N.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);i.subMul(h,p),o-=_*(N.crossVec2Vec2(this.m_rA,p)+this.m_angularImpulse),n.addMul(c,p),r+=l*(N.crossVec2Vec2(this.m_rB,p)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,m=this.m_invIA,a=this.m_invIB,h=t.dt,c=s-i,_=-this.m_angularMass*c,l=this.m_angularImpulse,u=h*this.m_maxTorque;this.m_angularImpulse=S(this.m_angularImpulse+_,-u,u),i-=m*(_=this.m_angularImpulse-l),s+=a*_;var c=N.sub(N.add(o,N.crossNumVec2(s,this.m_rB)),N.add(e,N.crossNumVec2(i,this.m_rA))),_=N.neg(e5.mulVec2(this.m_linearMass,c)),l=this.m_linearImpulse;this.m_linearImpulse.add(_);var u=h*this.m_maxForce;this.m_linearImpulse.lengthSquared()>u*u&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(u)),_=N.sub(this.m_linearImpulse,l),e.subMul(n,_),i-=m*N.crossVec2Vec2(this.m_rA,_),o.addMul(r,_),s+=a*N.crossVec2Vec2(this.m_rB,_),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){return!0},e.TYPE="friction-joint",e}(ee),ou=function(){function t(t,e,i){"object"==typeof t&&null!==t?(this.ex=iG.clone(t),this.ey=iG.clone(e),this.ez=iG.clone(i)):(this.ex=iG.zero(),this.ey=iG.zero(),this.ez=iG.zero())}return t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&iG.isValid(t.ex)&&iG.isValid(t.ey)&&iG.isValid(t.ez)},t.assert=function(t){},t.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this},t.prototype.solve33=function(t){var e=this.ey.y*this.ez.z-this.ey.z*this.ez.y,i=this.ey.z*this.ez.x-this.ey.x*this.ez.z,o=this.ey.x*this.ez.y-this.ey.y*this.ez.x,s=this.ex.x*e+this.ex.y*i+this.ex.z*o;0!==s&&(s=1/s);var n=new iG;return e=this.ey.y*this.ez.z-this.ey.z*this.ez.y,i=this.ey.z*this.ez.x-this.ey.x*this.ez.z,o=this.ey.x*this.ez.y-this.ey.y*this.ez.x,n.x=s*(t.x*e+t.y*i+t.z*o),e=t.y*this.ez.z-t.z*this.ez.y,i=t.z*this.ez.x-t.x*this.ez.z,o=t.x*this.ez.y-t.y*this.ez.x,n.y=s*(this.ex.x*e+this.ex.y*i+this.ex.z*o),e=this.ey.y*t.z-this.ey.z*t.y,i=this.ey.z*t.x-this.ey.x*t.z,o=this.ey.x*t.y-this.ey.y*t.x,n.z=s*(this.ex.x*e+this.ex.y*i+this.ex.z*o),n},t.prototype.solve22=function(t){var e=this.ex.x,i=this.ey.x,o=this.ex.y,s=this.ey.y,n=e*s-i*o;0!==n&&(n=1/n);var r=N.zero();return r.x=n*(s*t.x-i*t.y),r.y=n*(e*t.y-o*t.x),r},t.prototype.getInverse22=function(t){var e=this.ex.x,i=this.ey.x,o=this.ex.y,s=this.ey.y,n=e*s-i*o;0!==n&&(n=1/n),t.ex.x=n*s,t.ey.x=-n*i,t.ex.z=0,t.ex.y=-n*o,t.ey.y=n*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},t.prototype.getSymInverse33=function(t){var e=iG.dot(this.ex,iG.cross(this.ey,this.ez));0!==e&&(e=1/e);var i=this.ex.x,o=this.ey.x,s=this.ez.x,n=this.ey.y,r=this.ez.y,m=this.ez.z;t.ex.x=e*(n*m-r*r),t.ex.y=e*(s*r-o*m),t.ex.z=e*(o*r-s*n),t.ey.x=t.ex.y,t.ey.y=e*(i*m-s*s),t.ey.z=e*(s*o-i*r),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*n-o*o)},t.mul=function(t,e){if(e&&"z"in e&&"y"in e&&"x"in e){var i=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,o=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z;return new iG(i,o,t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z)}if(e&&"y"in e&&"x"in e){var i=t.ex.x*e.x+t.ey.x*e.y,o=t.ex.y*e.x+t.ey.y*e.y;return N.neo(i,o)}},t.mulVec3=function(t,e){return new iG(t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z)},t.mulVec2=function(t,e){var i=t.ex.x*e.x+t.ey.x*e.y,o=t.ex.y*e.x+t.ey.y*e.y;return N.neo(i,o)},t.add=function(e,i){return new t(iG.add(e.ex,i.ex),iG.add(e.ey,i.ey),iG.add(e.ez,i.ez))},t}(),op=Math.abs;(a=v||(v={}))[a.inactiveLimit=0]="inactiveLimit",a[a.atLowerLimit=1]="atLowerLimit",a[a.atUpperLimit=2]="atUpperLimit",a[a.equalLimits=3]="equalLimits";var oy=function(t){function e(i,o,s,n){var r,m,a,h,c,_,l=this;return l instanceof e?(i=null!=i?i:{},o=(l=t.call(this,i,o,s)||this).m_bodyA,s=l.m_bodyB,l.m_mass=new ou,l.m_limitState=v.inactiveLimit,l.m_type=e.TYPE,N.isValid(n)?l.m_localAnchorA=o.getLocalPoint(n):N.isValid(i.localAnchorA)?l.m_localAnchorA=N.clone(i.localAnchorA):l.m_localAnchorA=N.zero(),N.isValid(n)?l.m_localAnchorB=s.getLocalPoint(n):N.isValid(i.localAnchorB)?l.m_localAnchorB=N.clone(i.localAnchorB):l.m_localAnchorB=N.zero(),Number.isFinite(i.referenceAngle)?l.m_referenceAngle=i.referenceAngle:l.m_referenceAngle=s.getAngle()-o.getAngle(),l.m_impulse=new iG,l.m_motorImpulse=0,l.m_lowerAngle=null!=(r=i.lowerAngle)?r:0,l.m_upperAngle=null!=(m=i.upperAngle)?m:0,l.m_maxMotorTorque=null!=(a=i.maxMotorTorque)?a:0,l.m_motorSpeed=null!=(h=i.motorSpeed)?h:0,l.m_enableLimit=null!=(c=i.enableLimit)&&c,l.m_enableMotor=null!=(_=i.enableMotor)&&_,l):new e(i,o,s,n)}return V(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerAngle:this.m_lowerAngle,upperAngle:this.m_upperAngle,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},e._deserialize=function(t,i,o){return(t=M({},t)).bodyA=o(t7,t.bodyA,i),t.bodyB=o(t7,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),Number.isFinite(t.referenceAngle)&&(this.m_referenceAngle=t.referenceAngle),void 0!==t.enableLimit&&(this.m_enableLimit=t.enableLimit),Number.isFinite(t.lowerAngle)&&(this.m_lowerAngle=t.lowerAngle),Number.isFinite(t.upperAngle)&&(this.m_upperAngle=t.upperAngle),Number.isFinite(t.maxMotorTorque)&&(this.m_maxMotorTorque=t.maxMotorTorque),Number.isFinite(t.motorSpeed)&&(this.m_motorSpeed=t.motorSpeed),void 0!==t.enableMotor&&(this.m_enableMotor=t.enableMotor)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getReferenceAngle=function(){return this.m_referenceAngle},e.prototype.getJointAngle=function(){var t=this.m_bodyA;return this.m_bodyB.m_sweep.a-t.m_sweep.a-this.m_referenceAngle},e.prototype.getJointSpeed=function(){var t=this.m_bodyA;return this.m_bodyB.m_angularVelocity-t.m_angularVelocity},e.prototype.isMotorEnabled=function(){return this.m_enableMotor},e.prototype.enableMotor=function(t){t!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t)},e.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},e.prototype.setMotorSpeed=function(t){t!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t)},e.prototype.getMotorSpeed=function(){return this.m_motorSpeed},e.prototype.setMaxMotorTorque=function(t){t!=this.m_maxMotorTorque&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t)},e.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},e.prototype.isLimitEnabled=function(){return this.m_enableLimit},e.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},e.prototype.getLowerLimit=function(){return this.m_lowerAngle},e.prototype.getUpperLimit=function(){return this.m_upperAngle},e.prototype.setLimits=function(t,e){(t!=this.m_lowerAngle||e!=this.m_upperAngle)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return N.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,m=tk.neo(e),a=tk.neo(s);this.m_rA=tk.mulVec2(m,N.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=tk.mulVec2(a,N.sub(this.m_localAnchorB,this.m_localCenterB));var h=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,l=this.m_invIB,u=_+l===0;if(this.m_mass.ex.x=h+c+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*l,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*l,this.m_mass.ez.x=-this.m_rA.y*_-this.m_rB.y*l,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=h+c+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*l,this.m_mass.ez.y=this.m_rA.x*_+this.m_rB.x*l,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=_+l,this.m_motorMass=_+l,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(!1==this.m_enableMotor||u)&&(this.m_motorImpulse=0),this.m_enableLimit&&!1==u){var p=s-e-this.m_referenceAngle;op(this.m_upperAngle-this.m_lowerAngle)<2*Y.angularSlop?this.m_limitState=v.equalLimits:p<=this.m_lowerAngle?(this.m_limitState!=v.atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=v.atLowerLimit):p>=this.m_upperAngle?(this.m_limitState!=v.atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=v.atUpperLimit):(this.m_limitState=v.inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=v.inactiveLimit;if(t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var y=N.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(h,y),o-=_*(N.crossVec2Vec2(this.m_rA,y)+this.m_motorImpulse+this.m_impulse.z),n.addMul(c,y),r+=l*(N.crossVec2Vec2(this.m_rB,y)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,m=this.m_invIA,a=this.m_invIB,h=m+a===0;if(this.m_enableMotor&&this.m_limitState!=v.equalLimits&&!1==h){var c=s-i-this.m_motorSpeed,_=-this.m_motorMass*c,l=this.m_motorImpulse,u=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=S(this.m_motorImpulse+_,-u,u),i-=m*(_=this.m_motorImpulse-l),s+=a*_}if(this.m_enableLimit&&this.m_limitState!=v.inactiveLimit&&!1==h){var p=N.zero();p.addCombine(1,o,1,N.crossNumVec2(s,this.m_rB)),p.subCombine(1,e,1,N.crossNumVec2(i,this.m_rA));var y=s-i,c=new iG(p.x,p.y,y),_=iG.neg(this.m_mass.solve33(c));if(this.m_limitState==v.equalLimits)this.m_impulse.add(_);else if(this.m_limitState==v.atLowerLimit){var d=this.m_impulse.z+_.z;if(d<0){var f=N.combine(-1,p,this.m_impulse.z,N.neo(this.m_mass.ez.x,this.m_mass.ez.y)),x=this.m_mass.solve22(f);_.x=x.x,_.y=x.y,_.z=-this.m_impulse.z,this.m_impulse.x+=x.x,this.m_impulse.y+=x.y,this.m_impulse.z=0}else this.m_impulse.add(_)}else if(this.m_limitState==v.atUpperLimit){var d=this.m_impulse.z+_.z;if(d>0){var f=N.combine(-1,p,this.m_impulse.z,N.neo(this.m_mass.ez.x,this.m_mass.ez.y)),x=this.m_mass.solve22(f);_.x=x.x,_.y=x.y,_.z=-this.m_impulse.z,this.m_impulse.x+=x.x,this.m_impulse.y+=x.y,this.m_impulse.z=0}else this.m_impulse.add(_)}var A=N.neo(_.x,_.y);e.subMul(n,A),i-=m*(N.crossVec2Vec2(this.m_rA,A)+_.z),o.addMul(r,A),s+=a*(N.crossVec2Vec2(this.m_rB,A)+_.z)}else{var c=N.zero();c.addCombine(1,o,1,N.crossNumVec2(s,this.m_rB)),c.subCombine(1,e,1,N.crossNumVec2(i,this.m_rA));var _=this.m_mass.solve22(N.neg(c));this.m_impulse.x+=_.x,this.m_impulse.y+=_.y,e.subMul(n,_),i-=m*N.crossVec2Vec2(this.m_rA,_),o.addMul(r,_),s+=a*N.crossVec2Vec2(this.m_rB,_)}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=tk.neo(i),r=tk.neo(s),m=0,a=0,h=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=v.inactiveLimit&&!1==h){var c=s-i-this.m_referenceAngle,_=0;if(this.m_limitState==v.equalLimits){var l=S(c-this.m_lowerAngle,-Y.maxAngularCorrection,Y.maxAngularCorrection);_=-this.m_motorMass*l,m=op(l)}else if(this.m_limitState==v.atLowerLimit){var l=c-this.m_lowerAngle;m=-l,l=S(l+Y.angularSlop,-Y.maxAngularCorrection,0),_=-this.m_motorMass*l}else if(this.m_limitState==v.atUpperLimit){var l=c-this.m_upperAngle;m=l,l=S(l-Y.angularSlop,0,Y.maxAngularCorrection),_=-this.m_motorMass*l}i-=this.m_invIA*_,s+=this.m_invIB*_}n.setAngle(i),r.setAngle(s);var u=tk.mulVec2(n,N.sub(this.m_localAnchorA,this.m_localCenterA)),p=tk.mulVec2(r,N.sub(this.m_localAnchorB,this.m_localCenterB)),l=N.zero();l.addCombine(1,o,1,p),l.subCombine(1,e,1,u),a=l.length();var y=this.m_invMassA,d=this.m_invMassB,f=this.m_invIA,x=this.m_invIB,A=new e5;A.ex.x=y+d+f*u.y*u.y+x*p.y*p.y,A.ex.y=-f*u.x*u.y-x*p.x*p.y,A.ey.x=A.ex.y,A.ey.y=y+d+f*u.x*u.x+x*p.x*p.x;var g=N.neg(A.solve(l));return e.subMul(y,g),i-=f*N.crossVec2Vec2(u,g),o.addMul(d,g),s+=x*N.crossVec2Vec2(p,g),this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(o),this.m_bodyB.c_position.a=s,a<=Y.linearSlop&&m<=Y.angularSlop},e.TYPE="revolute-joint",e}(ee),od=Math.abs,of=Math.max,ov=Math.min;(h=x||(x={}))[h.inactiveLimit=0]="inactiveLimit",h[h.atLowerLimit=1]="atLowerLimit",h[h.atUpperLimit=2]="atUpperLimit",h[h.equalLimits=3]="equalLimits";var ox={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0},oA=function(t){function e(i,o,s,n,r){var m=this;return m instanceof e?(i=C(i,ox),o=(m=t.call(this,i,o,s)||this).m_bodyA,s=m.m_bodyB,m.m_type=e.TYPE,m.m_localAnchorA=N.clone(n?o.getLocalPoint(n):i.localAnchorA||N.zero()),m.m_localAnchorB=N.clone(n?s.getLocalPoint(n):i.localAnchorB||N.zero()),m.m_localXAxisA=N.clone(r?o.getLocalVector(r):i.localAxisA||N.neo(1,0)),m.m_localXAxisA.normalize(),m.m_localYAxisA=N.crossNumVec2(1,m.m_localXAxisA),m.m_referenceAngle=Number.isFinite(i.referenceAngle)?i.referenceAngle:s.getAngle()-o.getAngle(),m.m_impulse=new iG,m.m_motorMass=0,m.m_motorImpulse=0,m.m_lowerTranslation=i.lowerTranslation,m.m_upperTranslation=i.upperTranslation,m.m_maxMotorForce=i.maxMotorForce,m.m_motorSpeed=i.motorSpeed,m.m_enableLimit=i.enableLimit,m.m_enableMotor=i.enableMotor,m.m_limitState=x.inactiveLimit,m.m_axis=N.zero(),m.m_perp=N.zero(),m.m_K=new ou,m):new e(i,o,s,n,r)}return V(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerTranslation:this.m_lowerTranslation,upperTranslation:this.m_upperTranslation,maxMotorForce:this.m_maxMotorForce,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA,referenceAngle:this.m_referenceAngle}},e._deserialize=function(t,i,o){return(t=M({},t)).bodyA=o(t7,t.bodyA,i),t.bodyB=o(t7,t.bodyB,i),t.localAxisA=N.clone(t.localAxisA),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),t.localAxisA&&(this.m_localXAxisA.setVec2(t.localAxisA),this.m_localYAxisA.setVec2(N.crossNumVec2(1,t.localAxisA))),Number.isFinite(t.referenceAngle)&&(this.m_referenceAngle=t.referenceAngle),void 0!==t.enableLimit&&(this.m_enableLimit=!!t.enableLimit),Number.isFinite(t.lowerTranslation)&&(this.m_lowerTranslation=t.lowerTranslation),Number.isFinite(t.upperTranslation)&&(this.m_upperTranslation=t.upperTranslation),void 0!==t.enableMotor&&(this.m_enableMotor=!!t.enableMotor),Number.isFinite(t.maxMotorForce)&&(this.m_maxMotorForce=t.maxMotorForce),Number.isFinite(t.motorSpeed)&&(this.m_motorSpeed=t.motorSpeed)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getLocalAxisA=function(){return this.m_localXAxisA},e.prototype.getReferenceAngle=function(){return this.m_referenceAngle},e.prototype.getJointTranslation=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_bodyB.getWorldPoint(this.m_localAnchorB),i=N.sub(e,t),o=this.m_bodyA.getWorldVector(this.m_localXAxisA);return N.dot(i,o)},e.prototype.getJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB,i=tk.mulVec2(t.m_xf.q,N.sub(this.m_localAnchorA,t.m_sweep.localCenter)),o=tk.mulVec2(e.m_xf.q,N.sub(this.m_localAnchorB,e.m_sweep.localCenter)),s=N.add(t.m_sweep.c,i),n=N.add(e.m_sweep.c,o),r=N.sub(n,s),m=tk.mulVec2(t.m_xf.q,this.m_localXAxisA),a=t.m_linearVelocity,h=e.m_linearVelocity,c=t.m_angularVelocity,_=e.m_angularVelocity;return N.dot(r,N.crossNumVec2(c,m))+N.dot(m,N.sub(N.addCrossNumVec2(h,_,o),N.addCrossNumVec2(a,c,i)))},e.prototype.isLimitEnabled=function(){return this.m_enableLimit},e.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},e.prototype.getLowerLimit=function(){return this.m_lowerTranslation},e.prototype.getUpperLimit=function(){return this.m_upperTranslation},e.prototype.setLimits=function(t,e){(t!=this.m_lowerTranslation||e!=this.m_upperTranslation)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)},e.prototype.isMotorEnabled=function(){return this.m_enableMotor},e.prototype.enableMotor=function(t){t!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t)},e.prototype.setMotorSpeed=function(t){t!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t)},e.prototype.setMaxMotorForce=function(t){t!=this.m_maxMotorForce&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=t)},e.prototype.getMaxMotorForce=function(){return this.m_maxMotorForce},e.prototype.getMotorSpeed=function(){return this.m_motorSpeed},e.prototype.getMotorForce=function(t){return t*this.m_motorImpulse},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return N.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_impulse.y},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=tk.neo(i),c=tk.neo(r),_=tk.mulVec2(h,N.sub(this.m_localAnchorA,this.m_localCenterA)),l=tk.mulVec2(c,N.sub(this.m_localAnchorB,this.m_localCenterB)),u=N.zero();u.addCombine(1,n,1,l),u.subCombine(1,e,1,_);var p=this.m_invMassA,y=this.m_invMassB,d=this.m_invIA,f=this.m_invIB;this.m_axis=tk.mulVec2(h,this.m_localXAxisA),this.m_a1=N.crossVec2Vec2(N.add(u,_),this.m_axis),this.m_a2=N.crossVec2Vec2(l,this.m_axis),this.m_motorMass=p+y+d*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_perp=tk.mulVec2(h,this.m_localYAxisA),this.m_s1=N.crossVec2Vec2(N.add(u,_),this.m_perp),this.m_s2=N.crossVec2Vec2(l,this.m_perp),N.crossVec2Vec2(_,this.m_perp);var v=p+y+d*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,A=d*this.m_s1+f*this.m_s2,g=d*this.m_s1*this.m_a1+f*this.m_s2*this.m_a2,b=d+f;0==b&&(b=1);var B=d*this.m_a1+f*this.m_a2,w=p+y+d*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2;if(this.m_K.ex.set(v,A,g),this.m_K.ey.set(A,b,B),this.m_K.ez.set(g,B,w),this.m_enableLimit){var V=N.dot(this.m_axis,u);od(this.m_upperTranslation-this.m_lowerTranslation)<2*Y.linearSlop?this.m_limitState=x.equalLimits:V<=this.m_lowerTranslation?this.m_limitState!=x.atLowerLimit&&(this.m_limitState=x.atLowerLimit,this.m_impulse.z=0):V>=this.m_upperTranslation?this.m_limitState!=x.atUpperLimit&&(this.m_limitState=x.atUpperLimit,this.m_impulse.z=0):(this.m_limitState=x.inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=x.inactiveLimit,this.m_impulse.z=0;if(!1==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var M=N.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),C=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,I=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;o.subMul(p,M),s-=d*C,m.addMul(y,M),a+=f*I}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(o),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.setVec2(m),this.m_bodyB.c_velocity.w=a},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,m=this.m_invIA,a=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=x.equalLimits){var h=N.dot(this.m_axis,N.sub(o,e))+this.m_a2*s-this.m_a1*i,c=this.m_motorMass*(this.m_motorSpeed-h),_=this.m_motorImpulse,l=t.dt*this.m_maxMotorForce;this.m_motorImpulse=S(this.m_motorImpulse+c,-l,l),c=this.m_motorImpulse-_;var u=N.mulNumVec2(c,this.m_axis),p=c*this.m_a1,y=c*this.m_a2;e.subMul(n,u),i-=m*p,o.addMul(r,u),s+=a*y}var d=N.zero();if(d.x+=N.dot(this.m_perp,o)+this.m_s2*s,d.x-=N.dot(this.m_perp,e)+this.m_s1*i,d.y=s-i,this.m_enableLimit&&this.m_limitState!=x.inactiveLimit){var f=0+(N.dot(this.m_axis,o)+this.m_a2*s)-(N.dot(this.m_axis,e)+this.m_a1*i),h=new iG(d.x,d.y,f),v=iG.clone(this.m_impulse),A=this.m_K.solve33(iG.neg(h));this.m_impulse.add(A),this.m_limitState==x.atLowerLimit?this.m_impulse.z=of(this.m_impulse.z,0):this.m_limitState==x.atUpperLimit&&(this.m_impulse.z=ov(this.m_impulse.z,0));var g=N.combine(-1,d,-(this.m_impulse.z-v.z),N.neo(this.m_K.ez.x,this.m_K.ez.y)),b=N.add(this.m_K.solve22(g),N.neo(v.x,v.y));this.m_impulse.x=b.x,this.m_impulse.y=b.y,A=iG.sub(this.m_impulse,v);var u=N.combine(A.x,this.m_perp,A.z,this.m_axis),p=A.x*this.m_s1+A.y+A.z*this.m_a1,y=A.x*this.m_s2+A.y+A.z*this.m_a2;e.subMul(n,u),i-=m*p,o.addMul(r,u),s+=a*y}else{var A=this.m_K.solve22(N.neg(d));this.m_impulse.x+=A.x,this.m_impulse.y+=A.y;var u=N.mulNumVec2(A.x,this.m_perp),p=A.x*this.m_s1+A.y,y=A.x*this.m_s2+A.y;e.subMul(n,u),i-=m*p,o.addMul(r,u),s+=a*y}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=tk.neo(i),r=tk.neo(s),m=this.m_invMassA,a=this.m_invMassB,h=this.m_invIA,c=this.m_invIB,_=tk.mulVec2(n,N.sub(this.m_localAnchorA,this.m_localCenterA)),l=tk.mulVec2(r,N.sub(this.m_localAnchorB,this.m_localCenterB)),u=N.sub(N.add(o,l),N.add(e,_)),p=tk.mulVec2(n,this.m_localXAxisA),y=N.crossVec2Vec2(N.add(u,_),p),d=N.crossVec2Vec2(l,p),f=tk.mulVec2(n,this.m_localYAxisA),v=N.crossVec2Vec2(N.add(u,_),f),x=N.crossVec2Vec2(l,f),A=new iG,g=N.zero();g.x=N.dot(f,u),g.y=s-i-this.m_referenceAngle;var b=od(g.x),B=od(g.y),w=Y.linearSlop,V=Y.maxLinearCorrection,M=!1,C=0;if(this.m_enableLimit){var I=N.dot(p,u);od(this.m_upperTranslation-this.m_lowerTranslation)<2*w?(C=S(I,-V,V),b=of(b,od(I)),M=!0):I<=this.m_lowerTranslation?(C=S(I-this.m_lowerTranslation+w,-V,0),b=Math.max(b,this.m_lowerTranslation-I),M=!0):I>=this.m_upperTranslation&&(C=S(I-this.m_upperTranslation-w,0,V),b=Math.max(b,I-this.m_upperTranslation),M=!0)}if(M){var z=m+a+h*v*v+c*x*x,P=h*v+c*x,L=h*v*y+c*x*d,F=h+c;0==F&&(F=1);var T=h*y+c*d,q=new ou;q.ex.set(z,P,L),q.ey.set(P,F,T),q.ez.set(L,T,m+a+h*y*y+c*d*d);var k=new iG;k.x=g.x,k.y=g.y,k.z=C,A=q.solve33(iG.neg(k))}else{var z=m+a+h*v*v+c*x*x,P=h*v+c*x,F=h+c;0==F&&(F=1);var q=new e5;q.ex.setNum(z,P),q.ey.setNum(P,F);var j=q.solve(N.neg(g));A.x=j.x,A.y=j.y,A.z=0}var D=N.combine(A.x,f,A.z,p),R=A.x*v+A.y+A.z*y,O=A.x*x+A.y+A.z*d;return e.subMul(m,D),i-=h*R,o.addMul(a,D),s+=c*O,this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=o,this.m_bodyB.c_position.a=s,b<=Y.linearSlop&&B<=Y.angularSlop},e.TYPE="prismatic-joint",e}(ee),og={ratio:1},ob=function(t){function e(i,o,s,n,r,m){var a,h,c=this;if(!(c instanceof e))return new e(i,o,s,n,r,m);i=C(i,og),o=(c=t.call(this,i,o,s)||this).m_bodyA,s=c.m_bodyB,c.m_type=e.TYPE,c.m_joint1=n||i.joint1,c.m_joint2=r||i.joint2,c.m_ratio=Number.isFinite(m)?m:i.ratio,c.m_type1=c.m_joint1.getType(),c.m_type2=c.m_joint2.getType(),c.m_bodyC=c.m_joint1.getBodyA(),c.m_bodyA=c.m_joint1.getBodyB();var _=c.m_bodyA.m_xf,l=c.m_bodyA.m_sweep.a,u=c.m_bodyC.m_xf,p=c.m_bodyC.m_sweep.a;if(c.m_type1===oy.TYPE){var y=c.m_joint1;c.m_localAnchorC=y.m_localAnchorA,c.m_localAnchorA=y.m_localAnchorB,c.m_referenceAngleA=y.m_referenceAngle,c.m_localAxisC=N.zero(),a=l-p-c.m_referenceAngleA}else{var d=c.m_joint1;c.m_localAnchorC=d.m_localAnchorA,c.m_localAnchorA=d.m_localAnchorB,c.m_referenceAngleA=d.m_referenceAngle,c.m_localAxisC=d.m_localXAxisA;var f=c.m_localAnchorC,v=tk.mulTVec2(u.q,N.add(tk.mulVec2(_.q,c.m_localAnchorA),N.sub(_.p,u.p)));a=N.dot(v,c.m_localAxisC)-N.dot(f,c.m_localAxisC)}c.m_bodyD=c.m_joint2.getBodyA(),c.m_bodyB=c.m_joint2.getBodyB();var x=c.m_bodyB.m_xf,A=c.m_bodyB.m_sweep.a,g=c.m_bodyD.m_xf,b=c.m_bodyD.m_sweep.a;if(c.m_type2===oy.TYPE){var y=c.m_joint2;c.m_localAnchorD=y.m_localAnchorA,c.m_localAnchorB=y.m_localAnchorB,c.m_referenceAngleB=y.m_referenceAngle,c.m_localAxisD=N.zero(),h=A-b-c.m_referenceAngleB}else{var d=c.m_joint2;c.m_localAnchorD=d.m_localAnchorA,c.m_localAnchorB=d.m_localAnchorB,c.m_referenceAngleB=d.m_referenceAngle,c.m_localAxisD=d.m_localXAxisA;var B=c.m_localAnchorD,w=tk.mulTVec2(g.q,N.add(tk.mulVec2(x.q,c.m_localAnchorB),N.sub(x.p,g.p)));h=N.dot(w,c.m_localAxisD)-N.dot(B,c.m_localAxisD)}return c.m_constant=a+c.m_ratio*h,c.m_impulse=0,c}return V(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,joint1:this.m_joint1,joint2:this.m_joint2,ratio:this.m_ratio}},e._deserialize=function(t,i,o){return(t=M({},t)).bodyA=o(t7,t.bodyA,i),t.bodyB=o(t7,t.bodyB,i),t.joint1=o(ee,t.joint1,i),t.joint2=o(ee,t.joint2,i),new e(t)},e.prototype._reset=function(t){Number.isFinite(t.ratio)&&(this.m_ratio=t.ratio)},e.prototype.getJoint1=function(){return this.m_joint1},e.prototype.getJoint2=function(){return this.m_joint2},e.prototype.setRatio=function(t){this.m_ratio=t},e.prototype.getRatio=function(){return this.m_ratio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return N.mulNumVec2(this.m_impulse,this.m_JvAC).mul(t)},e.prototype.getReactionTorque=function(t){return t*(this.m_impulse*this.m_JwA)},e.prototype.initVelocityConstraints=function(t){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,m=this.m_bodyC.c_position.a,a=this.m_bodyC.c_velocity.v,h=this.m_bodyC.c_velocity.w,c=this.m_bodyD.c_position.a,_=this.m_bodyD.c_velocity.v,l=this.m_bodyD.c_velocity.w,u=tk.neo(e),p=tk.neo(s),y=tk.neo(m),d=tk.neo(c);if(this.m_mass=0,this.m_type1==oy.TYPE)this.m_JvAC=N.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var f=tk.mulVec2(y,this.m_localAxisC),v=tk.mulSub(y,this.m_localAnchorC,this.m_lcC),x=tk.mulSub(u,this.m_localAnchorA,this.m_lcA);this.m_JvAC=f,this.m_JwC=N.crossVec2Vec2(v,f),this.m_JwA=N.crossVec2Vec2(x,f),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==oy.TYPE)this.m_JvBD=N.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var f=tk.mulVec2(d,this.m_localAxisD),A=tk.mulSub(d,this.m_localAnchorD,this.m_lcD),g=tk.mulSub(p,this.m_localAnchorB,this.m_lcB);this.m_JvBD=N.mulNumVec2(this.m_ratio,f),this.m_JwD=this.m_ratio*N.crossVec2Vec2(A,f),this.m_JwB=this.m_ratio*N.crossVec2Vec2(g,f),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.warmStarting?(i.addMul(this.m_mA*this.m_impulse,this.m_JvAC),o+=this.m_iA*this.m_impulse*this.m_JwA,n.addMul(this.m_mB*this.m_impulse,this.m_JvBD),r+=this.m_iB*this.m_impulse*this.m_JwB,a.subMul(this.m_mC*this.m_impulse,this.m_JvAC),h-=this.m_iC*this.m_impulse*this.m_JwC,_.subMul(this.m_mD*this.m_impulse,this.m_JvBD),l-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.setVec2(i),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(n),this.m_bodyB.c_velocity.w=r,this.m_bodyC.c_velocity.v.setVec2(a),this.m_bodyC.c_velocity.w=h,this.m_bodyD.c_velocity.v.setVec2(_),this.m_bodyD.c_velocity.w=l},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_bodyC.c_velocity.v,r=this.m_bodyC.c_velocity.w,m=this.m_bodyD.c_velocity.v,a=this.m_bodyD.c_velocity.w,h=N.dot(this.m_JvAC,e)-N.dot(this.m_JvAC,n)+N.dot(this.m_JvBD,o)-N.dot(this.m_JvBD,m);h+=this.m_JwA*i-this.m_JwC*r+(this.m_JwB*s-this.m_JwD*a);var c=-this.m_mass*h;this.m_impulse+=c,e.addMul(this.m_mA*c,this.m_JvAC),i+=this.m_iA*c*this.m_JwA,o.addMul(this.m_mB*c,this.m_JvBD),s+=this.m_iB*c*this.m_JwB,n.subMul(this.m_mC*c,this.m_JvAC),r-=this.m_iC*c*this.m_JwC,m.subMul(this.m_mD*c,this.m_JvBD),a-=this.m_iD*c*this.m_JwD,this.m_bodyA.c_velocity.v.setVec2(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.setVec2(o),this.m_bodyB.c_velocity.w=s,this.m_bodyC.c_velocity.v.setVec2(n),this.m_bodyC.c_velocity.w=r,this.m_bodyD.c_velocity.v.setVec2(m),this.m_bodyD.c_velocity.w=a},e.prototype.solvePositionConstraints=function(t){var e,i,o,s,n,r,m,a,h=this.m_bodyA.c_position.c,c=this.m_bodyA.c_position.a,_=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,u=this.m_bodyC.c_position.c,p=this.m_bodyC.c_position.a,y=this.m_bodyD.c_position.c,d=this.m_bodyD.c_position.a,f=tk.neo(c),v=tk.neo(l),x=tk.neo(p),A=tk.neo(d),g=0;if(this.m_type1==oy.TYPE)o=N.zero(),n=1,m=1,g+=this.m_iA+this.m_iC,e=c-p-this.m_referenceAngleA;else{var b=tk.mulVec2(x,this.m_localAxisC),B=tk.mulSub(x,this.m_localAnchorC,this.m_lcC),w=tk.mulSub(f,this.m_localAnchorA,this.m_lcA);o=b,m=N.crossVec2Vec2(B,b),n=N.crossVec2Vec2(w,b),g+=this.m_mC+this.m_mA+this.m_iC*m*m+this.m_iA*n*n;var V=N.sub(this.m_localAnchorC,this.m_lcC),M=tk.mulTVec2(x,N.add(w,N.sub(h,u)));e=N.dot(N.sub(M,V),this.m_localAxisC)}if(this.m_type2==oy.TYPE)s=N.zero(),r=this.m_ratio,a=this.m_ratio,g+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),i=l-d-this.m_referenceAngleB;else{var b=tk.mulVec2(A,this.m_localAxisD),C=tk.mulSub(A,this.m_localAnchorD,this.m_lcD),I=tk.mulSub(v,this.m_localAnchorB,this.m_lcB);s=N.mulNumVec2(this.m_ratio,b),a=this.m_ratio*N.crossVec2Vec2(C,b),r=this.m_ratio*N.crossVec2Vec2(I,b),g+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*a*a+this.m_iB*r*r;var z=N.sub(this.m_localAnchorD,this.m_lcD),P=tk.mulTVec2(A,N.add(I,N.sub(_,y)));i=N.dot(P,this.m_localAxisD)-N.dot(z,this.m_localAxisD)}var S=e+this.m_ratio*i-this.m_constant,L=0;return g>0&&(L=-S/g),h.addMul(this.m_mA*L,o),c+=this.m_iA*L*n,_.addMul(this.m_mB*L,s),l+=this.m_iB*L*r,u.subMul(this.m_mC*L,o),p-=this.m_iC*L*m,y.subMul(this.m_mD*L,s),d-=this.m_iD*L*a,this.m_bodyA.c_position.c.setVec2(h),this.m_bodyA.c_position.a=c,this.m_bodyB.c_position.c.setVec2(_),this.m_bodyB.c_position.a=l,this.m_bodyC.c_position.c.setVec2(u),this.m_bodyC.c_position.a=p,this.m_bodyD.c_position.c.setVec2(y),this.m_bodyD.c_position.a=d,0<Y.linearSlop},e.TYPE="gear-joint",e}(ee),oB={maxForce:1,maxTorque:1,correctionFactor:.3},ow=function(t){function e(i,o,s){var n=this;return n instanceof e?(i=C(i,oB),o=(n=t.call(this,i,o,s)||this).m_bodyA,s=n.m_bodyB,n.m_type=e.TYPE,n.m_linearOffset=N.isValid(i.linearOffset)?N.clone(i.linearOffset):o.getLocalPoint(s.getPosition()),n.m_angularOffset=Number.isFinite(i.angularOffset)?i.angularOffset:s.getAngle()-o.getAngle(),n.m_linearImpulse=N.zero(),n.m_angularImpulse=0,n.m_maxForce=i.maxForce,n.m_maxTorque=i.maxTorque,n.m_correctionFactor=i.correctionFactor,n):new e(i,o,s)}return V(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,correctionFactor:this.m_correctionFactor,linearOffset:this.m_linearOffset,angularOffset:this.m_angularOffset}},e._deserialize=function(t,i,o){return(t=M({},t)).bodyA=o(t7,t.bodyA,i),t.bodyB=o(t7,t.bodyB,i),new e(t)},e.prototype._reset=function(t){Number.isFinite(t.angularOffset)&&(this.m_angularOffset=t.angularOffset),Number.isFinite(t.maxForce)&&(this.m_maxForce=t.maxForce),Number.isFinite(t.maxTorque)&&(this.m_maxTorque=t.maxTorque),Number.isFinite(t.correctionFactor)&&(this.m_correctionFactor=t.correctionFactor),N.isValid(t.linearOffset)&&this.m_linearOffset.set(t.linearOffset)},e.prototype.setMaxForce=function(t){this.m_maxForce=t},e.prototype.getMaxForce=function(){return this.m_maxForce},e.prototype.setMaxTorque=function(t){this.m_maxTorque=t},e.prototype.getMaxTorque=function(){return this.m_maxTorque},e.prototype.setCorrectionFactor=function(t){this.m_correctionFactor=t},e.prototype.getCorrectionFactor=function(){return this.m_correctionFactor},e.prototype.setLinearOffset=function(t){(t.x!=this.m_linearOffset.x||t.y!=this.m_linearOffset.y)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset.set(t))},e.prototype.getLinearOffset=function(){return this.m_linearOffset},e.prototype.setAngularOffset=function(t){t!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=t)},e.prototype.getAngularOffset=function(){return this.m_angularOffset},e.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()},e.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()},e.prototype.getReactionForce=function(t){return N.mulNumVec2(t,this.m_linearImpulse)},e.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=tk.neo(i),c=tk.neo(r);this.m_rA=tk.mulVec2(h,N.sub(this.m_linearOffset,this.m_localCenterA)),this.m_rB=tk.mulVec2(c,N.neg(this.m_localCenterB));var _=this.m_invMassA,l=this.m_invMassB,u=this.m_invIA,p=this.m_invIB,y=new e5;if(y.ex.x=_+l+u*this.m_rA.y*this.m_rA.y+p*this.m_rB.y*this.m_rB.y,y.ex.y=-u*this.m_rA.x*this.m_rA.y-p*this.m_rB.x*this.m_rB.y,y.ey.x=y.ex.y,y.ey.y=_+l+u*this.m_rA.x*this.m_rA.x+p*this.m_rB.x*this.m_rB.x,this.m_linearMass=y.getInverse(),this.m_angularMass=u+p,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=N.zero(),this.m_linearError.addCombine(1,n,1,this.m_rB),this.m_linearError.subCombine(1,e,1,this.m_rA),this.m_angularError=r-i-this.m_angularOffset,t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var d=N.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);o.subMul(_,d),s-=u*(N.crossVec2Vec2(this.m_rA,d)+this.m_angularImpulse),m.addMul(l,d),a+=p*(N.crossVec2Vec2(this.m_rB,d)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=o,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=m,this.m_bodyB.c_velocity.w=a},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,m=this.m_invIA,a=this.m_invIB,h=t.dt,c=t.inv_dt,_=s-i+c*this.m_correctionFactor*this.m_angularError,l=-this.m_angularMass*_,u=this.m_angularImpulse,p=h*this.m_maxTorque;this.m_angularImpulse=S(this.m_angularImpulse+l,-p,p),i-=m*(l=this.m_angularImpulse-u),s+=a*l;var _=N.zero();_.addCombine(1,o,1,N.crossNumVec2(s,this.m_rB)),_.subCombine(1,e,1,N.crossNumVec2(i,this.m_rA)),_.addMul(c*this.m_correctionFactor,this.m_linearError);var l=N.neg(e5.mulVec2(this.m_linearMass,_)),u=N.clone(this.m_linearImpulse);this.m_linearImpulse.add(l);var p=h*this.m_maxForce;this.m_linearImpulse.clamp(p),l=N.sub(this.m_linearImpulse,u),e.subMul(n,l),i-=m*N.crossVec2Vec2(this.m_rA,l),o.addMul(r,l),s+=a*N.crossVec2Vec2(this.m_rB,l),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){return!0},e.TYPE="motor-joint",e}(ee),oV=Math.PI,oM={maxForce:0,frequencyHz:5,dampingRatio:.7},oC=function(t){function e(i,o,s,n){var r=this;return r instanceof e?(i=C(i,oM),o=(r=t.call(this,i,o,s)||this).m_bodyA,s=r.m_bodyB,r.m_type=e.TYPE,N.isValid(n)?r.m_targetA=N.clone(n):N.isValid(i.target)?r.m_targetA=N.clone(i.target):r.m_targetA=N.zero(),r.m_localAnchorB=tO.mulTVec2(s.getTransform(),r.m_targetA),r.m_maxForce=i.maxForce,r.m_impulse=N.zero(),r.m_frequencyHz=i.frequencyHz,r.m_dampingRatio=i.dampingRatio,r.m_beta=0,r.m_gamma=0,r.m_rB=N.zero(),r.m_localCenterB=N.zero(),r.m_invMassB=0,r.m_invIB=0,r.m_mass=new e5,r.m_C=N.zero(),r):new e(i,o,s,n)}return V(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,target:this.m_targetA,maxForce:this.m_maxForce,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,_localAnchorB:this.m_localAnchorB}},e._deserialize=function(t,i,o){(t=M({},t)).bodyA=o(t7,t.bodyA,i),t.bodyB=o(t7,t.bodyB,i),t.target=N.clone(t.target);var s=new e(t);return t._localAnchorB&&(s.m_localAnchorB=t._localAnchorB),s},e.prototype._reset=function(t){Number.isFinite(t.maxForce)&&(this.m_maxForce=t.maxForce),Number.isFinite(t.frequencyHz)&&(this.m_frequencyHz=t.frequencyHz),Number.isFinite(t.dampingRatio)&&(this.m_dampingRatio=t.dampingRatio)},e.prototype.setTarget=function(t){N.areEqual(t,this.m_targetA)||(this.m_bodyB.setAwake(!0),this.m_targetA.set(t))},e.prototype.getTarget=function(){return this.m_targetA},e.prototype.setMaxForce=function(t){this.m_maxForce=t},e.prototype.getMaxForce=function(){return this.m_maxForce},e.prototype.setFrequency=function(t){this.m_frequencyHz=t},e.prototype.getFrequency=function(){return this.m_frequencyHz},e.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return N.clone(this.m_targetA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return N.mulNumVec2(t,this.m_impulse)},e.prototype.getReactionTorque=function(t){return 0*t},e.prototype.shiftOrigin=function(t){this.m_targetA.sub(t)},e.prototype.initVelocityConstraints=function(t){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyB.c_position,i=this.m_bodyB.c_velocity,o=e.c,s=e.a,n=i.v,r=i.w,m=tk.neo(s),a=this.m_bodyB.getMass(),h=2*oV*this.m_frequencyHz,c=2*a*this.m_dampingRatio*h,_=h*h*a,l=t.dt;this.m_gamma=l*(c+l*_),0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=l*_*this.m_gamma,this.m_rB=tk.mulVec2(m,N.sub(this.m_localAnchorB,this.m_localCenterB));var u=new e5;u.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,u.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,u.ey.x=u.ex.y,u.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=u.getInverse(),this.m_C.setVec2(o),this.m_C.addCombine(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),r*=.98,t.warmStarting?(this.m_impulse.mul(t.dtRatio),n.addMul(this.m_invMassB,this.m_impulse),r+=this.m_invIB*N.crossVec2Vec2(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),i.v.setVec2(n),i.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyB.c_velocity,i=N.clone(e.v),o=e.w,s=N.crossNumVec2(o,this.m_rB);s.add(i),s.addCombine(1,this.m_C,this.m_gamma,this.m_impulse),s.neg();var n=e5.mulVec2(this.m_mass,s),r=N.clone(this.m_impulse);this.m_impulse.add(n);var m=t.dt*this.m_maxForce;this.m_impulse.clamp(m),n=N.sub(this.m_impulse,r),i.addMul(this.m_invMassB,n),o+=this.m_invIB*N.crossVec2Vec2(this.m_rB,n),e.v.setVec2(i),e.w=o},e.prototype.solvePositionConstraints=function(t){return!0},e.TYPE="mouse-joint",e}(ee),oI=Math.abs,oz={collideConnected:!0},oP=function(t){function e(i,o,s,n,r,m,a,h){var c=this;return c instanceof e?(i=C(i,oz),o=(c=t.call(this,i,o,s)||this).m_bodyA,s=c.m_bodyB,c.m_type=e.TYPE,c.m_groundAnchorA=N.clone(n||i.groundAnchorA||N.neo(-1,1)),c.m_groundAnchorB=N.clone(r||i.groundAnchorB||N.neo(1,1)),c.m_localAnchorA=N.clone(m?o.getLocalPoint(m):i.localAnchorA||N.neo(-1,0)),c.m_localAnchorB=N.clone(a?s.getLocalPoint(a):i.localAnchorB||N.neo(1,0)),c.m_lengthA=Number.isFinite(i.lengthA)?i.lengthA:N.distance(m,n),c.m_lengthB=Number.isFinite(i.lengthB)?i.lengthB:N.distance(a,r),c.m_ratio=Number.isFinite(h)?h:i.ratio,c.m_constant=c.m_lengthA+c.m_ratio*c.m_lengthB,c.m_impulse=0,c):new e(i,o,s,n,r,m,a,h)}return V(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,groundAnchorA:this.m_groundAnchorA,groundAnchorB:this.m_groundAnchorB,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,lengthA:this.m_lengthA,lengthB:this.m_lengthB,ratio:this.m_ratio}},e._deserialize=function(t,i,o){return(t=M({},t)).bodyA=o(t7,t.bodyA,i),t.bodyB=o(t7,t.bodyB,i),new e(t)},e.prototype._reset=function(t){N.isValid(t.groundAnchorA)&&this.m_groundAnchorA.set(t.groundAnchorA),N.isValid(t.groundAnchorB)&&this.m_groundAnchorB.set(t.groundAnchorB),N.isValid(t.localAnchorA)?this.m_localAnchorA.set(t.localAnchorA):N.isValid(t.anchorA)&&this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)),N.isValid(t.localAnchorB)?this.m_localAnchorB.set(t.localAnchorB):N.isValid(t.anchorB)&&this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)),Number.isFinite(t.lengthA)&&(this.m_lengthA=t.lengthA),Number.isFinite(t.lengthB)&&(this.m_lengthB=t.lengthB),Number.isFinite(t.ratio)&&(this.m_ratio=t.ratio)},e.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA},e.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB},e.prototype.getLengthA=function(){return this.m_lengthA},e.prototype.getLengthB=function(){return this.m_lengthB},e.prototype.getRatio=function(){return this.m_ratio},e.prototype.getCurrentLengthA=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_groundAnchorA;return N.distance(t,e)},e.prototype.getCurrentLengthB=function(){var t=this.m_bodyB.getWorldPoint(this.m_localAnchorB),e=this.m_groundAnchorB;return N.distance(t,e)},e.prototype.shiftOrigin=function(t){this.m_groundAnchorA.sub(t),this.m_groundAnchorB.sub(t)},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return N.mulNumVec2(this.m_impulse,this.m_uB).mul(t)},e.prototype.getReactionTorque=function(t){return 0},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=tk.neo(i),c=tk.neo(r);this.m_rA=tk.mulVec2(h,N.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=tk.mulVec2(c,N.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=N.sub(N.add(e,this.m_rA),this.m_groundAnchorA),this.m_uB=N.sub(N.add(n,this.m_rB),this.m_groundAnchorB);var _=this.m_uA.length(),l=this.m_uB.length();_>10*Y.linearSlop?this.m_uA.mul(1/_):this.m_uA.setZero(),l>10*Y.linearSlop?this.m_uB.mul(1/l):this.m_uB.setZero();var u=N.crossVec2Vec2(this.m_rA,this.m_uA),p=N.crossVec2Vec2(this.m_rB,this.m_uB),y=this.m_invMassA+this.m_invIA*u*u,d=this.m_invMassB+this.m_invIB*p*p;if(this.m_mass=y+this.m_ratio*this.m_ratio*d,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.warmStarting){this.m_impulse*=t.dtRatio;var f=N.mulNumVec2(-this.m_impulse,this.m_uA),v=N.mulNumVec2(-this.m_ratio*this.m_impulse,this.m_uB);o.addMul(this.m_invMassA,f),s+=this.m_invIA*N.crossVec2Vec2(this.m_rA,f),m.addMul(this.m_invMassB,v),a+=this.m_invIB*N.crossVec2Vec2(this.m_rB,v)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=o,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=m,this.m_bodyB.c_velocity.w=a},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=N.add(e,N.crossNumVec2(i,this.m_rA)),r=N.add(o,N.crossNumVec2(s,this.m_rB)),m=-N.dot(this.m_uA,n)-this.m_ratio*N.dot(this.m_uB,r),a=-this.m_mass*m;this.m_impulse+=a;var h=N.mulNumVec2(-a,this.m_uA),c=N.mulNumVec2(-this.m_ratio*a,this.m_uB);e.addMul(this.m_invMassA,h),i+=this.m_invIA*N.crossVec2Vec2(this.m_rA,h),o.addMul(this.m_invMassB,c),s+=this.m_invIB*N.crossVec2Vec2(this.m_rB,c),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=tk.neo(i),r=tk.neo(s),m=tk.mulVec2(n,N.sub(this.m_localAnchorA,this.m_localCenterA)),a=tk.mulVec2(r,N.sub(this.m_localAnchorB,this.m_localCenterB)),h=N.sub(N.add(e,this.m_rA),this.m_groundAnchorA),c=N.sub(N.add(o,this.m_rB),this.m_groundAnchorB),_=h.length(),l=c.length();_>10*Y.linearSlop?h.mul(1/_):h.setZero(),l>10*Y.linearSlop?c.mul(1/l):c.setZero();var u=N.crossVec2Vec2(m,h),p=N.crossVec2Vec2(a,c),y=this.m_invMassA+this.m_invIA*u*u,d=this.m_invMassB+this.m_invIB*p*p,f=y+this.m_ratio*this.m_ratio*d;f>0&&(f=1/f);var v=this.m_constant-_-this.m_ratio*l,x=oI(v),A=-f*v,g=N.mulNumVec2(-A,h),b=N.mulNumVec2(-this.m_ratio*A,c);return e.addMul(this.m_invMassA,g),i+=this.m_invIA*N.crossVec2Vec2(m,g),o.addMul(this.m_invMassB,b),s+=this.m_invIB*N.crossVec2Vec2(a,b),this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=o,this.m_bodyB.c_position.a=s,x<Y.linearSlop},e.TYPE="pulley-joint",e}(ee),oS=Math.min;(c=A||(A={}))[c.inactiveLimit=0]="inactiveLimit",c[c.atLowerLimit=1]="atLowerLimit",c[c.atUpperLimit=2]="atUpperLimit",c[c.equalLimits=3]="equalLimits";var oL={maxLength:0},oF=function(t){function e(i,o,s,n){var r=this;return r instanceof e?(i=C(i,oL),o=(r=t.call(this,i,o,s)||this).m_bodyA,s=r.m_bodyB,r.m_type=e.TYPE,r.m_localAnchorA=N.clone(n?o.getLocalPoint(n):i.localAnchorA||N.neo(-1,0)),r.m_localAnchorB=N.clone(n?s.getLocalPoint(n):i.localAnchorB||N.neo(1,0)),r.m_maxLength=i.maxLength,r.m_mass=0,r.m_impulse=0,r.m_length=0,r.m_state=A.inactiveLimit,r):new e(i,o,s,n)}return V(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,maxLength:this.m_maxLength}},e._deserialize=function(t,i,o){return(t=M({},t)).bodyA=o(t7,t.bodyA,i),t.bodyB=o(t7,t.bodyB,i),new e(t)},e.prototype._reset=function(t){Number.isFinite(t.maxLength)&&(this.m_maxLength=t.maxLength)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.setMaxLength=function(t){this.m_maxLength=t},e.prototype.getMaxLength=function(){return this.m_maxLength},e.prototype.getLimitState=function(){return this.m_state},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return N.mulNumVec2(this.m_impulse,this.m_u).mul(t)},e.prototype.getReactionTorque=function(t){return 0},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=tk.neo(i),c=tk.neo(r);if(this.m_rA=tk.mulSub(h,this.m_localAnchorA,this.m_localCenterA),this.m_rB=tk.mulSub(c,this.m_localAnchorB,this.m_localCenterB),this.m_u=N.zero(),this.m_u.addCombine(1,n,1,this.m_rB),this.m_u.subCombine(1,e,1,this.m_rA),this.m_length=this.m_u.length(),this.m_length-this.m_maxLength>0?this.m_state=A.atUpperLimit:this.m_state=A.inactiveLimit,this.m_length>Y.linearSlop)this.m_u.mul(1/this.m_length);else{this.m_u.setZero(),this.m_mass=0,this.m_impulse=0;return}var _=N.crossVec2Vec2(this.m_rA,this.m_u),l=N.crossVec2Vec2(this.m_rB,this.m_u),u=this.m_invMassA+this.m_invIA*_*_+this.m_invMassB+this.m_invIB*l*l;if(this.m_mass=0!=u?1/u:0,t.warmStarting){this.m_impulse*=t.dtRatio;var p=N.mulNumVec2(this.m_impulse,this.m_u);o.subMul(this.m_invMassA,p),s-=this.m_invIA*N.crossVec2Vec2(this.m_rA,p),m.addMul(this.m_invMassB,p),a+=this.m_invIB*N.crossVec2Vec2(this.m_rB,p)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(o),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.setVec2(m),this.m_bodyB.c_velocity.w=a},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=N.addCrossNumVec2(e,i,this.m_rA),r=N.addCrossNumVec2(o,s,this.m_rB),m=this.m_length-this.m_maxLength,a=N.dot(this.m_u,N.sub(r,n));m<0&&(a+=t.inv_dt*m);var h=-this.m_mass*a,c=this.m_impulse;this.m_impulse=oS(0,this.m_impulse+h),h=this.m_impulse-c;var _=N.mulNumVec2(h,this.m_u);e.subMul(this.m_invMassA,_),i-=this.m_invIA*N.crossVec2Vec2(this.m_rA,_),o.addMul(this.m_invMassB,_),s+=this.m_invIB*N.crossVec2Vec2(this.m_rB,_),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=tk.neo(i),r=tk.neo(s),m=tk.mulSub(n,this.m_localAnchorA,this.m_localCenterA),a=tk.mulSub(r,this.m_localAnchorB,this.m_localCenterB),h=N.zero();h.addCombine(1,o,1,a),h.subCombine(1,e,1,m);var c=h.normalize(),_=c-this.m_maxLength;_=S(_,0,Y.maxLinearCorrection);var l=-this.m_mass*_,u=N.mulNumVec2(l,h);return e.subMul(this.m_invMassA,u),i-=this.m_invIA*N.crossVec2Vec2(m,u),o.addMul(this.m_invMassB,u),s+=this.m_invIB*N.crossVec2Vec2(a,u),this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(o),this.m_bodyB.c_position.a=s,c-this.m_maxLength<Y.linearSlop},e.TYPE="rope-joint",e}(ee),oT=Math.abs,oq=Math.PI,ok={frequencyHz:0,dampingRatio:0},oN=function(t){function e(i,o,s,n){var r=this;return r instanceof e?(i=C(i,ok),o=(r=t.call(this,i,o,s)||this).m_bodyA,s=r.m_bodyB,r.m_type=e.TYPE,r.m_localAnchorA=N.clone(n?o.getLocalPoint(n):i.localAnchorA||N.zero()),r.m_localAnchorB=N.clone(n?s.getLocalPoint(n):i.localAnchorB||N.zero()),r.m_referenceAngle=Number.isFinite(i.referenceAngle)?i.referenceAngle:s.getAngle()-o.getAngle(),r.m_frequencyHz=i.frequencyHz,r.m_dampingRatio=i.dampingRatio,r.m_impulse=new iG,r.m_bias=0,r.m_gamma=0,r.m_mass=new ou,r):new e(i,o,s,n)}return V(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},e._deserialize=function(t,i,o){return(t=M({},t)).bodyA=o(t7,t.bodyA,i),t.bodyB=o(t7,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),Number.isFinite(t.frequencyHz)&&(this.m_frequencyHz=t.frequencyHz),Number.isFinite(t.dampingRatio)&&(this.m_dampingRatio=t.dampingRatio)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getReferenceAngle=function(){return this.m_referenceAngle},e.prototype.setFrequency=function(t){this.m_frequencyHz=t},e.prototype.getFrequency=function(){return this.m_frequencyHz},e.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return N.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,m=tk.neo(e),a=tk.neo(s);this.m_rA=tk.mulVec2(m,N.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=tk.mulVec2(a,N.sub(this.m_localAnchorB,this.m_localCenterB));var h=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,l=this.m_invIB,u=new ou;if(u.ex.x=h+c+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*l,u.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*l,u.ez.x=-this.m_rA.y*_-this.m_rB.y*l,u.ex.y=u.ey.x,u.ey.y=h+c+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*l,u.ez.y=this.m_rA.x*_+this.m_rB.x*l,u.ex.z=u.ez.x,u.ey.z=u.ez.y,u.ez.z=_+l,this.m_frequencyHz>0){u.getInverse22(this.m_mass);var p=_+l,y=p>0?1/p:0,d=s-e-this.m_referenceAngle,f=2*oq*this.m_frequencyHz,v=2*y*this.m_dampingRatio*f,x=y*f*f,A=t.dt;this.m_gamma=A*(v+A*x),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=d*A*x*this.m_gamma,p+=this.m_gamma,this.m_mass.ez.z=0!=p?1/p:0}else 0==u.ez.z?u.getInverse22(this.m_mass):u.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.warmStarting){this.m_impulse.mul(t.dtRatio);var g=N.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(h,g),o-=_*(N.crossVec2Vec2(this.m_rA,g)+this.m_impulse.z),n.addMul(c,g),r+=l*(N.crossVec2Vec2(this.m_rB,g)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,m=this.m_invIA,a=this.m_invIB;if(this.m_frequencyHz>0){var h=s-i,c=-this.m_mass.ez.z*(h+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=c,i-=m*c,s+=a*c;var _=N.zero();_.addCombine(1,o,1,N.crossNumVec2(s,this.m_rB)),_.subCombine(1,e,1,N.crossNumVec2(i,this.m_rA));var l=N.neg(ou.mulVec2(this.m_mass,_));this.m_impulse.x+=l.x,this.m_impulse.y+=l.y;var u=N.clone(l);e.subMul(n,u),i-=m*N.crossVec2Vec2(this.m_rA,u),o.addMul(r,u),s+=a*N.crossVec2Vec2(this.m_rB,u)}else{var _=N.zero();_.addCombine(1,o,1,N.crossNumVec2(s,this.m_rB)),_.subCombine(1,e,1,N.crossNumVec2(i,this.m_rA));var h=s-i,p=new iG(_.x,_.y,h),y=iG.neg(ou.mulVec3(this.m_mass,p));this.m_impulse.add(y);var u=N.neo(y.x,y.y);e.subMul(n,u),i-=m*(N.crossVec2Vec2(this.m_rA,u)+y.z),o.addMul(r,u),s+=a*(N.crossVec2Vec2(this.m_rB,u)+y.z)}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){var e,i,o=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,m=tk.neo(s),a=tk.neo(r),h=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,l=this.m_invIB,u=tk.mulVec2(m,N.sub(this.m_localAnchorA,this.m_localCenterA)),p=tk.mulVec2(a,N.sub(this.m_localAnchorB,this.m_localCenterB)),y=new ou;if(y.ex.x=h+c+u.y*u.y*_+p.y*p.y*l,y.ey.x=-u.y*u.x*_-p.y*p.x*l,y.ez.x=-u.y*_-p.y*l,y.ex.y=y.ey.x,y.ey.y=h+c+u.x*u.x*_+p.x*p.x*l,y.ez.y=u.x*_+p.x*l,y.ex.z=y.ez.x,y.ey.z=y.ez.y,y.ez.z=_+l,this.m_frequencyHz>0){var d=N.zero();d.addCombine(1,n,1,p),d.subCombine(1,o,1,u),e=d.length(),i=0;var f=N.neg(y.solve22(d));o.subMul(h,f),s-=_*N.crossVec2Vec2(u,f),n.addMul(c,f),r+=l*N.crossVec2Vec2(p,f)}else{var d=N.zero();d.addCombine(1,n,1,p),d.subCombine(1,o,1,u);var v=r-s-this.m_referenceAngle;e=d.length(),i=oT(v);var x=new iG(d.x,d.y,v),A=new iG;if(y.ez.z>0)A=iG.neg(y.solve33(x));else{var g=N.neg(y.solve22(d));A.set(g.x,g.y,0)}var f=N.neo(A.x,A.y);o.subMul(h,f),s-=_*(N.crossVec2Vec2(u,f)+A.z),n.addMul(c,f),r+=l*(N.crossVec2Vec2(p,f)+A.z)}return this.m_bodyA.c_position.c=o,this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c=n,this.m_bodyB.c_position.a=r,e<=Y.linearSlop&&i<=Y.angularSlop},e.TYPE="weld-joint",e}(ee),oj=Math.abs,oD=Math.PI,oR={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7},oO=function(t){function e(i,o,s,n,r){var m=this;return m instanceof e?(i=C(i,oR),o=(m=t.call(this,i,o,s)||this).m_bodyA,s=m.m_bodyB,m.m_ax=N.zero(),m.m_ay=N.zero(),m.m_type=e.TYPE,m.m_localAnchorA=N.clone(n?o.getLocalPoint(n):i.localAnchorA||N.zero()),m.m_localAnchorB=N.clone(n?s.getLocalPoint(n):i.localAnchorB||N.zero()),N.isValid(r)?m.m_localXAxisA=o.getLocalVector(r):N.isValid(i.localAxisA)?m.m_localXAxisA=N.clone(i.localAxisA):N.isValid(i.localAxis)?m.m_localXAxisA=N.clone(i.localAxis):m.m_localXAxisA=N.neo(1,0),m.m_localYAxisA=N.crossNumVec2(1,m.m_localXAxisA),m.m_mass=0,m.m_impulse=0,m.m_motorMass=0,m.m_motorImpulse=0,m.m_springMass=0,m.m_springImpulse=0,m.m_maxMotorTorque=i.maxMotorTorque,m.m_motorSpeed=i.motorSpeed,m.m_enableMotor=i.enableMotor,m.m_frequencyHz=i.frequencyHz,m.m_dampingRatio=i.dampingRatio,m.m_bias=0,m.m_gamma=0,m):new e(i,o,s,n,r)}return V(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,enableMotor:this.m_enableMotor,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA}},e._deserialize=function(t,i,o){return(t=M({},t)).bodyA=o(t7,t.bodyA,i),t.bodyB=o(t7,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),t.localAxisA&&(this.m_localXAxisA.setVec2(t.localAxisA),this.m_localYAxisA.setVec2(N.crossNumVec2(1,t.localAxisA))),void 0!==t.enableMotor&&(this.m_enableMotor=t.enableMotor),Number.isFinite(t.maxMotorTorque)&&(this.m_maxMotorTorque=t.maxMotorTorque),Number.isFinite(t.motorSpeed)&&(this.m_motorSpeed=t.motorSpeed),Number.isFinite(t.frequencyHz)&&(this.m_frequencyHz=t.frequencyHz),Number.isFinite(t.dampingRatio)&&(this.m_dampingRatio=t.dampingRatio)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getLocalAxisA=function(){return this.m_localXAxisA},e.prototype.getJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.getWorldPoint(this.m_localAnchorA),o=e.getWorldPoint(this.m_localAnchorB),s=N.sub(o,i),n=t.getWorldVector(this.m_localXAxisA);return N.dot(s,n)},e.prototype.getJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t},e.prototype.isMotorEnabled=function(){return this.m_enableMotor},e.prototype.enableMotor=function(t){t!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t)},e.prototype.setMotorSpeed=function(t){t!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t)},e.prototype.getMotorSpeed=function(){return this.m_motorSpeed},e.prototype.setMaxMotorTorque=function(t){t!=this.m_maxMotorTorque&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t)},e.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},e.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},e.prototype.setSpringFrequencyHz=function(t){this.m_frequencyHz=t},e.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz},e.prototype.setSpringDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return N.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_motorImpulse},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,i=this.m_invMassB,o=this.m_invIA,s=this.m_invIB,n=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,m=this.m_bodyA.c_velocity.v,a=this.m_bodyA.c_velocity.w,h=this.m_bodyB.c_position.c,c=this.m_bodyB.c_position.a,_=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,u=tk.neo(r),p=tk.neo(c),y=tk.mulVec2(u,N.sub(this.m_localAnchorA,this.m_localCenterA)),d=tk.mulVec2(p,N.sub(this.m_localAnchorB,this.m_localCenterB)),f=N.zero();if(f.addCombine(1,h,1,d),f.subCombine(1,n,1,y),this.m_ay=tk.mulVec2(u,this.m_localYAxisA),this.m_sAy=N.crossVec2Vec2(N.add(f,y),this.m_ay),this.m_sBy=N.crossVec2Vec2(d,this.m_ay),this.m_mass=e+i+o*this.m_sAy*this.m_sAy+s*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax=tk.mulVec2(u,this.m_localXAxisA),this.m_sAx=N.crossVec2Vec2(N.add(f,y),this.m_ax),this.m_sBx=N.crossVec2Vec2(d,this.m_ax);var v=e+i+o*this.m_sAx*this.m_sAx+s*this.m_sBx*this.m_sBx;if(v>0){this.m_springMass=1/v;var x=N.dot(f,this.m_ax),A=2*oD*this.m_frequencyHz,g=2*this.m_springMass*this.m_dampingRatio*A,b=this.m_springMass*A*A,B=t.dt;this.m_gamma=B*(g+B*b),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=x*B*b*this.m_gamma,this.m_springMass=v+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=o+s,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.warmStarting){this.m_impulse*=t.dtRatio,this.m_springImpulse*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;var w=N.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),V=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,M=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;m.subMul(this.m_invMassA,w),a-=this.m_invIA*V,_.addMul(this.m_invMassB,w),l+=this.m_invIB*M}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(m),this.m_bodyA.c_velocity.w=a,this.m_bodyB.c_velocity.v.setVec2(_),this.m_bodyB.c_velocity.w=l},e.prototype.solveVelocityConstraints=function(t){var e=this.m_invMassA,i=this.m_invMassB,o=this.m_invIA,s=this.m_invIB,n=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=N.dot(this.m_ax,m)-N.dot(this.m_ax,n)+this.m_sBx*a-this.m_sAx*r,c=-this.m_springMass*(h+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=c;var _=N.mulNumVec2(c,this.m_ax),l=c*this.m_sAx,u=c*this.m_sBx;n.subMul(e,_),r-=o*l,m.addMul(i,_);var h=(a+=s*u)-r-this.m_motorSpeed,c=-this.m_motorMass*h,p=this.m_motorImpulse,y=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=S(this.m_motorImpulse+c,-y,y),r-=o*(c=this.m_motorImpulse-p),a+=s*c;var h=N.dot(this.m_ay,m)-N.dot(this.m_ay,n)+this.m_sBy*a-this.m_sAy*r,c=-this.m_mass*h;this.m_impulse+=c;var _=N.mulNumVec2(c,this.m_ay),l=c*this.m_sAy,u=c*this.m_sBy;n.subMul(e,_),r-=o*l,m.addMul(i,_),a+=s*u,this.m_bodyA.c_velocity.v.setVec2(n),this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v.setVec2(m),this.m_bodyB.c_velocity.w=a},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=tk.neo(i),r=tk.neo(s),m=tk.mulVec2(n,N.sub(this.m_localAnchorA,this.m_localCenterA)),a=tk.mulVec2(r,N.sub(this.m_localAnchorB,this.m_localCenterB)),h=N.zero();h.addCombine(1,o,1,a),h.subCombine(1,e,1,m);var c=tk.mulVec2(n,this.m_localYAxisA),_=N.crossVec2Vec2(N.add(h,m),c),l=N.crossVec2Vec2(a,c),u=N.dot(h,c),p=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,y=0!=p?-u/p:0,d=N.mulNumVec2(y,c),f=y*_,v=y*l;return e.subMul(this.m_invMassA,d),i-=this.m_invIA*f,o.addMul(this.m_invMassB,d),s+=this.m_invIB*v,this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(o),this.m_bodyB.c_position.a=s,oj(u)<=Y.linearSlop},e.TYPE="wheel-joint",e}(ee),oE=0,oY={World:iX,Body:t7,Joint:ee,Fixture:t$,Shape:tU},oJ={Vec2:N,Vec3:iG,World:iX,Body:t7,Joint:ee,Fixture:t$,Shape:tU},oH=((g={})[t7.STATIC]=t7,g[t7.DYNAMIC]=t7,g[t7.KINEMATIC]=t7,g[i3.TYPE]=i3,g[oi.TYPE]=oi,g[i0.TYPE]=i0,g[or.TYPE]=or,g[oc.TYPE]=oc,g[ol.TYPE]=ol,g[ob.TYPE]=ob,g[ow.TYPE]=ow,g[oC.TYPE]=oC,g[oA.TYPE]=oA,g[oP.TYPE]=oP,g[oy.TYPE]=oy,g[oF.TYPE]=oF,g[oN.TYPE]=oN,g[oO.TYPE]=oO,g),oW={rootClass:iX,preSerialize:function(t){return t},postSerialize:function(t,e){return t},preDeserialize:function(t){return t},postDeserialize:function(t,e){return t}},oU=function(t){var e=this;this.toJson=function(t){for(var i=e.options.preSerialize,o=e.options.postSerialize,s=[],n=[t],r={};n.length;){var m=function t(e,m){if(void 0===m&&(m=!1),"object"!=typeof e||null===e)return e;if("function"==typeof e._serialize){var a;if(!m){for(var h in oY)if(e instanceof oY[h])return function(t,e){if(t.__sid=t.__sid||++oE,!r[t.__sid]){n.push(t);var i=s.length+n.length;r[t.__sid]={refIndex:i,refType:e}}return r[t.__sid]}(e,h)}e=o((a=i(a=e))._serialize(),a)}if(Array.isArray(e)){for(var c=[],_=0;_<e.length;_++)c[_]=t(e[_]);e=c}else{var c={};for(var _ in e)e.hasOwnProperty(_)&&(c[_]=t(e[_]));e=c}return e}(n.shift(),!0);s.push(m)}return s},this.fromJson=function(t){var i=e.options.preDeserialize,o=e.options.postDeserialize,s=e.options.rootClass,n={};function r(t,e,s){if(t&&t._deserialize||(t=oH[e.type]),t&&t._deserialize){e=i(e);var n=(0,t._deserialize)(e,s,m);return o(n,e)}}function m(e,i,o){if(!(i.refIndex&&i.refType))return r(e,i,o);oJ[i.refType]&&(e=oJ[i.refType]);var s=i.refIndex;if(!n[s]){var m=r(e,t[s],o);n[s]=m}return n[s]}return r(s,t[0],null)},this.options=M(M({},oW),t)},oZ=new oU({rootClass:iX});oU.fromJson=oZ.fromJson,oU.toJson=oZ.toJson,function(){function t(){}t.mount=function(t){throw Error("Not implemented")},t.start=function(e){var i=t.mount();return i.start(e),i}}();var oK=function(t){function e(i,o,s,n){var r=this;return r instanceof e?((r=t.call(this)||this)._setAsBox(i,o,s,n),r):new e(i,o,s,n)}return V(e,t),e.TYPE="polygon",e}(oi);iZ.addType(or.TYPE,or.TYPE,function(t,e,i,o,s,n,r){oQ(t,i.getShape(),e,n.getShape(),s)});var oX=to(0,0),oG=to(0,0),oQ=function(t,e,i,o,s){t.pointCount=0,tz(oX,i,e.m_p),tz(oG,s,o.m_p);var n=tw(oG,oX),r=e.m_radius+o.m_radius;n>r*r||(t.type=y.e_circles,tn(t.localPoint,e.m_p),tr(t.localNormal),t.pointCount=1,tn(t.points[0].localPoint,o.m_p),t.points[0].id.setFeatures(0,d.e_vertex,0,d.e_vertex))};iZ.addType(i0.TYPE,or.TYPE,function(t,e,i,o,s,n,r){o9(t,i.getShape(),e,n.getShape(),s)}),iZ.addType(i3.TYPE,or.TYPE,function(t,e,i,o,s,n,r){var m=i.getShape(),a=new i0;m.getChildEdge(a,o),o9(t,a,e,n.getShape(),s)});var o$=to(0,0),o0=to(0,0),o1=to(0,0),o2=to(0,0),o3=to(0,0),o5=to(0,0),o9=function(t,e,i,o,s){t.pointCount=0,tS(o2,s,i,o.m_p);var n=e.m_vertex1,r=e.m_vertex2;tc(o$,r,n);var m=tg(o$,r)-tg(o$,o2),a=tg(o$,o2)-tg(o$,n),h=e.m_radius+o.m_radius;if(a<=0){if(tn(o3,n),tw(o2,n)>h*h)return;if(e.m_hasVertex0&&(tc(o0,n,e.m_vertex0),tg(o0,n)-tg(o0,o2)>0))return;t.type=y.e_circles,tr(t.localNormal),tn(t.localPoint,o3),t.pointCount=1,tn(t.points[0].localPoint,o.m_p),t.points[0].id.setFeatures(0,d.e_vertex,0,d.e_vertex);return}if(m<=0){if(tn(o3,r),tw(o2,o3)>h*h)return;if(e.m_hasVertex3&&(tc(o1,e.m_vertex3,r),tg(o1,o2)-tg(o1,r)>0))return;t.type=y.e_circles,tr(t.localNormal),tn(t.localPoint,o3),t.pointCount=1,tn(t.points[0].localPoint,o.m_p),t.points[0].id.setFeatures(1,d.e_vertex,0,d.e_vertex);return}var c=tb(o$);ty(o3,m/c,n,a/c,r),tw(o2,o3)>h*h||(tx(o5,1,o$),tg(o5,o2)-tg(o5,n)<0&&tm(o5),tf(o5),t.type=y.e_faceA,tn(t.localNormal,o5),tn(t.localPoint,n),t.pointCount=1,tn(t.points[0].localPoint,o.m_p),t.points[0].id.setFeatures(0,d.e_face,0,d.e_vertex))},o4=[new is,new is],o8=[new is,new is],o6=[new is,new is],o7=to(0,0),st=to(0,0),se=to(0,0),si=tC(0,0,0),so=to(0,0),ss=to(0,0),sn=to(0,0),sr=to(0,0),sm=to(0,0),sa=to(0,0),sh=to(0,0),sc=to(0,0);function s_(t,e,i,o,s){var n=t.m_count,r=i.m_count,m=t.m_normals,a=t.m_vertices,h=i.m_vertices;tL(si,o,e);for(var c=0,_=-1/0,l=0;l<n;++l){tV(se,si.q,m[l]),tz(st,si,a[l]);for(var u=1/0,p=0;p<r;++p){var y=tg(se,h[p])-tg(se,st);y<u&&(u=y)}u>_&&(_=u,c=l)}s.maxSeparation=_,s.bestIndex=c}iZ.addType(oi.TYPE,oi.TYPE,function(t,e,i,o,s,n,r){su(t,i.getShape(),e,n.getShape(),s)});var sl={maxSeparation:0,bestIndex:0},su=function(t,e,i,o,s){t.pointCount=0;var n,r,m,a,h,c,_=e.m_radius+o.m_radius;s_(e,i,o,s,sl);var l=sl.bestIndex,u=sl.maxSeparation;if(u>_)return;s_(o,s,e,i,sl);var p=sl.bestIndex,f=sl.maxSeparation;if(!(f>_)){f>u+.1*Y.linearSlop?(n=o,r=e,m=s,a=i,h=p,t.type=y.e_faceB,c=!0):(n=e,r=o,m=i,a=s,h=l,t.type=y.e_faceA,c=!1),o4[0].recycle(),o4[1].recycle(),function(t,e,i,o,s,n){var r,m,a,h,c,_,l,u=e.m_normals,p=s.m_count,y=s.m_vertices,f=s.m_normals;r=n.q,m=i.q,a=u[o],h=r.c*a.x+r.s*a.y,c=-r.s*a.x+r.c*a.y,_=m.c*h-m.s*c,l=m.s*h+m.c*c,sc.x=_,sc.y=l;for(var v=0,x=1/0,A=0;A<p;++A){var g=tg(sc,f[A]);g<x&&(x=g,v=A)}var b=v,B=b+1<p?b+1:0;tz(t[0].v,n,y[b]),t[0].id.setFeatures(o,d.e_face,b,d.e_vertex),tz(t[1].v,n,y[B]),t[1].id.setFeatures(o,d.e_face,B,d.e_vertex)}(o4,n,m,h,r,a);var v=n.m_count,x=n.m_vertices,A=h,g=h+1<v?h+1:0;tn(so,x[A]),tn(ss,x[g]),tc(sn,ss,so),tf(sn),tv(sr,sn,1),ty(sm,.5,so,.5,ss),tV(sa,m.q,sn),tv(sh,sa,1),tz(so,m,so),tz(ss,m,ss);var b=tg(sh,so),B=-tg(sa,so)+_,w=tg(sa,ss)+_;if((o8[0].recycle(),o8[1].recycle(),o6[0].recycle(),o6[1].recycle(),ts(o7,-sa.x,-sa.y),!(2>i_(o8,o4,o7,B,A)))&&(ts(o7,sa.x,sa.y),!(2>i_(o6,o8,o7,w,g)))){tn(t.localNormal,sr),tn(t.localPoint,sm);for(var V=0,M=0;M<o6.length;++M)if(tg(sh,o6[M].v)-b<=_){var C=t.points[V];tP(C.localPoint,a,o6[M].v),C.id.set(o6[M].id),c&&C.id.swapFeatures(),++V}t.pointCount=V}}};iZ.addType(oi.TYPE,or.TYPE,function(t,e,i,o,s,n,r){sd(t,i.getShape(),e,n.getShape(),s)});var sp=to(0,0),sy=to(0,0),sd=function(t,e,i,o,s){t.pointCount=0,tS(sp,s,i,o.m_p);for(var n=0,r=-1/0,m=e.m_radius+o.m_radius,a=e.m_count,h=e.m_vertices,c=e.m_normals,_=0;_<a;++_){var l=tg(c[_],sp)-tg(c[_],h[_]);if(l>m)return;l>r&&(r=l,n=_)}var u=n,p=h[u],f=h[u+1<a?u+1:0];if(r<1e-9){t.pointCount=1,t.type=y.e_faceA,tn(t.localNormal,c[n]),ty(t.localPoint,.5,p,.5,f),tn(t.points[0].localPoint,o.m_p),t.points[0].id.setFeatures(0,d.e_vertex,0,d.e_vertex);return}var v=tg(sp,f)-tg(sp,p)-tg(p,f)+tg(p,p),x=tg(sp,p)-tg(sp,f)-tg(f,p)+tg(f,f);if(v<=0){if(tw(sp,p)>m*m)return;t.pointCount=1,t.type=y.e_faceA,tc(t.localNormal,sp,p),tf(t.localNormal),tn(t.localPoint,p),tn(t.points[0].localPoint,o.m_p),t.points[0].id.setFeatures(0,d.e_vertex,0,d.e_vertex)}else if(x<=0){if(tw(sp,f)>m*m)return;t.pointCount=1,t.type=y.e_faceA,tc(t.localNormal,sp,f),tf(t.localNormal),tn(t.localPoint,f),tn(t.points[0].localPoint,o.m_p),t.points[0].id.setFeatures(0,d.e_vertex,0,d.e_vertex)}else{if(ty(sy,.5,p,.5,f),tg(sp,c[u])-tg(sy,c[u])>m)return;t.pointCount=1,t.type=y.e_faceA,tn(t.localNormal,c[u]),tn(t.localPoint,sy),tn(t.points[0].localPoint,o.m_p),t.points[0].id.setFeatures(0,d.e_vertex,0,d.e_vertex)}},sf=Math.min;iZ.addType(i0.TYPE,oi.TYPE,function(t,e,i,o,s,n,r){sO(t,i.getShape(),e,n.getShape(),s)}),iZ.addType(i3.TYPE,oi.TYPE,function(t,e,i,o,s,n,r){i.getShape().getChildEdge(sv,o),sO(t,sv,e,n.getShape(),s)});var sv=new i0;(_=b||(b={}))[_.e_unknown=-1]="e_unknown",_[_.e_edgeA=1]="e_edgeA",_[_.e_edgeB=2]="e_edgeB",(l=B||(B={}))[l.e_isolated=0]="e_isolated",l[l.e_concave=1]="e_concave",l[l.e_convex=2]="e_convex";var sx=function(){},sA=function(){function t(){this.v1=to(0,0),this.v2=to(0,0),this.normal=to(0,0),this.sideNormal1=to(0,0),this.sideNormal2=to(0,0)}return t.prototype.recycle=function(){tr(this.v1),tr(this.v2),tr(this.normal),tr(this.sideNormal1),tr(this.sideNormal2)},t}(),sg=[new is,new is],sb=[new is,new is],sB=[new is,new is],sw=new sx,sV=new sx,sM=new function(){this.vertices=[],this.normals=[],this.count=0;for(var t=0;t<Y.maxPolygonVertices;t++)this.vertices.push(to(0,0)),this.normals.push(to(0,0))},sC=new sA,sI=to(0,0),sz=to(0,0),sP=to(0,0),sS=to(0,0),sL=tC(0,0,0),sF=to(0,0),sT=to(0,0),sq=to(0,0),sk=to(0,0),sN=to(0,0),sj=to(0,0),sD=to(0,0),sR=to(0,0),sO=function(t,e,i,o,s){tL(sL,i,s),tz(sI,sL,o.m_centroid);var n,r,m=e.m_vertex0,a=e.m_vertex1,h=e.m_vertex2,c=e.m_vertex3,_=e.m_hasVertex0,l=e.m_hasVertex3;tc(sP,h,a),tf(sP),ts(sq,sP.y,-sP.x);var u=tg(sq,sI)-tg(sq,a),p=0,f=0,v=!1,x=!1;tr(sT),tr(sk),_&&(tc(sz,a,m),tf(sz),ts(sT,sz.y,-sz.x),v=tA(sz,sP)>=0,p=N.dot(sT,sI)-N.dot(sT,m)),l&&(tc(sS,c,h),tf(sS),ts(sk,sS.y,-sS.x),x=N.crossVec2Vec2(sP,sS)>0,f=N.dot(sk,sI)-N.dot(sk,h)),tr(sF),tr(sN),tr(sj),_&&l?v&&x?(n=p>=0||u>=0||f>=0)?(tn(sF,sq),tn(sN,sT),tn(sj,sk)):(tl(sF,-1,sq),tl(sN,-1,sq),tl(sj,-1,sq)):v?(n=p>=0||u>=0&&f>=0)?(tn(sF,sq),tn(sN,sT),tn(sj,sq)):(tl(sF,-1,sq),tl(sN,-1,sk),tl(sj,-1,sq)):x?(n=f>=0||p>=0&&u>=0)?(tn(sF,sq),tn(sN,sq),tn(sj,sk)):(tl(sF,-1,sq),tl(sN,-1,sq),tl(sj,-1,sT)):(n=p>=0&&u>=0&&f>=0)?(tn(sF,sq),tn(sN,sq),tn(sj,sq)):(tl(sF,-1,sq),tl(sN,-1,sk),tl(sj,-1,sT)):_?v?((n=p>=0||u>=0)?(tn(sF,sq),tn(sN,sT)):(tl(sF,-1,sq),tn(sN,sq)),tl(sj,-1,sq)):(n=p>=0&&u>=0)?(tn(sF,sq),tn(sN,sq),tl(sj,-1,sq)):(tl(sF,-1,sq),tn(sN,sq),tl(sj,-1,sT)):l?x?(n=u>=0||f>=0)?(tn(sF,sq),tl(sN,-1,sq),tn(sj,sk)):(tl(sF,-1,sq),tl(sN,-1,sq),tn(sj,sq)):((n=u>=0&&f>=0)?(tn(sF,sq),tl(sN,-1,sq)):(tl(sF,-1,sq),tl(sN,-1,sk)),tn(sj,sq)):(n=u>=0)?(tn(sF,sq),tl(sN,-1,sq),tl(sj,-1,sq)):(tl(sF,-1,sq),tn(sN,sq),tn(sj,sq)),sM.count=o.m_count;for(var A=0;A<o.m_count;++A)tz(sM.vertices[A],sL,o.m_vertices[A]),tV(sM.normals[A],sL.q,o.m_normals[A]);var g=o.m_radius+e.m_radius;t.pointCount=0,sw.type=b.e_edgeA,sw.index=+!n,sw.separation=1/0;for(var A=0;A<sM.count;++A){var B=tg(sF,sM.vertices[A])-tg(sF,a);B<sw.separation&&(sw.separation=B)}if(sw.type==b.e_unknown||sw.separation>g)return;sV.type=b.e_unknown,sV.index=-1,sV.separation=-1/0,ts(sD,-sF.y,sF.x);for(var A=0;A<sM.count;++A){tl(sR,-1,sM.normals[A]);var B=sf(tg(sR,sM.vertices[A])-tg(sR,a),tg(sR,sM.vertices[A])-tg(sR,h));if(B>g){sV.type=b.e_edgeB,sV.index=A,sV.separation=B;break}if(tg(sR,sD)>=0){if(tg(sR,sF)-tg(sj,sF)<-Y.angularSlop)continue}else if(tg(sR,sF)-tg(sN,sF)<-Y.angularSlop)continue;B>sV.separation&&(sV.type=b.e_edgeB,sV.index=A,sV.separation=B)}if(sV.type==b.e_unknown||!(sV.separation>g)){if(r=sV.type==b.e_unknown?sw:sV.separation>.98*sw.separation+.001?sV:sw,sB[0].recycle(),sB[1].recycle(),r.type==b.e_edgeA){t.type=y.e_faceA;for(var w=0,V=tg(sF,sM.normals[0]),A=1;A<sM.count;++A){var M=tg(sF,sM.normals[A]);M<V&&(V=M,w=A)}var C=w,I=C+1<sM.count?C+1:0;tn(sB[0].v,sM.vertices[C]),sB[0].id.setFeatures(0,d.e_face,C,d.e_vertex),tn(sB[1].v,sM.vertices[I]),sB[1].id.setFeatures(0,d.e_face,I,d.e_vertex),n?(sC.i1=0,sC.i2=1,tn(sC.v1,a),tn(sC.v2,h),tn(sC.normal,sq)):(sC.i1=1,sC.i2=0,tn(sC.v1,h),tn(sC.v2,a),tl(sC.normal,-1,sq))}else t.type=y.e_faceB,tn(sB[0].v,a),sB[0].id.setFeatures(0,d.e_vertex,r.index,d.e_face),tn(sB[1].v,h),sB[1].id.setFeatures(0,d.e_vertex,r.index,d.e_face),sC.i1=r.index,sC.i2=sC.i1+1<sM.count?sC.i1+1:0,tn(sC.v1,sM.vertices[sC.i1]),tn(sC.v2,sM.vertices[sC.i2]),tn(sC.normal,sM.normals[sC.i1]);if((ts(sC.sideNormal1,sC.normal.y,-sC.normal.x),ts(sC.sideNormal2,-sC.sideNormal1.x,-sC.sideNormal1.y),sC.sideOffset1=tg(sC.sideNormal1,sC.v1),sC.sideOffset2=tg(sC.sideNormal2,sC.v2),sg[0].recycle(),sg[1].recycle(),sb[0].recycle(),sb[1].recycle(),!(i_(sg,sB,sC.sideNormal1,sC.sideOffset1,sC.i1)<Y.maxManifoldPoints))&&!(i_(sb,sg,sC.sideNormal2,sC.sideOffset2,sC.i2)<Y.maxManifoldPoints)){r.type==b.e_edgeA?(tn(t.localNormal,sC.normal),tn(t.localPoint,sC.v1)):(tn(t.localNormal,o.m_normals[sC.i1]),tn(t.localPoint,o.m_vertices[sC.i1]));for(var z=0,A=0;A<Y.maxManifoldPoints;++A)if(tg(sC.normal,sb[A].v)-tg(sC.normal,sC.v1)<=g){var P=t.points[z];r.type==b.e_edgeA?(tP(P.localPoint,sL,sb[A].v),P.id.set(sb[A].id)):(tn(P.localPoint,sb[A].v),P.id.set(sb[A].id),P.id.swapFeatures()),++z}t.pointCount=z}}};function sE(t,e){this._refMap={},this._map={},this._xmap={},this._data=[],this._entered=[],this._exited=[],this._key=t,this._listener=e}sE.prototype.update=function(t){if(!Array.isArray(t))throw"Invalid data: "+t;this._entered.length=0,this._exited.length=0,this._data.length=t.length;for(var e=0;e<t.length;e++)if("object"==typeof t[e]&&null!==t[e]){var i=t[e],o=this._key(i);this._map[o]?delete this._map[o]:this._entered.push(i),this._data[e]=i,this._xmap[o]=i}for(var o in this._map)this._exited.push(this._map[o]),delete this._map[o];var s=this._map;this._map=this._xmap,this._xmap=s;for(var e=0;e<this._exited.length;e++){var i=this._exited[e],n=this._key(i),r=this._refMap[n];this._listener.exit(i,r),delete this._refMap[n]}for(var e=0;e<this._entered.length;e++){var i=this._entered[e],n=this._key(i),r=this._listener.enter(i);r&&(this._refMap[n]=r)}for(var e=0;e<this._data.length;e++)if("object"==typeof t[e]&&null!==t[e]){var i=this._data[e],n=this._key(i),r=this._refMap[n];this._listener.update(i,r)}this._entered.length=0,this._exited.length=0,this._data.length=0},sE.prototype.ref=function(t){return this._refMap[this._key(t)]}}}]);