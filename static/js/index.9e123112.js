(()=>{"use strict";var t,e,i,s,o={785(t,e,i){var s,o=i(454),l=i(683);let a=`#version 300 es
out vec2 v_texCoord;
void main() {
    // Single triangle covering the viewport
    v_texCoord = vec2((gl_VertexID << 1) & 2, gl_VertexID & 2);
    gl_Position = vec4(v_texCoord * 2.0 - 1.0, 0.0, 1.0);
}
`,n=`#version 300 es
precision highp float;
in vec2 v_texCoord;
out vec4 outColor;
uniform sampler2D u_texture;
void main() {
    outColor = texture(u_texture, v_texCoord);
}
`;class r{connect(t){this.listeners.push(t)}emit(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];for(let t of this.listeners)t(...e)}disconnect(t){this.listeners=this.listeners.filter(e=>e!==t)}clear(){this.listeners=[]}constructor(){(0,o._)(this,"listeners",[])}}var h=((s={}).BallLost="ballLost.wav",s.Bounce="bounce.wav",s.BounceLight="bounceLight.wav",s.BouncePaddle="bouncePaddle.wav",s.BreakBlock="breakBlock.wav",s.Explosion="explosion.wav",s.GameOver="gameOver.wav",s.LaserShoot="laserShoot.wav",s.Launch="launch.wav",s.PickupEnergy="pickupEnergy.wav",s.PowerUp="powerUp.wav",s.SlowMotion="slowMotion.wav",s.SlowMotionResume="slowMotionResume.wav",s.Teleport="teleport.wav",s.UsePowerUp="usePowerUp.wav",s);class d{static async init(){if(null!==this.audioContext)return;this.audioContext=new AudioContext;let t=[];for(let e in h){let i=h[e],s=fetch(`sounds/${i}`).then(t=>t.arrayBuffer()).then(t=>this.audioContext.decodeAudioData(t)).then(t=>{this.soundBuffers.set(i,t)});t.push(s)}await Promise.all(t)}static play(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.2;if(null===this.audioContext)return;let o=this.soundBuffers.get(t);if(!o)return;let l=this.audioContext.createBufferSource();l.buffer=o,l.playbackRate.value=e+(2*Math.random()-1)*s;let a=this.audioContext.createGain();a.gain.value=i,l.connect(a).connect(this.audioContext.destination),l.start(0),l.onended=()=>{l.disconnect(),a.disconnect()}}}(0,o._)(d,"audioContext",null),(0,o._)(d,"soundBuffers",new Map);class c{get x(){return this._x}set x(t){this._x=t,this.blockBody&&this.blockBody.setPosition({x:this._x+this.width/2,y:this.y+this.height/2})}get y(){return this._y}set y(t){this._y=t,this.blockBody&&this.blockBody.setPosition({x:this.x+this.width/2,y:this._y+this.height/2})}draw(t){let e=this.x,i=this.y,s=this.width,o=this.height,l=t.globalAlpha;if(this.fadeIn){let e=1-Math.pow(1-Math.min(1,(performance.now()-this.creationTime)/500),3);t.globalAlpha*=e,i-=o*(1-e)}t.fillStyle=this.fillColor,t.fillRect(e,i,s,o),t.strokeStyle=this.outlineColor,t.lineWidth=.003,t.strokeRect(e,i,s,o),this.hitsRemaining>1&&(t.lineWidth=.001*this.hitsRemaining,t.strokeRect(e+.01,i+.01,s-.02,o-.02)),t.globalAlpha=l}addToWorld(t){this.blockBody=t.createBody({type:"static",position:{x:this.x+this.width/2,y:this.y+this.height/2}}),this.blockBody.createFixture({shape:new l.az(this.width/2,this.height/2,{x:0,y:0},0),friction:0,density:1,userData:this,filterCategoryBits:2}),this.blockBody.setAwake(!1)}hit(t){return this.hitsRemaining--,this.hitsRemaining<=0?(t.emitRectBurst(this.x,this.y,this.width,this.height,50,.2,.5,this.outlineColor),d.play("breakBlock.wav")):Math.random()<Math.pow(.9,this.hitsRemaining)&&this.spawnPowerUp.emit(),this.hitsRemaining<=0}isDestroyed(){return this.hitsRemaining<=0}destroy(t){this.blockBody&&(t.destroyBody(this.blockBody),this.spawnPowerUp.emit())}constructor(t,e,i,s,l,a,n=!1){(0,o._)(this,"width",void 0),(0,o._)(this,"height",void 0),(0,o._)(this,"fadeIn",void 0),(0,o._)(this,"outlineColor",void 0),(0,o._)(this,"fillColor",void 0),(0,o._)(this,"hitsRemaining",void 0),(0,o._)(this,"blockBody",void 0),(0,o._)(this,"creationTime",void 0),(0,o._)(this,"spawnPowerUp",void 0),(0,o._)(this,"_x",void 0),(0,o._)(this,"_y",void 0),this.width=i,this.height=s,this.fadeIn=n,this.creationTime=performance.now(),this.spawnPowerUp=new r,this._x=t,this._y=e,this.hitsRemaining=l,this.outlineColor=`hsl(${a}, 100%, 80%)`,this.fillColor=`hsl(${a}, 80%, 5%)`}}class y{update(t,e,i){let s=t-e;this.integral+=s*i;let o=(s-this.previousError)/i;return this.previousError=s,this.kP*s+this.kI*this.integral+this.kD*o}constructor(t,e,i){(0,o._)(this,"kP",void 0),(0,o._)(this,"kI",void 0),(0,o._)(this,"kD",void 0),(0,o._)(this,"integral",void 0),(0,o._)(this,"previousError",void 0),this.kP=t,this.kI=e,this.kD=i,this.integral=0,this.previousError=0}}class u{widen(){this.width+=.2,this.width>16/9&&(this.width=16/9)}addToWorld(t){this.paddleBody=t.createBody({type:"kinematic",position:{x:this.centerX,y:this.y+this.height/2}}),this.paddleBody.createFixture({shape:new l.az(this.width/2,this.height/2,{x:0,y:0},0),friction:0,density:1,userData:this})}draw(t){let e=this.centerX-this.width/2,i=this.y,s=this.width,o=this.height;t.save(),t.beginPath(),t.rect(e,i,s,o),t.clip(),t.fillStyle="#777777";for(let l=-o;l<s+o;l+=.012)t.beginPath(),t.moveTo(e+l,i),t.lineTo(e+l+.003,i),t.lineTo(e+l+.003-o,i+o),t.lineTo(e+l-o,i+o),t.closePath(),t.fill();t.restore(),t.strokeStyle=this.outlineColor,t.lineWidth=.003,t.strokeRect(e,i,s,o)}update(t,e){let i=1-Math.pow(.95,t);this.width+=(this.baseWidth-this.width)*i;let s=8/9;if(this.centerX-this.width/2<-s&&(this.centerX=-s+this.width/2),this.centerX+this.width/2>s&&(this.centerX=s-this.width/2),0===e.length){this.velocity*=Math.pow(.01,t),this.centerX+=this.velocity*t;return}let o=t=>({x:t.position.x+.15*t.velocity.x,y:t.position.y+.15*t.velocity.y}),a=this.centerX;switch(this.aiMode){case 0:{let t=0;for(let i of e)t+=o(i).x;a=t/e.length;break}case 1:a=o(e[0]).x;break;case 2:{let t=e[0];for(let i of e)i.position.y>t.position.y&&(t=i);a=o(t).x;break}case 3:{let t=e[0],i=1/0;for(let s of e){let e=s.position,o=e.x-this.centerX,l=e.y-(this.y+this.height/2);if(l>0)continue;let a=o*o+l*l;s.velocity.y<0&&(a*=100),a<i&&(i=a,t=s)}a=o(t).x;break}default:console.error("Unknown PaddleAIMode:",this.aiMode)}if(this.velocity=this.pidController.update(a,this.centerX,t),this.velocity>this.maxSpeed&&(this.velocity=this.maxSpeed),this.velocity<-this.maxSpeed&&(this.velocity=-this.maxSpeed),this.centerX+=this.velocity*t,this.paddleBody){if(this.paddleBody.setPosition({x:this.centerX,y:this.y+this.height/2}),1e-4>Math.abs(this.width-this.previousWidth))return;this.previousWidth=this.width,this.paddleBody.destroyFixture(this.paddleBody.getFixtureList()),this.paddleBody.createFixture({shape:new l.az(this.width/2,this.height/2,{x:0,y:0},0),friction:0,density:1,userData:this})}}constructor(t,e,i,s){(0,o._)(this,"centerX",void 0),(0,o._)(this,"y",void 0),(0,o._)(this,"baseWidth",void 0),(0,o._)(this,"height",void 0),(0,o._)(this,"outlineColor",void 0),(0,o._)(this,"maxSpeed",void 0),(0,o._)(this,"velocity",void 0),(0,o._)(this,"pidController",void 0),(0,o._)(this,"aiMode",void 0),(0,o._)(this,"paddleBody",void 0),(0,o._)(this,"width",void 0),(0,o._)(this,"previousWidth",void 0),this.centerX=t,this.y=e,this.baseWidth=i,this.height=s,this.outlineColor="white",this.maxSpeed=.8,this.velocity=0,this.pidController=new y(6,.05,.05),this.aiMode=3,this.paddleBody=null,this.previousWidth=0,this.width=i}}class m{get position(){return this.sensorBody?this.sensorBody.getPosition():{x:0,y:0}}get radius(){return .025}collect(t){this.collected.emit(t),this.isDestroyed=!0,d.play("powerUp.wav")}addToWorld(t){this.sensorBody=t.createBody({type:"dynamic",position:this.initialPosition,linearVelocity:this.initialVelocity}),null!==this.sensorBody&&this.sensorBody.createFixture({shape:new l.jl(.037500000000000006),userData:this,filterMaskBits:1})}destroy(t){this.sensorBody&&(t.destroyBody(this.sensorBody),this.sensorBody=null)}update(t){this.sensorBody&&(this.sensorBody.applyForceToCenter({x:0,y:3},!0),this.sensorBody.getPosition().y-.025>.6&&(this.fadeOut+=t/.3,this.fadeOut>=1&&(this.isDestroyed=!0)))}draw(t){if(!this.sensorBody)return;let e=this.sensorBody.getPosition(),i=t.globalAlpha;if(this.fadeOut>0){let e;t.globalAlpha=i*(1-((e=Math.min(this.fadeOut,1))<.5?2*e*e:-1+(4-2*e)*e))}this.dashed&&t.setLineDash([.01,.01]),t.strokeStyle=this.color,t.lineWidth=.002,t.beginPath(),t.arc(e.x,e.y,.025,0,2*Math.PI),t.stroke(),this.dashed&&t.setLineDash([]),this.icon.complete&&t.drawImage(this.icon,e.x-.018750000000000003,e.y-.018750000000000003,.037500000000000006,.037500000000000006),t.globalAlpha=i}constructor(t,e,i,s,l){(0,o._)(this,"initialPosition",void 0),(0,o._)(this,"initialVelocity",void 0),(0,o._)(this,"icon",void 0),(0,o._)(this,"dashed",void 0),(0,o._)(this,"color",void 0),(0,o._)(this,"sensorBody",void 0),(0,o._)(this,"fadeOut",void 0),(0,o._)(this,"isDestroyed",void 0),(0,o._)(this,"collected",void 0),this.initialPosition=t,this.initialVelocity=e,this.icon=i,this.dashed=s,this.color=l,this.sensorBody=null,this.fadeOut=0,this.isDestroyed=!1,this.collected=new r}}class g{isGhost(){return this.ghostModeTimer>0}cloneWithAngleOffset(t){let e=Math.sqrt(this.initialVelocity.x*this.initialVelocity.x+this.initialVelocity.y*this.initialVelocity.y),i=Math.atan2(this.initialVelocity.y,this.initialVelocity.x)+t;return new g(this.position,{x:Math.cos(i)*e,y:Math.sin(i)*e},this.radius)}get position(){return this.ballBody?this.ballBody.getPosition():{x:0,y:0}}get velocity(){return this.ballBody?this.ballBody.getLinearVelocity():new l.ZY(0,0)}draw(t){if(!this.ballBody)return;let e=this.ballBody.getPosition();t.strokeStyle="white",t.lineWidth=.003,this.ghostModeTimer>0&&(t.strokeStyle=`rgba(255, 255, 255, ${.5*Math.sin(15*this.ghostModeTimer)+.5})`),t.beginPath(),t.arc(e.x,e.y,this.radius,0,2*Math.PI),t.stroke()}update(t){if(!this.ballBody)return;this.ghostModeTimer>0&&(this.ghostModeTimer-=t,this.ghostModeTimer<0&&(this.ghostModeTimer=0));let e=this.ballBody.getLinearVelocity().length();if(e>g.MAX_BALL_VELOCITY){let t=this.ballBody.getLinearVelocity();t.normalize(),t.mul(g.MAX_BALL_VELOCITY),this.ballBody.setLinearVelocity(t)}e<.2*g.MIN_BALL_VELOCITY?(this.stuckTimer+=t,this.stuckTimer>1&&(this.ghostModeTimer=.25)):this.stuckTimer=0;let i=this.ballBody.getLinearVelocity();if(.2>Math.abs(i.y)){let e=.5*t,s=i.y+(i.y>=0?e:-e);this.ballBody.setLinearVelocity({x:i.x,y:s})}let s=this.ballBody.getPosition();(Math.abs(s.x)>2||Math.abs(s.y)>2)&&(this.destroyed=!0)}addToWorld(t){this.ballBody=t.createBody({type:"dynamic",position:this.initialPosition,linearVelocity:this.initialVelocity,bullet:!0,fixedRotation:!0}),this.ballBody.createFixture({shape:new l.jl(this.radius),density:1,restitution:1,friction:0,userData:this}),this.ballBody.setLinearDamping(0),this.ballBody.setAngularDamping(0)}isDestroyed(){return this.destroyed}handleCollision(t,e,i){if(!this.ballBody)return;let s=e.getUserData();if("death"===s){this.destroyed=!0,i.emitCircleBurst(this.ballBody.getPosition().x,this.ballBody.getPosition().y,this.radius,40,.3,.5,"white");return}if(s instanceof c&&(s.hit(i),i.emitDirectionalBurst(this.ballBody.getPosition().x,this.ballBody.getPosition().y,-this.velocity.x,-this.velocity.y,Math.PI/3,30,.25,.5,s.outlineColor),d.play("bounce.wav")),s instanceof m){s.collect(this),i.emitCircleBurst(s.position.x,s.position.y,s.radius,30,.2,.5,s.color);return}if(this.isGhost()&&s instanceof c)return;let o=1-(this.velocity.length()-g.MIN_BALL_VELOCITY)/(g.MAX_BALL_VELOCITY-g.MIN_BALL_VELOCITY)*.3;if(o=Math.max(.5,Math.min(1,o)),this.slingshotted&&s instanceof c&&(o*=.45),s instanceof u){let t=s.centerX,e=s.width,a=Math.PI/3*((this.ballBody.getPosition().x-t)/(e/2)),n=Math.max(g.MIN_BALL_VELOCITY,this.velocity.length()*o),r=new l.ZY(n*Math.sin(a)*.5+this.velocity.x,-n*Math.cos(a));this.ballBody.setLinearVelocity(r),i.emitDirectionalBurst(this.ballBody.getPosition().x,this.ballBody.getPosition().y,this.velocity.x,-1,Math.PI/3,20,.2,.3,"white"),d.play("bouncePaddle.wav");return}let a=this.ballBody.getLinearVelocity(),n=t.getWorldManifold(null).normal,r=a.x*n.x+a.y*n.y,h=new l.ZY(a.x-2*r*n.x,a.y-2*r*n.y);h.normalize(),h.mul(Math.max(g.MIN_BALL_VELOCITY,a.length()*o)),this.ballBody.setLinearVelocity(h),d.play("bounceLight.wav")}applyForce(t,e){this.ballBody&&this.ballBody.applyForceToCenter(new l.ZY(t,e))}applyExplosionImpulse(t,e,i){if(!this.ballBody)return;let s=this.ballBody.getPosition(),o=new l.ZY(s.x-t,s.y-e);o.normalize(),o.mul(i),this.ballBody.applyLinearImpulse(o,this.ballBody.getWorldCenter()),this.slingshotted=!0}slingshot(t,e){this.ballBody&&(this.ballBody.applyLinearImpulse(new l.ZY(t,e),this.ballBody.getWorldCenter()),this.slingshotted=!0)}teleportTo(t,e){this.ballBody&&this.ballBody.setPosition(new l.ZY(t,e))}setGhostMode(t){this.ghostModeTimer=t}destroy(t){this.ballBody&&(t.destroyBody(this.ballBody),this.ballBody=null,d.play("ballLost.wav")),this.destroyed=!0}constructor(t,e,i){(0,o._)(this,"initialPosition",void 0),(0,o._)(this,"initialVelocity",void 0),(0,o._)(this,"radius",void 0),(0,o._)(this,"stuckTimer",void 0),(0,o._)(this,"ballBody",void 0),(0,o._)(this,"destroyed",void 0),(0,o._)(this,"slingshotted",void 0),(0,o._)(this,"ghostModeTimer",void 0),this.initialPosition=t,this.initialVelocity=e,this.radius=i,this.stuckTimer=0,this.destroyed=!1,this.slingshotted=!1,this.ghostModeTimer=0,this.radius=i,this.ballBody=null;const s=new l.ZY(e.x,e.y);s.normalize(),s.mul(g.MIN_BALL_VELOCITY),this.initialVelocity={x:s.x,y:s.y}}}(0,o._)(g,"MIN_BALL_VELOCITY",.7),(0,o._)(g,"MAX_BALL_VELOCITY",3);class p{getScreenScale(t){return Math.min(t.width/this.minimumScreenDimensions[0],t.height/this.minimumScreenDimensions[1])}applyTransform(t){let e=t.canvas,i=this.getScreenScale(e);t.translate(-this.x*i+e.width/2,-this.y*i+e.height/2),t.scale(i*this.zoom,i*this.zoom)}projectToWorld(t,e,i){let s=this.getScreenScale(i);return{x:(t-i.width/2)/(s*this.zoom)+this.x/this.zoom,y:(e-i.height/2)/(s*this.zoom)+this.y/this.zoom}}trackBalls(t,e,i,s){if(0===t.length||i||s){let t=1-Math.pow(s&&!i?.01:.6,e);this.x+=(0-this.x)*t,this.y+=(0-this.y)*t,this.zoom+=(.8-this.zoom)*t;return}let o=1/0,l=0,a=-1/0,n=1/0,r=0,h=-1/0;for(let e of t){let t=e.position;l+=t.x,r+=t.y,t.x<o&&(o=t.x),t.x>a&&(a=t.x),t.y<n&&(n=t.y),t.y>h&&(h=t.y)}let d=l/t.length,c=r/t.length,y=Math.min(1.2/(a-o),1.2/(h-n),1),u=1-Math.pow(.01,e);this.x+=(d-this.x)*u,this.y+=(c-this.y)*u,this.zoom+=(y-this.zoom)*u}constructor(t,e,i){(0,o._)(this,"x",void 0),(0,o._)(this,"y",void 0),(0,o._)(this,"zoom",void 0),(0,o._)(this,"minimumScreenDimensions",void 0),this.x=t,this.y=e,this.zoom=i,this.minimumScreenDimensions=[1,1]}}let v=16/9,f=16/9*.1;function w(t,e,i,s,o){let l=s/10,a=s/l*2,n=t=>2*Math.abs(2*(t-Math.floor(t+.5)))-1;t.beginPath();for(let o=0;o<=a;o++){let r=o/a,h=e+r*s,d=i+.005*n(s/l*r);0===o?t.moveTo(h,d):t.lineTo(h,d)}for(let r=a;r>=0;r--){let h=r/a,d=e+h*s,c=i+o+.005*n(s/l*h);t.lineTo(d,c)}t.closePath(),t.fill()}class b{gameOver(){return this.lowestBlockY>.5}update(t,e){this.hitDifficulty+=.005*e,this.layerMovementSpeed+=4e-5*e;let i=this.layerMovementSpeed;this.lowestBlockY<-.4&&(i*=10),this.blockOffsetY+=i*e;let s=-1/0;for(let o=this.blocks.length-1;o>=0;o--){let l=this.blocks[o];l.isDestroyed()&&(l.destroy(t),this.blocks.splice(o,1)),l.y+=i*e;let a=l.y+l.height;a>s&&(s=a)}if(this.lowestBlockY=s,this.blockOffsetY>=.06){this.blockOffsetY-=.06,this.addedBlockLayers++;let e=this.addedBlockLayers;for(let i=0;i<10;i++){let s=-60*this.addedBlockLayers,o=Math.ceil(this.hitDifficulty+Math.random());setTimeout(()=>{let l=new c(i*f+.01-v/2,-.55+this.blockOffsetY+(this.addedBlockLayers-e)*.06,f-.02,.039999999999999994,o,s,!0);this.blocks.push(l),l.addToWorld(t),this.attachPowerUpSpawner(l)},1e3*Math.random())}}}attachPowerUpSpawner(t){t.spawnPowerUp.connect(()=>{let e={x:t.x+t.width/2,y:t.y+t.height/2-.02};this.spawnPowerUp.emit(e,{x:(Math.random()-.5)*.2,y:-.2})})}initBlocksInWorld(t){for(let t=-1;t<5;t++)for(let e=0;e<10;e++){let i=60*t,s=new c(e*f+.01-v/2,.06*t+.01-.5,f-.02,.039999999999999994,1,i);this.blocks.push(s)}for(let e of this.blocks)e.addToWorld(t),this.attachPowerUpSpawner(e)}getInitialBalls(){return[new g({x:0,y:.2},{x:.5*Math.random()-.25,y:-.5},.012)]}getBorders(){return new l.sW([new l.ZY(-v/2,.5),new l.ZY(-v/2,-.5),new l.ZY(v/2,-.5),new l.ZY(v/2,.5)],!1)}addDeathBody(t){let e=t.createBody({type:"static",position:{x:0,y:.55}});return e.createFixture({shape:new l.sW([new l.ZY(-2,0),new l.ZY(2,0)],!1),userData:"death",isSensor:!0}),e}drawWorld(t){for(let e of this.blocks)e.draw(t)}draw(t,e){t.strokeStyle="#111111",t.save(),t.beginPath(),t.moveTo(-v/2,-.5),t.lineTo(v/2,-.5),t.lineTo(v/2,.5),t.lineTo(-v/2,.5),t.closePath(),t.clip();for(let e=-v/2*1.1;e<=v/2*1.1;e+=.02){t.beginPath();for(let i=-.5;i<=.5;i+=.1){let s=.02*Math.sin(10*(i+.5)+5*e);t.lineTo(e+s,i)}t.stroke()}t.restore();let i=+(this.lowestBlockY>.25);this.warningSlew+=(i-this.warningSlew)*(1-Math.pow(.05,e)),this.warningSlew>.01&&(t.globalAlpha=this.warningSlew*(.25*Math.sin(Date.now()/400)+.5)*.1,t.fillStyle="rgba(255, 165, 50)",w(t,-v/2,.25,v,.25),t.fillStyle="rgba(255, 50, 50)",w(t,-v/2,.5,v,.03),t.globalAlpha=1)}drawBorder(t){t.strokeStyle="#111111",t.lineWidth=.005,t.beginPath(),t.moveTo(-v/2,.5),t.lineTo(-v/2,-.5),t.lineTo(v/2,-.5),t.lineTo(v/2,.5),t.stroke()}constructor(){(0,o._)(this,"levelDimensions",[1.05*v,1.05]),(0,o._)(this,"blocks",[]),(0,o._)(this,"addedBlockLayers",1),(0,o._)(this,"blockOffsetY",0),(0,o._)(this,"layerMovementSpeed",.003),(0,o._)(this,"hitDifficulty",0),(0,o._)(this,"spawnPowerUp",new r),(0,o._)(this,"lowestBlockY",0),(0,o._)(this,"warningSlew",0)}}let x=document.createElement("canvas").getContext("2d");function _(t){return x.fillStyle=t,[parseInt(x.fillStyle.slice(1,3),16),parseInt(x.fillStyle.slice(3,5),16),parseInt(x.fillStyle.slice(5,7),16)]}class B{emit(t,e,i,s,o,l){this.particles.push({x:t,y:e,vx:i,vy:s,lifetime:o,color:l})}randomizeColor(t,e){let[i,s,o]=t;return i+=(2*Math.random()-1)*e*255,s+=(2*Math.random()-1)*e*255,o+=(2*Math.random()-1)*e*255,`#${Math.round(i).toString(16).padStart(2,"0")}${Math.round(s).toString(16).padStart(2,"0")}${Math.round(o).toString(16).padStart(2,"0")}`}emitRectBurst(t,e,i,s,o,l,a,n){let r=_(n),h=2*(i+s);for(let n=0;n<o;n++){let o,n,d=Math.random()*h;d<i?(o=t+d,n=e):d<i+s?(o=t+i,n=e+(d-i)):d<2*i+s?(o=t+(d-i-s),n=e+s):(o=t,n=e+(d-2*i-s)),this.emit(o,n,(Math.random()-.5)*l,(Math.random()-.5)*l,a*(.5+.5*Math.random()),this.randomizeColor(r,.1))}}emitLineBurst(t,e,i,s,o,l,a,n){let r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=_(n),d=i-t,c=s-e,y=Math.sqrt(d*d+c*c),u=Math.floor(y*o),m=d/y,g=c/y,p=Math.atan2(c,d);for(let i=0;i<u;i++){let i=Math.random(),s=t+m*y*i,o=e+g*y*i,n=(Math.random()-.5)*l,d=p+(Math.random()-.5)*Math.PI*(1-r),c=Math.cos(d)*n,u=Math.sin(d)*n;this.emit(s,o,c,u,a*(.5+.5*Math.random()),this.randomizeColor(h,.1))}}emitCircleBurst(t,e,i,s,o,l,a){let n=_(a);for(let a=0;a<s;a++){let s=Math.random()*Math.PI*2,a=t+Math.cos(s)*i,r=e+Math.sin(s)*i,h=Math.cos(s)*o*(.5+.5*Math.random()),d=Math.sin(s)*o*(.5+.5*Math.random());this.emit(a,r,h,d,l*(.5+.5*Math.random()),this.randomizeColor(n,.1))}}emitDirectionalBurst(t,e,i,s,o,l,a,n,r){let h=_(r),d=Math.sqrt(i*i+s*s),c=i/d,y=s/d;for(let i=0;i<l;i++){let i=(Math.random()-.5)*o,s=Math.cos(i),l=Math.sin(i),r=(c*s-y*l)*a*(.5+.5*Math.random()),d=(c*l+y*s)*a*(.5+.5*Math.random());this.emit(t,e,r,d,n*(.5+.5*Math.random()),this.randomizeColor(h,.1))}}update(t){for(let e=this.particles.length-1;e>=0;e--){let i=this.particles[e];if(i.lifetime-=t,i.lifetime<=0){this.particles.splice(e,1);continue}i.x+=i.vx*t,i.y+=i.vy*t}}draw(t){for(let e of this.particles)t.fillStyle=e.color,t.globalAlpha=Math.max(0,Math.min(1,e.lifetime/.5)),t.fillRect(e.x-.001,e.y-.001,.002,.002);t.globalAlpha=1}constructor(){(0,o._)(this,"particles",[])}}class M{static getBestTime(){if(null===this.bestScore){let t=localStorage.getItem(this.STORAGE_KEY);null!==t&&(this.bestScore=parseFloat(t))}return this.bestScore}static submitTime(t){let e=this.getBestTime();(null===e||t>e)&&(this.bestScore=t,localStorage.setItem(this.STORAGE_KEY,t.toString()))}static formatTime(t){let e=Math.floor(t),i=Math.floor(e/60),s=e-=60*i,o=t-Math.floor(t);return`${i}:${s.toString().padStart(2,"0")}.${o.toFixed(3).slice(2)}`}}(0,o._)(M,"STORAGE_KEY","reverse-breakout-best-score"),(0,o._)(M,"bestScore",null);let S=new Set;class T{createColoredSvgImage(t,e){if("string"==typeof t){let e=document.createElement("div");e.innerHTML=t,t=e.querySelector("svg")}else t=null==t?void 0:t.cloneNode(!0);t&&(t.style.color=e);let i=new Blob([new XMLSerializer().serializeToString(t)],{type:"image/svg+xml;charset=utf-8"}),s=URL.createObjectURL(i),o=new Image;return o.width=32,o.height=32,o.src=s,o}selectAbility(){let t=Math.random(),e=0;for(let[i,s]of this.abilities)if(t<=(e+=s.normalizedProbability))return{id:i,icon:s.icon,color:`hsl(${s.styleHue}, 70%, 60%)`};throw Error("no ability selected. check ability probabilities")}checkAbilityBind(t){if(this.abilityHintTime>0){this.abilityHintTime=.01;return}for(let[e,i]of this.abilities)i.bind.toLowerCase()===t.toLowerCase()&&i.count>0&&i.currentCooldown<=0&&(i.count-=1,this.updateAbilityElement(e),i.element.animate([{transform:"scale(1)"},{transform:"scale(0.9)"},{transform:"scale(1)"}],{duration:200,easing:"ease-out"}),this.activateAbility.emit(e),i.currentCooldown=i.useCooldown)}addAbility(t){let e=this.abilities.get(t);if(e){if(e.count+=1,this.updateAbilityElement(t),e.element.animate([{transform:"scale(1)"},{transform:"scale(1.1)"},{transform:"scale(1)"}],{duration:200,easing:"ease-out"}),!S.has(t)){if(this.abilityHintTime>0)return void this.queuedAbilityHints.push(t);this.showAbilityHint(t)}S.add(t)}}updateAbilityElement(t){let e=this.abilities.get(t);if(!e)return;let i=e.element.querySelector(".count");for(let[t,s]of(i.textContent=`x${e.count}`,e.count>1?i.classList.add("visible"):i.classList.remove("visible"),[[0,"0"],[1,"1"],[2,"2"],[5,"3"],[10,"4"]]))e.count>=t&&(e.element.dataset.count=s);let s=e.currentCooldown/e.useCooldown;e.element.style.setProperty("--ability-cooldown",`${100*s}%`)}showAbilityHint(t){this.abilityHintTime=4,this.abilityHintShown.emit(!0);let e=this.abilities.get(t);if(!e)return;let i=document.getElementById("abilityHint");document.getElementById("new-ability-hint-name").innerHTML=e.name,document.getElementById("new-ability-hint-description").innerHTML=e.description,i.style.setProperty("--ability-hue",e.styleHue),i.classList.add("visible")}addEnergy(t){this.energy+=t,this.energy>1&&(this.energy=1),d.play("pickupEnergy.wav")}update(t,e){if(this.abilityHintTime>0&&(this.abilityHintTime-=e,this.abilityHintTime<=0))if(this.abilityHintTime=0,document.getElementById("abilityHint").classList.remove("visible"),this.queuedAbilityHints.length>0){let t=this.queuedAbilityHints.shift();setTimeout(()=>{this.showAbilityHint(t)},250)}else this.abilityHintShown.emit(!1);for(let[i,s]of(this.time+=t,this.energy+=.1*e,this.energy>1&&(this.energy=1),this.timeValueElement.textContent=M.formatTime(this.time),this.energyFillElement.style.width=`${100*this.energy}%`,this.abilities))if(s.currentCooldown>0){s.currentCooldown-=t,s.currentCooldown<0&&(s.currentCooldown=0);let e=s.currentCooldown/s.useCooldown;s.element.style.setProperty("--ability-cooldown",`${100*e}%`)}}getAbilityCooldown(t){let e=this.abilities.get(t);return e?e.useCooldown:0}tryTakeEnergy(t){if(this.energy>=t)return this.energy-=t,1;let e=this.energy/t;return this.energy=0,e}constructor(){(0,o._)(this,"energy",1),(0,o._)(this,"time",0),(0,o._)(this,"timeValueElement",document.getElementById("timeHud")),(0,o._)(this,"energyFillElement",document.getElementById("energyFill")),(0,o._)(this,"abilities",new Map),(0,o._)(this,"activateAbility",new r),(0,o._)(this,"abilityHintShown",new r),(0,o._)(this,"abilityHintTime",0),(0,o._)(this,"queuedAbilityHints",[]),(0,o._)(this,"energyIcon",this.createColoredSvgImage('<svg viewBox="0 0 24 24"><path fill="currentColor" d="M9 15H5.9q-.6 0-.888-.537t.063-1.038l7.475-10.75q.25-.35.65-.487t.825.012t.625.525t.15.8L14 10h3.875q.65 0 .913.575t-.163 1.075L10.4 21.5q-.275.325-.675.425t-.775-.075t-.587-.537t-.163-.788z"/></svg>',"#ecca66")),(0,o._)(this,"explodeyIcon",this.createColoredSvgImage('<svg viewBox="0 0 24 24"><path fill="currentColor" d="M8.65 20.8q2.275 0 3.888-1.612T14.15 15.3q0-.775-.213-1.525T13.3 12.35l-.65-1.025l1.05-1.8l-2.6-1.5l-1.05 1.8h-1.1q-2.35 0-4.087 1.5T3.125 15.25q0 2.3 1.613 3.925T8.65 20.8M21 8.8q-.425 0-.712-.288T20 7.8t.288-.712T21 6.8h1q.425 0 .713.288T23 7.8t-.288.713T22 8.8zm-5.5-5.5q-.425 0-.712-.287T14.5 2.3v-1q0-.425.288-.712T15.5.3t.713.288t.287.712v1q0 .425-.288.713T15.5 3.3m3.175 1.325q-.275-.275-.275-.7t.275-.7L19.4 2.5q.275-.275.7-.275t.7.275t.275.7t-.275.7l-.725.725q-.275.275-.7.275t-.7-.275M17 7.55q-.125 0-.25-.025t-.25-.1l-.875-.5q-.35-.2-.763-.087t-.612.462l-.125.2l1 .575q.525.3.688.9t-.138 1.125L15 11.3q.575.9.863 1.913t.287 2.087q0 3.125-2.187 5.313T8.65 22.8t-5.312-2.212T1.15 15.25t2.163-5.288T8.6 7.8h.325L9.6 6.625q.3-.55.9-.712t1.15.162l.75.425l.125-.2q.575-1.075 1.8-1.4t2.3.3l.85.475q.225.125.375.362t.15.513q0 .425-.288.712T17 7.55"/></svg>',"#888888"));let t=0,e=[];for(const i of(document.querySelectorAll(".ability").forEach(i=>{var s,o;let l=i.dataset.ability??"",a=parseFloat(i.dataset.abilityCooldown??"0"),n=(null==(s=i.querySelector("[data-ability-name]"))?void 0:s.innerHTML)??"",r=(null==(o=i.querySelector("[data-ability-description]"))?void 0:o.innerHTML)??"",h=i.dataset.bind??"",d=parseFloat(i.dataset.abilityProbability??"0"),c=i.style.getPropertyValue("--ability-hue")??"0deg",y=i.querySelector("svg"),u=this.createColoredSvgImage(y,`hsl(${c}, 70%, 60%)`);e.push({id:l,name:n,description:r,bind:h,probability:d,styleHue:c,element:i,icon:u,cooldown:a}),t+=d,i.addEventListener("click",()=>{this.checkAbilityBind(h)})}),e))this.abilities.set(i.id,{name:i.name,description:i.description,bind:i.bind,normalizedProbability:i.probability/t,styleHue:i.styleHue,element:i.element,icon:i.icon,count:0,useCooldown:i.cooldown,currentCooldown:0}),this.updateAbilityElement(i.id)}}class E{setTarget(t){this.targetValue=t}update(t){let e=this.targetValue-this.currentValue,i=this.slewRate*t;Math.abs(e)<=i?this.currentValue=this.targetValue:this.currentValue+=Math.sign(e)*i}get value(){return this.currentValue}constructor(t,e){(0,o._)(this,"currentValue",void 0),(0,o._)(this,"targetValue",void 0),(0,o._)(this,"slewRate",void 0),this.currentValue=t,this.targetValue=t,this.slewRate=e}}let k=t=>t<.5?2*t*t:-1+(4-2*t)*t;class P{get slowMotionEase(){return k(this.slowMotionRate.value)}get uiHintEase(){return k(this.uiHintRate.value)}get gameOverEase(){return k(1-this.gameRunningRate.value)}update(t,e,i){this.gameRunningRate.setTarget(+!!e),this.pointSelectionRate.setTarget(i&&e?.03:1),this.gameRunningRate.update(t),this.slowMotionRate.update(t),this.uiHintRate.update(t),this.pointSelectionRate.update(t),this.timeScale=k(this.gameRunningRate.value)*k(this.slowMotionRate.value)*k(this.uiHintRate.value)*this.pointSelectionRate.value}setSlowMotion(t){this.slowMotionRate.setTarget(t?.4:1)}setUIHint(t){this.uiHintRate.setTarget(t?.2:1)}constructor(){(0,o._)(this,"timeScale",1),(0,o._)(this,"gameRunningRate",new E(1,2)),(0,o._)(this,"slowMotionRate",new E(1,2)),(0,o._)(this,"uiHintRate",new E(1,2)),(0,o._)(this,"pointSelectionRate",new E(1,3))}}(async()=>{await d.init()})();let L=document.getElementById("canvas"),C=new class{initShaderProgram(){let t=this.gl,e=this.loadShader(t.VERTEX_SHADER,this.vertexShaderSource),i=this.loadShader(t.FRAGMENT_SHADER,this.fragmentShaderSource),s=t.createProgram();if(t.attachShader(s,e),t.attachShader(s,i),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS))throw Error("Unable to initialize the shader program: "+t.getProgramInfoLog(s));return s}loadShader(t,e){let i=this.gl,s=i.createShader(t);if(i.shaderSource(s,e),i.compileShader(s),!i.getShaderParameter(s,i.COMPILE_STATUS))throw Error("An error occurred compiling the shaders: "+i.getShaderInfoLog(s));return s}render(){let t=this.gl;t.viewport(0,0,this.canvas.width,this.canvas.height),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.canvas2D),t.drawArrays(t.TRIANGLES,0,3)}setUniform1f(t,e){let i=this.gl;t in this.uniformLocations||(this.uniformLocations[t]=i.getUniformLocation(this.program,t)),i.uniform1f(this.uniformLocations[t],e)}getContext2D(){return this.canvas2D.getContext("2d")}constructor(t,e){(0,o._)(this,"canvas",void 0),(0,o._)(this,"canvas2D",void 0),(0,o._)(this,"resizeObserver",void 0),(0,o._)(this,"gl",void 0),(0,o._)(this,"program",void 0),(0,o._)(this,"texture",void 0),(0,o._)(this,"framebuffer",void 0),(0,o._)(this,"fragmentShaderSource",void 0),(0,o._)(this,"vertexShaderSource",void 0),(0,o._)(this,"uniformLocations",void 0),this.canvas=t,this.uniformLocations={},this.fragmentShaderSource=(null==e?void 0:e.fragment)??n,this.vertexShaderSource=(null==e?void 0:e.vertex)??a,t.width=t.clientWidth*window.devicePixelRatio,t.height=t.clientHeight*window.devicePixelRatio,this.canvas2D=document.createElement("canvas"),this.canvas2D.width=t.width,this.canvas2D.height=t.height;const i=t.getContext("webgl2");if(!i)throw Error("WebGL2 not supported");this.gl=i,this.program=this.initShaderProgram(),this.texture=i.createTexture(),this.framebuffer=i.createFramebuffer(),i.useProgram(this.program),i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t.width,t.height,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.texture,0),i.bindFramebuffer(i.FRAMEBUFFER,null),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0),this.resizeObserver=new ResizeObserver(()=>{t.width=t.clientWidth*window.devicePixelRatio,t.height=t.clientHeight*window.devicePixelRatio,this.canvas2D.width=t.width,this.canvas2D.height=t.height,i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t.width,t.height,0,i.RGBA,i.UNSIGNED_BYTE,null)}),this.resizeObserver.observe(t)}}(L,{fragment:"#version 300 es\r\nprecision highp float;\r\n\r\nin vec2 v_texCoord;\r\n#define tex_coord v_texCoord\r\n\r\nout vec4 outColor;\r\n\r\nuniform sampler2D u_texture;\r\n#define t0 u_texture\r\n\r\nuniform float bloom_spread; // e.g. 1\r\nuniform float bloom_intensity; // e.g. 2\r\nuniform float filter_amount; // e.g. 0.5\r\n\r\nvoid main() {\r\n	ivec2 size = textureSize(t0, 0);\r\n\r\n    float uv_x = tex_coord.x * float(size.x);\r\n    float uv_y = tex_coord.y * float(size.y);\r\n\r\n    // Increase spread based on filter amount\r\n    float spread = bloom_spread * (1.0 + filter_amount);\r\n\r\n    vec4 sum = vec4(0.0);\r\n    for(int n = 0; n < 9; ++n) {\r\n        uv_y = (tex_coord.y * float(size.y)) + (spread * float(n - 4));\r\n        vec4 h_sum = vec4(0.0);\r\n        h_sum += texelFetch(t0, ivec2(uv_x - (4.0 * spread), uv_y), 0);\r\n        h_sum += texelFetch(t0, ivec2(uv_x - (3.0 * spread), uv_y), 0);\r\n        h_sum += texelFetch(t0, ivec2(uv_x - (2.0 * spread), uv_y), 0);\r\n        h_sum += texelFetch(t0, ivec2(uv_x - spread, uv_y), 0);\r\n        h_sum += texelFetch(t0, ivec2(uv_x, uv_y), 0);\r\n        h_sum += texelFetch(t0, ivec2(uv_x + spread, uv_y), 0);\r\n        h_sum += texelFetch(t0, ivec2(uv_x + (2.0 * spread), uv_y), 0);\r\n        h_sum += texelFetch(t0, ivec2(uv_x + (3.0 * spread), uv_y), 0);\r\n        h_sum += texelFetch(t0, ivec2(uv_x + (4.0 * spread), uv_y), 0);\r\n        sum += h_sum / 9.0;\r\n    }\r\n\r\n    outColor = texture(t0, tex_coord) + ((sum / 9.0) * bloom_intensity);\r\n\r\n    // Apply a simple grayscale/desaturation filter based on filter_amount\r\n    float gray = dot(outColor.rgb, vec3(0.299, 0.587, 0.114));\r\n    outColor.rgb = mix(outColor.rgb, vec3(gray), filter_amount);\r\n}"});C.setUniform1f("bloom_spread",.5),C.setUniform1f("bloom_intensity",.75);let R=C.getContext2D(),D=null,A=null,I={x:0,y:0,vx:200,vy:300},U=L.width/2,F=2*L.height/3;function O(){D||(D=new W,document.getElementById("menu").style.display="none",document.getElementById("hud").style.display="block")}function V(){D=null,document.getElementById("menu").style.display="flex",document.querySelectorAll("[data-game-ui]").forEach(t=>{t.style.display="none"})}window.addEventListener("mousemove",t=>{U=t.clientX*window.devicePixelRatio,F=t.clientY*window.devicePixelRatio}),document.getElementById("scoreDisplay").innerText=`Best time: ${M.formatTime(M.getBestTime()??0)}`,requestAnimationFrame(function t(e){null===A&&(A=e-16);let i=Math.min((e-A)/1e3,.05);if(A=e,requestAnimationFrame(t),D)D.draw(i);else{R.setTransform(1,0,0,1,0,0),R.clearRect(0,0,L.width,L.height);let t=L.width,e=L.height;I.x<-.5*t+10?(I.x=-.5*t+10,I.vx=-(.9*I.vx)):I.x>.5*t-10&&(I.x=.5*t-10,I.vx=-(.9*I.vx)),I.y<-.5*e+10?(I.y=-.5*e+10,I.vy=-(.9*I.vy)):I.y>.5*e-10&&(I.y=.5*e-10,I.vy=-(.9*I.vy)),document.querySelectorAll("[data-bounce-menu-ball]").forEach(s=>{let o=s.getBoundingClientRect(),l=o.left*window.devicePixelRatio-t/2,a=o.right*window.devicePixelRatio-t/2,n=o.top*window.devicePixelRatio-e/2,r=o.bottom*window.devicePixelRatio-e/2;if(I.x+10>l&&I.x-10<a&&I.y+10>n&&I.y-10<r){let t=Math.abs(I.x-l),e=Math.abs(I.x-a),i=Math.abs(I.y-n),o=Math.abs(I.y-r),h=Math.min(t,e,i,o);h===t?I.vx=-(.9*Math.abs(I.vx)):h===e?I.vx=.9*Math.abs(I.vx):h===i?I.vy=-(.9*Math.abs(I.vy)):h===o&&(I.vy=.9*Math.abs(I.vy));let d=parseFloat(getComputedStyle(s).opacity);s.style.opacity=Math.max(.5,d-.1).toString()}let h=parseFloat(getComputedStyle(s).opacity);s.style.opacity=Math.min(1,h+.1*i).toString()}),I.x+=I.vx*i,I.y+=I.vy*i,R.strokeStyle="white",R.lineWidth=2,R.beginPath(),R.arc(L.width/2+I.x,L.height/2+I.y,10,0,2*Math.PI),R.stroke();let s=U-(L.width/2+I.x),o=F-(L.height/2+I.y),l=Math.sqrt(s*s+o*o);if(l>1){let t=s/l,e=o/l,a=10*l-(I.vx*t+I.vy*e);I.vx+=t*a*i,I.vy+=e*a*i}C.render()}}),document.getElementById("startButton").addEventListener("click",O),document.getElementById("restart-button").addEventListener("click",()=>{V(),O()}),document.getElementById("menu-button").addEventListener("click",V),document.addEventListener("keydown",t=>{D&&D.onKeyDown(t)}),document.addEventListener("keyup",t=>{D&&D.onKeyUp(t)}),document.addEventListener("mousedown",t=>{D&&D.onMouseDown(t)});class W{onKeyDown(t){if(!t.repeat){if(!this.gameRunning&&"Escape"===t.code)return void V();if(this.gameRunning){if(this.keysPressed.add(t.code),this.pointSelection){if(performance.now()-this.pointSelection.startTime<200)return;let t=this.camera.projectToWorld(U,F,L);this.pointSelection.callback(t.x,t.y),this.pointSelection=null;return}this.stats.checkAbilityBind(t.code)}}}onKeyUp(t){this.keysPressed.delete(t.code)}onMouseDown(t){if(this.gameRunning&&this.pointSelection){if(performance.now()-this.pointSelection.startTime<100)return;let e=this.camera.projectToWorld(t.clientX,t.clientY,L);this.pointSelection.callback(e.x,e.y),this.pointSelection=null;return}}update(t){if(this.level.gameOver()&&this.gameRunning&&this.gameOver(),null!==this.pointSelection!==this.hadPointSelectionLastFrame&&(this.hadPointSelectionLastFrame=null!==this.pointSelection,document.getElementById("abilities").classList.toggle("inactive",null!==this.pointSelection)),this.camera.trackBalls(this.balls,t,!this.gameRunning,null!==this.pointSelection),this.timeScaleManager.update(t,this.gameRunning,null!==this.pointSelection),(t*=this.timeScaleManager.timeScale)<=1e-7)return;this.particles.update(t),this.stats.update(t,t/this.timeScaleManager.timeScale);let e=0,i=0;(this.keysPressed.has("ArrowLeft")||this.keysPressed.has("KeyA"))&&(e-=1),(this.keysPressed.has("ArrowRight")||this.keysPressed.has("KeyD"))&&(e+=1),(this.keysPressed.has("ArrowUp")||this.keysPressed.has("KeyW"))&&(i-=1),(this.keysPressed.has("ArrowDown")||this.keysPressed.has("KeyS"))&&(i+=1);let s=Math.sqrt(e*e+i*i);if(s>0&&(s/=this.stats.tryTakeEnergy(.4*t)),s>.01)for(let t of(e/=s,i/=s,this.balls))t.isDestroyed()||t.applyForce(.003*e,.003*i);for(let e=0;e<5;e++)this.world.step(t/5,4,2);this.world.clearForces(),this.level.update(this.world,t);for(let e=this.balls.length-1;e>=0;e--){if(this.balls[e].isDestroyed()){this.balls[e].destroy(this.world),this.balls.splice(e,1),0===this.balls.length&&this.gameOver();continue}this.balls[e].update(t)}for(let e=this.powerUps.length-1;e>=0;e--){if(this.powerUps[e].isDestroyed){this.powerUps[e].destroy(this.world),this.powerUps.splice(e,1);continue}this.powerUps[e].update(t)}this.paddle.update(t,this.balls)}gameOver(){this.gameRunning=!1;let t=document.getElementById("game-over");t.classList.remove("visible"),t.style.display="flex",setTimeout(()=>{t.classList.add("visible"),document.getElementById("game-over-reason").textContent=0===this.balls.length?"No more balls!":"Blocks reached the bottom!";let e=this.stats.time;M.submitTime(e),document.getElementById("final-time").textContent=`Time: ${M.formatTime(e)}`;let i=document.getElementById("best-time"),s=M.getBestTime()??e;i.textContent=`Best time: ${M.formatTime(s)}`},500),d.play("gameOver.wav")}drawWorld(){for(let t of this.powerUps)t.draw(R);for(let t of(this.level.drawWorld(R),this.balls))t.draw(R);if(this.pointSelection){let{type:t}=this.pointSelection,e=this.camera.projectToWorld(U,F,L);switch(t){case 0:for(let t of this.balls){if(t.isDestroyed())continue;let i=t.position;R.strokeStyle="rgba(255, 137, 255, 0.75)",R.lineWidth=.003,R.setLineDash([.01,.01]);let s=e.x-i.x,o=e.y-i.y,l=Math.sqrt(s*s+o*o),a=i.x+(l>0?s/l*t.radius:0),n=i.y+(l>0?o/l*t.radius:0);R.beginPath(),R.moveTo(e.x,e.y),R.lineTo(a,n),R.stroke(),R.setLineDash([])}break;case 1:for(let t of(R.strokeStyle="rgba(50, 200, 255, 0.7)",R.lineWidth=.003,R.beginPath(),R.arc(e.x,e.y,.015,0,2*Math.PI),R.stroke(),this.balls)){if(t.isDestroyed())continue;let i=t.position;R.strokeStyle="rgba(50, 200, 255, 0.3)",R.lineWidth=.0025,R.setLineDash([.01,.01]),R.beginPath(),R.moveTo(e.x,e.y),R.lineTo(i.x,i.y),R.stroke(),R.setLineDash([])}}}this.paddle.draw(R)}draw(t){this.update(t),R.setTransform(1,0,0,1,0,0),R.fillStyle="#040408",R.fillRect(0,0,L.width,L.height),this.camera.applyTransform(R),R.save(),R.translate(this.camera.x,this.camera.y),R.scale(.98,.98),R.translate(-this.camera.x,-this.camera.y),this.level.draw(R,t),this.level.drawBorder(R),R.restore(),this.level.drawBorder(R),R.globalAlpha=.2,R.save(),R.translate(this.camera.x,this.camera.y),R.scale(.985,.985),R.translate(-this.camera.x,-this.camera.y),this.drawWorld(),R.restore(),R.globalAlpha=1,this.particles.draw(R),this.drawWorld();let e=this.timeScaleManager.slowMotionEase,i=.5*this.timeScaleManager.uiHintEase+.5,s=.5*this.timeScaleManager.gameOverEase+.5;C.setUniform1f("filter_amount",1-e*i*s),C.render()}constructor(){for(const t of((0,o._)(this,"world",new l.HK({gravity:{x:0,y:0},allowSleep:!0})),(0,o._)(this,"level",new b),(0,o._)(this,"balls",this.level.getInitialBalls()),(0,o._)(this,"powerUps",[]),(0,o._)(this,"paddle",new u(0,.4,.15,.02)),(0,o._)(this,"camera",new p(0,0,1)),(0,o._)(this,"particles",new B),(0,o._)(this,"stats",new T),(0,o._)(this,"gameRunning",!0),(0,o._)(this,"timeScaleManager",new P),(0,o._)(this,"pointSelection",null),(0,o._)(this,"keysPressed",new Set),(0,o._)(this,"hadPointSelectionLastFrame",!1),this.world.on("pre-solve",t=>{let e=t.getFixtureA(),i=t.getFixtureB(),s=e.getUserData(),o=i.getUserData();(s instanceof m&&o instanceof g||o instanceof m&&s instanceof g)&&t.setEnabled(!1),(s instanceof g&&s.isGhost()||o instanceof g&&o.isGhost())&&t.setEnabled(!1)}),this.world.on("begin-contact",t=>{let e=t.getFixtureA(),i=t.getFixtureB(),s=e.getUserData(),o=i.getUserData(),l=null,a=null,n=null;s instanceof g?(l=s,a=e,n=i):o instanceof g&&(l=o,a=i,n=e),l&&a&&n&&l.handleCollision(t,n,this.particles)}),this.world.createBody({type:"static"}).createFixture({shape:this.level.getBorders(),restitution:1,friction:0,filterCategoryBits:4}),this.level.initBlocksInWorld(this.world),this.balls))t.addToWorld(this.world);this.paddle.addToWorld(this.world),this.level.addDeathBody(this.world),this.camera.minimumScreenDimensions=this.level.levelDimensions.map(t=>1.05*t),this.level.spawnPowerUp.connect((t,e)=>{let i=Math.random();if(i<.5){let s;if(i<.1)(s=new m(t,e,this.stats.energyIcon,!0,"#ece8ae")).collected.connect(()=>{this.stats.addEnergy(.2)});else if(i<.2)(s=new m(t,e,this.stats.explodeyIcon,!0,"#ff5555")).collected.connect(t=>{this.particles.emitCircleBurst(s.position.x,s.position.y,.03,100,.6,.7,"#ff5555"),t.applyExplosionImpulse(s.position.x,s.position.y+.05,.001),d.play("explosion.wav")});else{let i=this.stats.selectAbility();(s=new m(t,e,i.icon,!1,i.color)).collected.connect(()=>{this.stats.addAbility(i.id)})}s.addToWorld(this.world),this.powerUps.push(s)}}),this.stats.activateAbility.connect(t=>{switch(t){case"slowmotion":this.timeScaleManager.setSlowMotion(!0),d.play("slowMotion.wav"),setTimeout(()=>{this.timeScaleManager.setSlowMotion(!1),d.play("slowMotionResume.wav")},1e3*this.stats.getAbilityCooldown(t)-500);break;case"widen":this.paddle.widen(),d.play("usePowerUp.wav");break;case"split":let e=[],i=Math.PI/12;for(let t of this.balls){if(e.length+this.balls.length>=150)break;if(!t.isDestroyed())for(let s of[t.cloneWithAngleOffset(-i),t.cloneWithAngleOffset(i)])s.addToWorld(this.world),e.push(s)}this.balls.push(...e),d.play("usePowerUp.wav");break;case"slingshot":this.pointSelection={type:0,callback:(t,e)=>{for(let i of this.balls){if(i.isDestroyed())continue;let s=i.position,o=t-s.x,l=e-s.y,a=Math.sqrt(o*o+l*l);if(a>0){let n=o/a*.1,r=l/a*.1;i.slingshot(n,r),this.particles.emitLineBurst(s.x,s.y,t,e,100,.9,.6,"#ff89ff",.5)}}d.play("launch.wav")},startTime:performance.now()};break;case"teleport":this.pointSelection={type:1,callback:(t,e)=>{for(let i of this.balls)i.isDestroyed()||(this.particles.emitLineBurst(i.position.x,i.position.y,t,e,30,.1,.9,"#89ffff",.9),i.teleportTo(t+.01*i.velocity.x,e+.01*i.velocity.y));d.play("teleport.wav")},startTime:performance.now()};break;case"ghost":for(let e of this.balls)e.isDestroyed()||e.setGhostMode(this.stats.getAbilityCooldown(t)/2);d.play("usePowerUp.wav");break;case"laser":for(let t of this.balls){if(t.isDestroyed())continue;let e=[{x:1,y:0,len:this.level.levelDimensions[0]/2-t.position.x},{x:-1,y:0,len:this.level.levelDimensions[0]/2+t.position.x},{x:0,y:1,len:this.level.levelDimensions[1]/2-t.position.y},{x:0,y:-1,len:this.level.levelDimensions[1]/2+t.position.y}],i=t.position;for(let t of e){let e=i.x+t.x*t.len,s=i.y+t.y*t.len;this.world.rayCast(i,{x:e,y:s},(t,e,i,s)=>{let o=t.getUserData();return o instanceof c&&o.hit(this.particles),1}),this.particles.emitLineBurst(i.x,i.y,e,s,200/this.balls.length,.4,.8,"#f96d4e",.7)}}d.play("laserShoot.wav")}}),this.stats.abilityHintShown.connect(t=>{this.timeScaleManager.setUIHint(t)})}}}},l={};function a(t){var e=l[t];if(void 0!==e)return e.exports;var i=l[t]={exports:{}};return o[t](i,i.exports,a),i.exports}a.m=o,a.d=(t,e)=>{for(var i in e)a.o(e,i)&&!a.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t=[],a.O=(e,i,s,o)=>{if(i){o=o||0;for(var l=t.length;l>0&&t[l-1][2]>o;l--)t[l]=t[l-1];t[l]=[i,s,o];return}for(var n=1/0,l=0;l<t.length;l++){for(var[i,s,o]=t[l],r=!0,h=0;h<i.length;h++)(!1&o||n>=o)&&Object.keys(a.O).every(t=>a.O[t](i[h]))?i.splice(h--,1):(r=!1,o<n&&(n=o));if(r){t.splice(l--,1);var d=s();void 0!==d&&(e=d)}}return e},e={410:0},a.O.j=t=>0===e[t],i=(t,i)=>{var s,o,[l,n,r]=i,h=0;if(l.some(t=>0!==e[t])){for(s in n)a.o(n,s)&&(a.m[s]=n[s]);if(r)var d=r(a)}for(t&&t(i);h<l.length;h++)o=l[h],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(d)},(s=self.webpackChunkreverse_breakout=self.webpackChunkreverse_breakout||[]).forEach(i.bind(null,0)),s.push=i.bind(null,s.push.bind(s));var n=a.O(void 0,["979"],()=>a(785));n=a.O(n)})();